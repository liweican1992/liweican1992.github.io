<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>licc</title>
  
  <subtitle>AppçŸ©é˜µ|å‡ºæµ·|æŠ•æ”¾å½’å› </subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2025-07-21T01:56:51.660Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>weican Li</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOSå›½é™…åŒ–-å¤§æ¨¡å‹è‡ªåŠ¨ç¿»è¯‘è„šæœ¬ï¼ˆGPT+DeepSeekï¼‰</title>
    <link href="http://yoursite.com/2025/02/14/iOS%E5%9B%BD%E9%99%85%E5%8C%96-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%87%AA%E5%8A%A8%E7%BF%BB%E8%AF%91%E8%84%9A%E6%9C%AC%EF%BC%88GPT-DeepSeek%EF%BC%89/"/>
    <id>http://yoursite.com/2025/02/14/iOS%E5%9B%BD%E9%99%85%E5%8C%96-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%87%AA%E5%8A%A8%E7%BF%BB%E8%AF%91%E8%84%9A%E6%9C%AC%EF%BC%88GPT-DeepSeek%EF%BC%89/</id>
    <published>2025-02-14T11:56:00.000Z</published>
    <updated>2025-07-21T01:56:51.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨pythonè„šæœ¬é€šè¿‡å¤§æ¨¡å‹APIè¿›è¡Œæ‰¹é‡æ–‡æœ¬ç¿»è¯‘ã€‚æœ¬æ–‡æ˜¯å¯¹ä¹‹å‰Xliffè‡ªåŠ¨å½•å…¥è„šæœ¬çš„è¡¥å……ã€‚</p></blockquote><p>è¿™ä¸ªè„šæœ¬æ˜¯å¯¹ä¹‹å‰åœ¨Xcodeä¸Šä½¿ç”¨çš„Xliffè‡ªåŠ¨å½•å…¥è„šæœ¬çš„è¡¥å……ã€‚<br>å…³äºå¦‚ä½•åœ¨Xcodeä¸­ä½¿ç”¨è‡ªåŠ¨å¯¼å‡ºï¼Œæ‰¹é‡å½•å…¥ã€å¯¼å…¥å›½é™…åŒ–æ–‡æ¡ˆï¼Œè¯¦è§ï¼š<a href="https://leevcan.com/2020/10/12/iOS%E5%9B%BD%E9%99%85%E5%8C%96%E2%80%94Xliff%E5%BD%95%E5%85%A5%E8%84%9A%E6%9C%AC/" target="_blank" rel="noopener">iOSå›½é™…åŒ–â€”xliffè‡ªåŠ¨å½•å…¥è„šæœ¬</a></p><h6 id="0-èƒŒæ™¯ä»‹ç»"><a href="#0-èƒŒæ™¯ä»‹ç»" class="headerlink" title="0.èƒŒæ™¯ä»‹ç»"></a>0.èƒŒæ™¯ä»‹ç»</h6><p>iOSå›½é™…åŒ–â€”xliffè‡ªåŠ¨å½•å…¥è„šæœ¬åœ¨é¡¹ç›®ä¸­å·²ç»ç¨³å®šè¿è¡Œäº†4å¹´ï¼Œä¹‹æ‰€ä»¥ä½¿ç”¨äº‘ç«¯Excleç®¡ç†ç¿»è¯‘æ–‡æ¡ˆæ˜¯è€ƒè™‘åˆ°å…¼å®¹Androidç«¯å’ŒWebç«¯ç­‰ã€‚ä¹‹å‰æ¯ä¸ªç‰ˆæœ¬éƒ½éœ€è¦äº§å“åŒå­¦å½’çº³æ–°å¢çš„æ–‡æ¡ˆï¼Œå¹¶é€šè¿‡ç¿»è¯‘å¼•æ“æ‰‹åŠ¨ç¿»è¯‘åå¡«å†™åˆ°Excelä¸­ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202507141958631.png" alt=""><br>éšç€GPTçš„è¯ç”Ÿï¼Œç¿»è¯‘å·¥å…·å°±åˆ‡æ¢æˆäº†GPTï¼Œç¿»è¯‘çš„æ›´åœ°é“ï¼Œæ›´äººæ€§åŒ–ã€‚<br>ä½†æ˜¯æ¯æ¬¡é€šè¿‡å¯¹è¯æ¡†ç¿»è¯‘ï¼Œæ‹¿åˆ°ç»“æœå†ç²˜è´´åˆ°Excelä¸­æ˜æ˜¾æ•ˆç‡æœ‰æå‡ç©ºé—´ï¼Œå¹¶ä¸”éšç€DeepSeekçš„çˆ†ç«ï¼Œå‘ç°DeepSeek R1çš„ç¿»è¯‘è¿˜ä¼šè€ƒè™‘å½“åœ°é£ä¿—ä¹ æƒ¯ç­‰ï¼Œå¹¶ä¸”èƒ½çœ‹åˆ°æ€è€ƒè¿‡ç¨‹ã€‚æ‰€ä»¥ç›´æ¥é€šè¿‡è„šæœ¬è°ƒç”¨APIæ•ˆç‡ä¼šæ›´é«˜ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202507141958282.png" alt=""></p><h6 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1.éœ€æ±‚åˆ†æ"></a>1.éœ€æ±‚åˆ†æ</h6><p>å› ä¸ºæ˜¯å¯¹ä¹‹å‰è„šæœ¬çš„è¡¥å……ï¼Œé‚£ä¹ˆå‚è€ƒä¹‹å‰è„šæœ¬é€»è¾‘ã€‚åœ¨xliff.pyä¸­å­˜åœ¨ä¸€ä¸ªExcelè¯­ç§æ ‡é¢˜å’ŒXcodeä¸­å¤šè¯­è¨€Bundle Nameç¼©å†™çš„æ˜ å°„å…³ç³»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202507141959685.png" alt=""><br>Localization.shä¸­å£°æ˜éœ€è¦å¤„ç†é‚£äº›è¯­ç§ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202507142000661.png" alt=""></p><p>é‚£ä¹ˆç›´æ¥è¯»å–æœ¬åœ°Excelå¹¶æ‰¹é‡ç¿»è¯‘åç”Ÿæˆä¸€ä¸ªæ–°Excelçš„æ–¹æ¡ˆä¼šæ›´å¥½ã€‚è¿™æ ·ç»“åˆ<a href="https://leevcan.com/2020/10/12/iOS%E5%9B%BD%E9%99%85%E5%8C%96%E2%80%94Xliff%E5%BD%95%E5%85%A5%E8%84%9A%E6%9C%AC/" target="_blank" rel="noopener">iOSå›½é™…åŒ–â€”xliffè‡ªåŠ¨å½•å…¥è„šæœ¬</a>ã€‚æ•´ä¸ªæµç¨‹éƒ½å¯ä»¥å®ç°è‡ªåŠ¨åŒ–ã€‚</p><p>å¹¶ä¸”ä¹‹å‰å°è¯•ä½¿ç”¨åˆ†éš”ç¬¦æ‰¹é‡è¯·æ±‚å¹¶ä¸”è®©å¤§æ¨¡å‹è¿”å›jsonæ ¼å¼çš„ç¿»è¯‘ç»“æœï¼Œæ˜æ˜¾ä¼šå¢åŠ å¤§æ¨¡å‹å¹»è§‰ï¼Œé€ æˆç¿»è¯‘ç»“æœé”™ä½ç­‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202507142000888.png" alt=""></p><h6 id="2-è„šæœ¬å®ç°"><a href="#2-è„šæœ¬å®ç°" class="headerlink" title="2.è„šæœ¬å®ç°"></a>2.è„šæœ¬å®ç°</h6><p>DeepSeekçš„APIå¯ä»¥åœ¨å®˜ç½‘è´­ä¹°ï¼Œä½†æ˜¯æ¨èç¬¬ä¸‰æ–¹å¹³å°æ¥å…¥ï¼Œæ¯•ç«Ÿå¯ä»¥ç™½å«–ï¼ˆä¸æ˜¯â€¦ï¼‰ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯siliconflowå¹³å°ã€‚æ³¨å†Œé€2000w tokenã€‚æ¬¢è¿å¤§å®¶é€šè¿‡æˆ‘çš„<a href="https://cloud.siliconflow.cn/i/gdaCaOmO" target="_blank" rel="noopener">é‚€è¯·é“¾æ¥æ³¨å†Œ</a>ï¼Œæˆ–è€…å¡«å†™é‚€è¯·ç ï¼š<strong>gdaCaOmO</strong></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202507142001911.png" alt=""></p><p>GPTçš„è¯æ˜¯é€šè¿‡å¾®è½¯Azureå¹³å°æ¥å…¥ï¼Œè¯¦è§ï¼š<a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/chatgpt-quickstart?tabs=command-line%2Ckeyless%2Ctypescript-keyless%2Cpython-new&pivots=programming-language-python" target="_blank" rel="noopener">Quickstart: Get started using GPT-35-Turbo and GPT-4 with Azure OpenAI Service</a></p><p>ä¸‹é¢æ˜¯æ•´ä¸ªè„šæœ¬çš„å®ç°ï¼Œé»˜è®¤ä½¿ç”¨GPTè¿›è¡Œç¿»è¯‘ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šDeepSeekï¼Œæ”¯æŒä¿®æ”¹DeepSeekçš„æ¨¡å‹ã€‚æ¨¡å‹åç§°è¯¦è§ï¼š<a href="https://docs.siliconflow.cn/cn/api-reference/chat-completions/chat-completions" target="_blank" rel="noopener">Siliconflow API</a>ã€‚æ³¨æ„DeepSeekå’ŒGPTçš„payloadæ ¼å¼ä¸ä¸€æ ·ã€‚</p><p>éœ€è¦æå‰åœ¨æœ¬åœ°é…ç½®API Keyå¹¶é˜²æ­¢ç§˜é’¥æ³„éœ²ã€‚</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¿™ç§æ–¹å¼åªåœ¨å½“å‰Terminalä¸­ç”Ÿæ•ˆ å¦‚ä½•å…¨å±€ç”Ÿæ•ˆè¯·ç»“åˆè‡ªå·±æ“ä½œç³»ç»Ÿ è‡ªè¡Œæ“ä½œï¼</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">AZURE_OPENAI_API_KEY</span>=<span class="string">"REPLACE_WITH_YOUR_KEY_VALUE_HERE"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">AZURE_OPENAI_ENDPOINT</span>=<span class="string">"REPLACE_WITH_YOUR_KEY_VALUE_HERE"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">DEEPSEEK_API_URL</span>=<span class="string">"REPLACE_WITH_YOUR_KEY_VALUE_HERE"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">DEEPSEEK_API_KEY</span>=<span class="string">"REPLACE_WITH_YOUR_KEY_VALUE_HERE"</span></span><br></pre></td></tr></table></figure><p>ä¾èµ–åŒ…å®‰è£…å¯ä»¥ä½¿ç”¨pipè¿›è¡Œå®‰è£…</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> openpyxl requests openai</span><br></pre></td></tr></table></figure><p>è„šæœ¬å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#liweican@corp.netease.com</span></span><br><span class="line"><span class="comment">#æ”¯æŒgpt+deepseekã€‚è¯·è‡ªå·±åœ¨æœ¬åœ°é…ç½®DEEPSEEK_API_URL/DEEPSEEK_API_KEY/AZURE_OPENAI_ENDPOINT/AZURE_OPENAI_API_KEY é˜²æ­¢ç§˜é’¥æ³„éœ²</span></span><br><span class="line"><span class="comment">#eg:</span></span><br><span class="line"><span class="comment">#export AZURE_OPENAI_API_KEY="REPLACE_WITH_YOUR_KEY_VALUE_HERE"</span></span><br><span class="line"><span class="comment">#è¿™ç§æ–¹å¼åªåœ¨å½“å‰Terminalä¸­ç”Ÿæ•ˆ å¦‚ä½•å…¨å±€ç”Ÿæ•ˆè¯·ç»“åˆè‡ªå·±æ“ä½œç³»ç»Ÿ è‡ªè¡Œæ“ä½œï¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> PatternFill</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> AzureOpenAI</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ·å¼é…ç½®</span></span><br><span class="line">AUTO_TRANSLATE_FILL = PatternFill(</span><br><span class="line">    start_color=<span class="string">"FFD8E4BC"</span>,</span><br><span class="line">    end_color=<span class="string">"FFD8E4BC"</span>,</span><br><span class="line">    fill_type=<span class="string">"solid"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">LANGUAGE_MAPPING = &#123;</span><br><span class="line">    <span class="string">"ä¸­æ–‡ç®€ä½“"</span>: <span class="string">"Simplified Chinese"</span>,</span><br><span class="line">    <span class="string">"ä¸­æ–‡ç¹ä½“"</span>: <span class="string">"Traditional Chinese"</span>,</span><br><span class="line">    <span class="string">"Japanese"</span>: <span class="string">"Japanese"</span>,</span><br><span class="line">    <span class="string">"Spanish"</span>: <span class="string">"Spanish"</span>,</span><br><span class="line">    <span class="string">"Korean"</span>: <span class="string">"Korean"</span>,</span><br><span class="line">    <span class="string">"Thailand"</span>: <span class="string">"Thai"</span>,</span><br><span class="line">    <span class="string">"Indonesia"</span>: <span class="string">"Indonesian"</span>,</span><br><span class="line">    <span class="string">"German"</span>: <span class="string">"German"</span>,</span><br><span class="line">    <span class="string">"French"</span>: <span class="string">"French"</span>,</span><br><span class="line">    <span class="string">"Portuguese"</span>: <span class="string">"Portuguese"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># APIé…ç½®</span></span><br><span class="line">DEEPSEEK_API_URL = os.getenv(<span class="string">"DEEPSEEK_API_URL"</span>)</span><br><span class="line">DEEPSEEK_API_KEY = os.getenv(<span class="string">"DEEPSEEK_API_KEY"</span>)</span><br><span class="line"><span class="comment">#æŒ‡å®šæ¨¡å‹åç§° è’¸é¦æ¨¡å‹é€Ÿåº¦æ›´å¿« ä»·æ ¼ä¹Ÿä½</span></span><br><span class="line">DEEPSEEK_MODEL_NAME = <span class="string">"deepseek-ai/DeepSeek-R1-Distill-Qwen-14B"</span></span><br><span class="line">AZURE_OPENAI_ENDPOINT = os.getenv(<span class="string">"AZURE_OPENAI_ENDPOINT"</span>)</span><br><span class="line">AZURE_OPENAI_API_KEY = os.getenv(<span class="string">"AZURE_OPENAI_API_KEY"</span>)</span><br><span class="line">GPT_API_VERSION = <span class="string">"2024-06-01"</span></span><br><span class="line">BATCH_SIZE = <span class="number">8</span></span><br><span class="line">MAX_TOKENS = <span class="number">4096</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£æç¿»è¯‘ç»“æœ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_translation_result</span><span class="params">(raw_text, texts)</span>:</span></span><br><span class="line">    translated = []</span><br><span class="line">    pattern = re.compile(<span class="string">r'^\d+\.\s*(.+)$'</span>, re.MULTILINE)</span><br><span class="line">    matches = pattern.findall(raw_text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(matches) == len(texts):</span><br><span class="line">        translated = [m.strip() <span class="keyword">for</span> m <span class="keyword">in</span> matches]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¤‡ç”¨æ–¹æ¡ˆ</span></span><br><span class="line">        translated = [line.split(<span class="string">". "</span>, <span class="number">1</span>)[<span class="number">-1</span>].strip()</span><br><span class="line">                      <span class="keyword">for</span> line <span class="keyword">in</span> raw_text.split(<span class="string">"\n"</span>)</span><br><span class="line">                      <span class="keyword">if</span> line.strip() <span class="keyword">and</span> line[<span class="number">0</span>].isdigit()]</span><br><span class="line">    <span class="keyword">return</span> translated</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡ç¿»è¯‘å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batch_translate</span><span class="params">(texts, target_lang, model_choice)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> texts <span class="keyword">or</span> <span class="keyword">not</span> target_lang:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºprompt</span></span><br><span class="line">    numbered_texts = <span class="string">"\n"</span>.join([<span class="string">f"<span class="subst">&#123;i + <span class="number">1</span>&#125;</span>. <span class="subst">&#123;text&#125;</span>"</span> <span class="keyword">for</span> i, text <span class="keyword">in</span> enumerate(texts)])</span><br><span class="line">    <span class="comment"># é¿å…Pythonè§£æå ä½ç¬¦</span></span><br><span class="line">    system_prompt = <span class="string">f"""ä½ æ˜¯ä¸€ä½ä¸“ä¸šAppå†…æ–‡æ¡ˆç¿»è¯‘äººå‘˜ï¼Œè¯·å°†ä»¥ä¸‹è‹±æ–‡æ–‡æœ¬åˆ—è¡¨å‡†ç¡®ç¿»è¯‘ä¸º<span class="subst">&#123;LANGUAGE_MAPPING[target_lang]&#125;</span>ï¼š</span></span><br><span class="line"><span class="string"><span class="subst">&#123;numbered_texts&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¯·ä¸¥æ ¼éµå¾ªï¼š</span></span><br><span class="line"><span class="string">1. ä¿æŒä¸“ä¸šæœ¯è¯­ä¸€è‡´æ€§</span></span><br><span class="line"><span class="string">2. ä¿ç•™æ•°å­—å’Œç‰¹æ®Šç¬¦å·ï¼Œ$&#123;&#123;TT&#125;&#125;ã€$&#123;&#123;time&#125;&#125;ç­‰æ˜¯å ä½ç¬¦å‡ä¸ç¿»è¯‘ã€‚</span></span><br><span class="line"><span class="string">3. ä½¿ç”¨æ­£å¼ä¹¦é¢è¯­ä½“</span></span><br><span class="line"><span class="string">4. æŒ‰ä»¥ä¸‹æ ¼å¼è¿”å›ï¼š</span></span><br><span class="line"><span class="string">1. ç¿»è¯‘ç»“æœ</span></span><br><span class="line"><span class="string">2. ç¿»è¯‘ç»“æœ"""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> model_choice == <span class="string">"deepseek"</span>:</span><br><span class="line">        payload = &#123;</span><br><span class="line">            <span class="string">"model"</span>: DEEPSEEK_MODEL_NAME,</span><br><span class="line">            <span class="string">"messages"</span>: [</span><br><span class="line">                &#123;<span class="string">"role"</span>: <span class="string">"system"</span>, <span class="string">"content"</span>: system_prompt&#125;,</span><br><span class="line">                &#123;<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: <span class="string">"è¯·å¼€å§‹ç¿»è¯‘"</span>&#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"temperature"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">"max_tokens"</span>: MAX_TOKENS</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">"Authorization"</span>: <span class="string">f"Bearer <span class="subst">&#123;DEEPSEEK_API_KEY&#125;</span>"</span>,</span><br><span class="line">            <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ·»åŠ è¶…æ—¶å’Œé‡è¯•æœºåˆ¶</span></span><br><span class="line">            print(system_prompt)</span><br><span class="line">            print(<span class="string">"ğŸš€ğŸš€ğŸš€å½“å‰DeepSeekæ¨¡å‹æ˜¯"</span> + DEEPSEEK_MODEL_NAME)</span><br><span class="line"></span><br><span class="line">            response = requests.post(DEEPSEEK_API_URL, json=payload, headers=headers, timeout=(<span class="number">10</span>, <span class="number">30</span>))</span><br><span class="line">            response.raise_for_status()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># status_code</span></span><br><span class="line">            print(<span class="string">f"APIå“åº”çŠ¶æ€ç : <span class="subst">&#123;response.status_code&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response_data = response.json()</span><br><span class="line">                print(response_data)</span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">"æ— æ•ˆçš„JSONå“åº”"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'choices'</span> <span class="keyword">not</span> <span class="keyword">in</span> response_data <span class="keyword">or</span> <span class="keyword">not</span> response_data[<span class="string">'choices'</span>]:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">"APIè¿”å›ç»“æ„å¼‚å¸¸"</span>)</span><br><span class="line"></span><br><span class="line">            raw_text = response_data[<span class="string">'choices'</span>][<span class="number">0</span>][<span class="string">'message'</span>][<span class="string">'content'</span>]</span><br><span class="line">            translated = parse_translation_result(raw_text, texts)</span><br><span class="line">            print(translated)</span><br><span class="line">            <span class="keyword">return</span> translated</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">f"APIè°ƒç”¨å¤±è´¥: <span class="subst">&#123;str(e)&#125;</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">    <span class="comment"># GPT</span></span><br><span class="line">    <span class="keyword">elif</span> model_choice == <span class="string">"gpt"</span>:</span><br><span class="line">        client = AzureOpenAI(</span><br><span class="line">            azure_endpoint=AZURE_OPENAI_ENDPOINT,</span><br><span class="line">            api_key=AZURE_OPENAI_API_KEY,</span><br><span class="line">            api_version=GPT_API_VERSION</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = client.chat.completions.create(</span><br><span class="line">                model=<span class="string">"gpt-4o-mini"</span>,</span><br><span class="line">                messages=[</span><br><span class="line">                    &#123;<span class="string">"role"</span>: <span class="string">"system"</span>, <span class="string">"content"</span>: system_prompt&#125;,</span><br><span class="line">                    &#123;<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: <span class="string">"è¯·å¼€å§‹ç¿»è¯‘"</span>&#125;</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            raw_text = response.choices[<span class="number">0</span>].message.content</span><br><span class="line">            translated = parse_translation_result(raw_text, texts)</span><br><span class="line">            print(translated)</span><br><span class="line">            <span class="keyword">return</span> translated</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">f"APIè°ƒç”¨å¤±è´¥: <span class="subst">&#123;str(e)&#125;</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_excel</span><span class="params">(input_path, output_path, model_choice)</span>:</span></span><br><span class="line">    print(<span class="string">f"å¼€å§‹è¯»å–Excel <span class="subst">&#123;input_path&#125;</span>"</span>)</span><br><span class="line">    print(<span class="string">f"å½“å‰ä½¿ç”¨çš„å¤§æ¨¡å‹æ˜¯: <span class="subst">&#123;model_choice.upper()&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        wb = openpyxl.load_workbook(input_path)</span><br><span class="line">        sheet = wb.active</span><br><span class="line"></span><br><span class="line">        source_col = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> idx, cell <span class="keyword">in</span> enumerate(sheet[<span class="number">1</span>], <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> cell.value <span class="keyword">and</span> cell.value.strip() == <span class="string">"English"</span>:</span><br><span class="line">                source_col = idx</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> source_col:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"å·¥ä½œè¡¨ä¸­æœªæ‰¾åˆ°'English'åˆ—ï¼Œè¯·æ£€æŸ¥ç¬¬ä¸€è¡Œæ ‡é¢˜"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># éå†æ‰€æœ‰ç›®æ ‡è¯­è¨€åˆ—</span></span><br><span class="line">        <span class="keyword">for</span> col_idx <span class="keyword">in</span> range(<span class="number">1</span>, sheet.max_column + <span class="number">1</span>):</span><br><span class="line">            header_cell = sheet.cell(row=<span class="number">1</span>, column=col_idx)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> header_cell.value:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            lang_name = header_cell.value.strip()</span><br><span class="line">            <span class="keyword">if</span> lang_name == <span class="string">"English"</span> <span class="keyword">or</span> lang_name <span class="keyword">not</span> <span class="keyword">in</span> LANGUAGE_MAPPING:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            print(<span class="string">f"\n=== æ­£åœ¨å¤„ç† <span class="subst">&#123;lang_name&#125;</span> ==="</span>)</span><br><span class="line">            process_language_column(sheet, source_col, col_idx, lang_name, model_choice)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¿å­˜ç»“æœ</span></span><br><span class="line">        wb.save(output_path)</span><br><span class="line">        print(<span class="string">f"\nå¤„ç†å®Œæˆï¼æ–‡ä»¶å·²ä¿å­˜è‡³ï¼š<span class="subst">&#123;output_path&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">f"å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;str(e)&#125;</span>"</span>)</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_language_column</span><span class="params">(sheet, source_col, target_col, lang_name, model_choice)</span>:</span></span><br><span class="line">    <span class="string">"""å¤„ç†å•ä¸ªè¯­è¨€åˆ—"""</span></span><br><span class="line">    batch_texts = []</span><br><span class="line">    batch_positions = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> row_idx <span class="keyword">in</span> range(<span class="number">2</span>, sheet.max_row + <span class="number">1</span>):</span><br><span class="line">        source_cell = sheet.cell(row=row_idx, column=source_col)</span><br><span class="line">        target_cell = sheet.cell(row=row_idx, column=target_col)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è·³è¿‡ç©ºå€¼å’Œå·²ç¿»è¯‘å†…å®¹</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> source_cell.value <span class="keyword">or</span> (target_cell.value <span class="keyword">and</span> str(target_cell.value).strip()):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç»„æˆæ‰¹æ¬¡</span></span><br><span class="line">        batch_texts.append(str(source_cell.value).strip())</span><br><span class="line">        batch_positions.append((row_idx, target_col))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(batch_texts) &gt;= BATCH_SIZE:</span><br><span class="line">            process_batch(sheet, batch_texts, batch_positions, lang_name, model_choice)</span><br><span class="line">            batch_texts.clear()</span><br><span class="line">            batch_positions.clear()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¤„ç†å‰©ä½™æ‰¹æ¬¡</span></span><br><span class="line">    <span class="keyword">if</span> batch_texts:</span><br><span class="line">        process_batch(sheet, batch_texts, batch_positions, lang_name, model_choice)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_batch</span><span class="params">(sheet, texts, positions, lang_name, model_choice)</span>:</span></span><br><span class="line">    print(<span class="string">f"æ­£åœ¨æ‰¹é‡ç¿»è¯‘ <span class="subst">&#123;len(texts)&#125;</span> æ¡æ–‡æœ¬åˆ° <span class="subst">&#123;lang_name&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    translated = []</span><br><span class="line">    <span class="keyword">for</span> retry <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            translated = batch_translate(texts, lang_name, model_choice)</span><br><span class="line">            <span class="keyword">if</span> len(translated) == len(texts):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            print(<span class="string">f"ç¬¬<span class="subst">&#123;retry + <span class="number">1</span>&#125;</span>æ¬¡é‡è¯•..."</span>)</span><br><span class="line">            time.sleep(<span class="number">2</span> ** retry)  <span class="comment"># æŒ‡æ•°sleep</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">f"æ‰¹å¤„ç†å¤±è´¥: <span class="subst">&#123;str(e)&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(translated) != len(texts):</span><br><span class="line">        print(<span class="string">f"æœªèƒ½è·å–å®Œæ•´ç¿»è¯‘ï¼Œé¢„æœŸ<span class="subst">&#123;len(texts)&#125;</span>æ¡ï¼Œå®é™…<span class="subst">&#123;len(translated)&#125;</span>æ¡"</span>)</span><br><span class="line">        translated += [<span class="string">f"[ç¿»è¯‘å¤±è´¥] <span class="subst">&#123;text&#125;</span>"</span> <span class="keyword">for</span> text <span class="keyword">in</span> texts[len(translated):]]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å†™å…¥ç»“æœ</span></span><br><span class="line">    <span class="keyword">for</span> (row, col), text <span class="keyword">in</span> zip(positions, translated):</span><br><span class="line">        cell = sheet.cell(row=row, column=col)</span><br><span class="line">        cell.value = text</span><br><span class="line">        cell.fill = AUTO_TRANSLATE_FILL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">and</span> sys.argv[<span class="number">1</span>] <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">"deepseek"</span>, <span class="string">"gpt"</span>]:</span><br><span class="line">        print(<span class="string">"è¯·æŒ‡å®šæœ‰æ•ˆçš„æ¨¡å‹ï¼Œå¯é€‰å€¼ä¸º [deepseek|gpt]ï¼Œé»˜è®¤ä½¿ç”¨gptã€‚"</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    model_choice = sys.argv[<span class="number">1</span>] <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="string">"gpt"</span></span><br><span class="line">    input_file = os.path.expanduser(<span class="string">'~/Desktop/test2.xlsx'</span>)</span><br><span class="line">    output_file = os.path.expanduser(<span class="string">'~/Desktop/translated_output.xlsx'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        process_excel(input_file, output_file, model_choice)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">f"è¿è¡Œå¤±è´¥: <span class="subst">&#123;str(e)&#125;</span>"</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼</p><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">#gpt</span><br><span class="line"><span class="keyword">python3</span> /Users/<span class="keyword">cc</span>/Desktop/ClassTranslate/autoTranslate.<span class="keyword">py</span></span><br><span class="line">#deepseek</span><br><span class="line"><span class="keyword">python3</span> /Users/<span class="keyword">cc</span>/Desktop/ClassTranslate/autoTranslate.<span class="keyword">py</span> deepseek</span><br></pre></td></tr></table></figure><p>è„šæœ¬é€»è¾‘ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé…ç½®äº†æœ€å¤§tokenæ•°ï¼Œæ”¯æŒåˆ†æ‰¹æ¬¡æ‰¹é‡è¯·æ±‚ï¼Œä¹Ÿè€ƒè™‘äº†ç¿»è¯‘å¤±è´¥ç­‰æƒ…å†µã€‚ç¿»è¯‘å¡«å……åä¼šä¿®æ”¹Excelæ–‡æœ¬æ¡†é¢œè‰²ï¼Œæ–¹ä¾¿äººå·¥æ£€æµ‹ã€‚å¯ä»¥æ ¹æ®å„APPä¸åŒè¯·æ±‚ä¿®æ”¹system_promptä»‹ç»ï¼Œè®©ç¿»è¯‘æ›´å‡†ç¡®ã€‚</p><p>è„šæœ¬Gitåœ°å€ï¼š<a href="https://gitlab.corp.youdao.com/liwc/excelToXilff/-/blob/master/autoTranslate.py" target="_blank" rel="noopener">https://gitlab.corp.youdao.com/liwc/excelToXilff/-/blob/master/autoTranslate.py</a></p><p>æµ‹è¯•Excelåœ°å€ï¼š<a href="https://gitlab.corp.youdao.com/liwc/excelToXilff/-/blob/master/test1.xlsx" target="_blank" rel="noopener">https://gitlab.corp.youdao.com/liwc/excelToXilff/-/blob/master/test1.xlsx</a><br>3.æ•ˆæœæ¼”ç¤º</p><p>DeepSeekæ¼”ç¤ºï¼š</p><video src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202507142008031.mp4" controls="controls"></video><p>GPTæ•ˆæœæ¼”ç¤ºï¼š</p><video src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202507142015187.mp4" controls="controls"></video><p>è¿™ä¸ªè„šæœ¬ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œåªåšæœ¬åœ°Excelæ‰¹é‡ç¿»è¯‘ï¼Œä¹Ÿå¯ä»¥ä¸²è”èµ·iOSå›½é™…åŒ–â€”xliffè‡ªåŠ¨å½•å…¥è„šæœ¬å®ç°Xcodeå›½é™…åŒ–æ–‡æ¡ˆå½•å…¥çº¯è‡ªåŠ¨åŒ–ã€‚å…·ä½“è¿‡ç¨‹ä¸å†é˜è¿°ã€‚</p><p>ä¸²è”æ•ˆæœæ¼”ç¤ºï¼šï¼ˆå¯ä»¥åšåˆ°å…¨è‡ªåŠ¨è°ƒç”¨ è¿™é‡Œæˆ‘åˆ†å¼€æ˜¯ä¸ºäº†æ£€æŸ¥ç¿»è¯‘æ–‡æœ¬è´¨é‡ åç»­è§‰å¾—ç¿»è¯‘ç¨³å®š å°±å¯ä»¥å…¨è‡ªåŠ¨åŒ–ï¼‰</p><video src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202507142023894.mp4" controls="controls"></video>ä½¿ç”¨è¿‡ç¨‹æœ‰ä»»ä½•é—®é¢˜ æ¬¢è¿è”ç³»å’Œäº¤æµï¼š<hr><p>æä¼Ÿç¿</p><p>ç½‘æ˜“æœ‰é“ å›½é™…APPäº§å“éƒ¨</p><p>liweican#corp.netease.com</p><p>æ„Ÿè°¢æ‚¨çš„é˜…è¯»~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨pythonè„šæœ¬é€šè¿‡å¤§æ¨¡å‹APIè¿›è¡Œæ‰¹é‡æ–‡æœ¬ç¿»è¯‘ã€‚æœ¬æ–‡æ˜¯å¯¹ä¹‹å‰Xliffè‡ªåŠ¨å½•å…¥è„šæœ¬çš„è¡¥å……ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¸ªè„šæœ¬æ˜¯å¯¹ä¹‹å‰åœ¨Xcodeä¸Šä½¿ç”¨çš„Xliffè‡ªåŠ¨å½•å…¥è„šæœ¬çš„è¡¥å……ã€‚&lt;br&gt;å…³äºå¦‚ä½•åœ¨Xcodeä¸­ä½¿
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>iOSåŸç”Ÿæ–‡æ¡£æ‰«æå®ç°â€”â€”Vision&amp;CoreImage</title>
    <link href="http://yoursite.com/2023/01/02/iOS%E5%8E%9F%E7%94%9F%E6%96%87%E6%A1%A3%E6%89%AB%E6%8F%8F%E5%AE%9E%E7%8E%B0%E2%80%94%E2%80%94Vision-CoreImage/"/>
    <id>http://yoursite.com/2023/01/02/iOS%E5%8E%9F%E7%94%9F%E6%96%87%E6%A1%A3%E6%89%AB%E6%8F%8F%E5%AE%9E%E7%8E%B0%E2%80%94%E2%80%94Vision-CoreImage/</id>
    <published>2023-01-02T14:28:00.000Z</published>
    <updated>2025-07-18T02:25:21.883Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>å›½é™…è¯å…¸å›¢é˜Ÿè‡´åŠ›äºæ‰“é€ é«˜è´¨é‡å‡ºæµ·å·¥å…·ç±»Appäº§å“çŸ©é˜µï¼Œç›®å‰æ——ä¸‹æœ‰</p><ul><li>è¯å…¸ç¿»è¯‘ç±»ï¼š U-Dictionaryã€One Translate</li><li>è¯­éŸ³è½¬å†™ç±»ï¼šiRecordã€iTranscribe</li><li>ç”µè¯å½•éŸ³ç±»ï¼šiCall Record</li></ul><p>åœ¨2022å¹´åº•ï¼ŒiOSç«¯éœ€è¦å¼€å‘ä¸€ä¸ªæ–°çš„æ–‡æ¡£æ‰«æç±»äº§å“ï¼šiScannerï¼Œæ­¤ç±»äº§å“åœ¨å®‰å“ç«¯å·²ç»éªŒè¯äº†å•†ä¸šåŒ–å¯è¡Œæ€§ã€‚<br>å¼€å‘æ—¶é—´åªæœ‰çŸ­çŸ­å‡ å‘¨ï¼Œéœ€è¦å¿«é€Ÿè¿›è¡ŒæŠ€æœ¯è°ƒç ”å’Œæ–¹æ¡ˆç¡®å®šã€‚<br>æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯ç”¨æˆ·ä½¿ç”¨ç›¸æœºæ‹æ‘„æˆ–ç›¸å†Œé€‰æ‹©å›¾ç‰‡ï¼Œè‡ªåŠ¨æ¡†é€‰å‡ºå›¾ç‰‡å†…çš„æ–‡æ¡£è½®å»“ï¼Œè£å‰ªåè¿›è¡Œæ–¹å‘çŸ«æ­£ã€‚<br>æ‹¿åˆ°çŸ«æ­£åçš„å›¾ç‰‡è°ƒç”¨æœ‰é“è‡ªç ”çš„æ–‡æ¡£å¢åŠ æ¥å£å’Œæ‰‹å†™æ“¦é™¤æ¥å£ã€‚</p><p>å…ˆçœ‹ä¸€ä¸‹æœ€ç»ˆå®ç°æ•ˆæœï¼š<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132305737.gif" alt=""></p><h1 id="æŠ€æœ¯é€‰å‹-amp-å®ç°"><a href="#æŠ€æœ¯é€‰å‹-amp-å®ç°" class="headerlink" title="æŠ€æœ¯é€‰å‹&amp;å®ç°"></a>æŠ€æœ¯é€‰å‹&amp;å®ç°</h1><p>å®¢æˆ·ç«¯éœ€è¦å®ç°çš„æ ¸å¿ƒåŠŸèƒ½æœ‰2ä¸ªï¼š</p><ol><li>æ–‡æ¡£è„šç‚¹æ£€æµ‹</li><li>å›¾ç‰‡æ–¹å‘çŸ«æ­£ï¼ˆé€è§†çŸ«æ­£ï¼‰</li></ol><h4 id="1-è„šç‚¹æ£€æµ‹"><a href="#1-è„šç‚¹æ£€æµ‹" class="headerlink" title="1.è„šç‚¹æ£€æµ‹"></a>1.è„šç‚¹æ£€æµ‹</h4><h5 id="è‡ªç ”SDK"><a href="#è‡ªç ”SDK" class="headerlink" title="è‡ªç ”SDK"></a>è‡ªç ”SDK</h5><p>å®‰å“ç«¯çš„æ–¹æ¡ˆ:</p><ol><li>æ–‡æ¡£è„šç‚¹ç›‘æµ‹ä½¿ç”¨ç®—æ³•ç«¯æä¾›çš„è‡ªç ”SDKï¼Œåº•å±‚æ¨¡å‹ä½¿ç”¨C++å®ç°ï¼Œæ¨ç†æ¡†æ¶ç”¨çš„MNNï¼ˆMobile Neural Networkï¼‰</li><li>å›¾ç‰‡çŸ«æ­£ä½¿ç”¨çš„æ˜¯opencvçš„é€è§†å˜æ¢</li></ol><p>ä¸å¹¸çš„æ˜¯è‡ªç ”æ¨¡å‹å¹¶æ²¡æœ‰æä¾›iOSç«¯çš„SDKï¼Œåº•å±‚ä½¿ç”¨C++éœ€è¦è‡ªå·±æ¡¥æ¥ä¸‹æä¾›ç›¸å…³çš„æ¥å£ã€‚<br>æœ‰é“è¿˜æœ‰ä¸€å¥—åœ¨çº¿çš„æ–‡æ¡£è„šç‚¹æ£€æµ‹æœåŠ¡ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æµ·å¤–ç½‘ç»œç¯å¢ƒå¤æ‚ï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨ç¦»çº¿çš„ã€‚<br>å½“ç„¶opencvä¹Ÿæä¾›è„šç‚¹æ£€æµ‹çš„èƒ½åŠ›ï¼Œä½†æ˜¯è¯†åˆ«ç‡å¤ªå·®ä¸åœ¨è€ƒè™‘èŒƒå›´å†…ã€‚</p><p>é‚£ä¹ˆiOSç«¯æœ‰åŸç”Ÿèƒ½åŠ›æ”¯æŒå—ï¼Ÿå…¶å®ç†Ÿæ‚‰iOSçš„åº”è¯¥éƒ½çŸ¥é“iOSç³»ç»Ÿå¤‡å¿˜å½•æ˜¯æä¾›æ–‡æ¡£æ‰«æçš„ï¼Œå¹¶ä¸”æ•ˆæœå¾ˆå¥½ã€‚<br>ç³»ç»Ÿå†…çš„å¤‡å¿˜å½•æ”¯æŒå¤šå¼ å›¾è¿ç»­æ‰«æï¼Œæ”¯æŒè„šç‚¹ç›‘æµ‹å’Œå›¾ç‰‡æ–¹å‘çŸ«æ­£ã€‚<br>Appleä¹Ÿå¼€æ”¾äº†æ¥å£ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œé‚£å°±æ˜¯<code>VisionKit</code>ä¸‹çš„<code>VNDocumentCameraViewController</code></p><h5 id="VisionKit"><a href="#VisionKit" class="headerlink" title="VisionKit"></a>VisionKit</h5><p>VisionKitæ˜¯iOS13æ¨å‡ºçš„ï¼Œä¸º iOS æä¾›äº†å›¾åƒå’Œå®æ—¶è§†é¢‘ä¸­çš„æ–‡æœ¬ã€ç»“æ„åŒ–æ•°æ®çš„æ£€æµ‹åŠŸèƒ½ã€‚<br>VisionKitæœ¬è´¨ä¸Šæ˜¯å¯¹Visionçš„å°è£…ï¼Œ<br>è€ŒVisionKitä¸‹<code>VNDocumentCameraViewController</code>æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132304793.gif" alt=""><br>å…¶å†…ç½®äº†è„šç‚¹è‡ªåŠ¨æ£€æµ‹ï¼Œè„šç‚¹æ‹–æ‹½è°ƒæ•´ç­‰äº¤äº’ã€‚æ”¯æŒä»è§†é¢‘bufferæµä¸­ç›´æ¥æ£€æµ‹ã€‚<br>ä½†æ˜¯VNDocumentCameraViewControllerå°è£…çš„éå¸¸æ­»ï¼Œæ— æ³•ä¿®æ”¹å†…éƒ¨ä»»ä½•UIå’Œäº¤äº’æµç¨‹ï¼Œæ‰€ä»¥åªèƒ½pass</p><p>æ›´å¤šå…³äºVisionKitçš„ä¿¡æ¯å‚è€ƒï¼š<br><a href="https://developer.apple.com/documentation/visionkit" target="_blank" rel="noopener">Visionkit Documentation</a><br><a href="https://developer.apple.com/documentation/visionkit/vndocumentcameraviewcontroller" target="_blank" rel="noopener">VNDocumentCameraViewController</a></p><h5 id="Vision"><a href="#Vision" class="headerlink" title="Vision"></a>Vision</h5><p>æ—¢ç„¶<code>VisionKit</code>æ˜¯åŸºäº<code>Vision</code>çš„å°è£…ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥åŸºäºVisionè‡ªå·±æ¥å®ç°æ‰€æœ‰åŠŸèƒ½<br><code>VNDocumentCameraViewController</code>åˆšæ¨å‡ºæ—¶å€™å½“æ—¶çš„åº•å±‚æŠ€æœ¯æ˜¯åŸºäº<code>Vision</code>çš„<code>VNDetectRectanglesRequest</code><br><code>VNDetectRectanglesRequest</code>ä¼šç›‘æµ‹å›¾ç‰‡ä¸­æ‰€æœ‰çŸ©å½¢å¹¶è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œä¾èµ–<code>VNDetectRectanglesRequest</code>å†åŠ ä¸ŠåæœŸç®—æ³•ï¼Œæ˜¯å¯ä»¥è¿›è¡Œæ–‡æ¡£æ£€æµ‹çš„ã€‚</p><p>ä½†æ˜¯Appleåœ¨iOS15æ—¶å€™å‘å¸ƒäº†æ–°API<code>VNDetectDocumentSegmentationRequest</code><br>çœ‹APIçš„åå­—å°±èƒ½çŸ¥é“æ˜¯é’ˆå¯¹æ–‡æ¡£è¿›è¡Œäº†å•ç‹¬ä¼˜åŒ–çš„ï¼Œé‚£ä¹ˆ<code>VNDetectDocumentSegmentationRequest</code>æ¯”<code>VNDetectRectanglesRequest</code>å‰å®³åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132301313.png" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒåŒä¸€å¼ å›¾ç‰‡ï¼ŒVNDetectRectanglesRequestæ£€æµ‹å‡ºäº†æ‰€æœ‰çŸ©å½¢ï¼Œè€ŒVNDetectDocumentSegmentationRequestå‡†ç¡®çš„æ£€æµ‹å‡ºäº†æ–‡æ¡£ã€‚<br>åœ¨åº•å±‚æŠ€æœ¯ä¸Šï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132301486.png" alt=""></p><p><code>DocumentSegmentation</code>åŸºäºæœºå™¨å­¦ä¹ å¹¶ä¸”èƒ½å¤Ÿè¿è¡Œåœ¨NEï¼ˆç¥ç»ç½‘ç»œå¼•æ“ï¼‰,CPUæˆ–è€…GPUä¸Šé¢ï¼Œè€Œ<code>VNDetectRectanglesRequest</code>åªèƒ½åœ¨CPUä¸Šè¿è¡Œï¼Œè¿è¡Œé€Ÿåº¦ä¸Šå°±æ‹‰å¼€äº†å¾ˆå¤§å·®è·ã€‚<br><code>DocumentSegmentation</code>è¿˜èƒ½è¯†åˆ«å‡ºéçŸ©å½¢å½¢çŠ¶çš„æ–‡æ¡£ï¼Œè¿˜èƒ½æä¾›maskå’Œé¡¶è§’ç‚¹åæ ‡ã€‚<br>æ›´é‡è¦çš„æ˜¯<code>VNDetectDocumentSegmentationRequest</code>åªä¼šè¯†åˆ«å‡ºä¸€ä¸ªæ–‡æ¡£è€Œä¸ä¼šæ£€æµ‹å‡ºå¤šä¸ªçŸ©å½¢ï¼Œè¿™æ— ç–‘å‡è½»äº†å¾ˆå¤šå·¥ä½œé‡ï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚</p><blockquote><p>å¦å¤–ï¼Œ<code>Visionkit</code>ä¸­çš„<code>VNDocumentCameraViewController</code>åº•å±‚æŠ€æœ¯ï¼Œåœ¨iOS15ä¹‹åä¹Ÿå·²ç»æ›¿æ¢æˆäº†<code>VNDetectDocumentSegmentationRequest</code></p></blockquote><h5 id="VNDetectDocumentSegmentationRequest"><a href="#VNDetectDocumentSegmentationRequest" class="headerlink" title="VNDetectDocumentSegmentationRequest"></a>VNDetectDocumentSegmentationRequest</h5><p>VNDetectDocumentSegmentationRequestçš„ä½¿ç”¨éå¸¸ç®€å•</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">recognize</span><span class="params">(image: UIImage)</span></span> -&gt; <span class="type">VNRectangleObservation?</span> &#123;</span><br><span class="line">      nextBtn.isEnabled = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> cgImage = image.cgImage <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">      <span class="keyword">let</span> documentSegmentationHandler = <span class="type">VNImageRequestHandler</span>(cgImage: cgImage)</span><br><span class="line">      <span class="keyword">let</span> documentSegmentationRequest = <span class="type">VNDetectDocumentSegmentationRequest</span>()</span><br><span class="line">      documentSegmentationRequest.revision = <span class="type">VNDetectDocumentSegmentationRequestRevision1</span></span><br><span class="line">      <span class="keyword">try</span>? documentSegmentationHandler.perform([documentSegmentationRequest])</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> result = documentSegmentationRequest.results?.first &#123;</span><br><span class="line">          <span class="built_in">print</span>(result.confidence)</span><br><span class="line">          <span class="keyword">if</span> result.confidence &gt; <span class="number">0.7</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> result</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"æœªæ£€æµ‹åˆ°æ–‡æ¡£"</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<br>åœ¨ä¼ å…¥å›¾ç‰‡å‰è¯·å¤„ç†å¥½å›¾ç‰‡çš„imageOrientation<br>VNImageRequestHandlerä¹Ÿæ”¯æŒciImageçš„åˆå§‹åŒ–ï¼Œå¯ä»¥åˆç†é€‰æ‹©ä½¿ç”¨æ–¹å¼</p></blockquote><p>åœ¨resultä¸­ä¼šè¿”å›ä¸€ä¸ªç½®ä¿¡åº¦ï¼Œä¸€èˆ¬è®¾ç½®å¤§äº0.7å°±è®¤ä¸ºè¯†åˆ«æœ‰æ•ˆï¼Œå…·ä½“å‚æ•°å¯ä»¥åŠ¨æ€è°ƒæ•´ã€‚<br>è¿”å›ç»“æœæ˜¯<code>VNRectangleObservation</code>ç±»å‹</p><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@available(iOS 11.0, *)</span></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNRectangleObservation</span> : <span class="type">VNDetectedObjectObservation &#123;</span></span></span><br><span class="line">    <span class="meta">@available(iOS 13.0, *)</span></span><br><span class="line">    <span class="keyword">public</span> convenience <span class="keyword">init</span>(requestRevision: <span class="built_in">Int</span>, topLeft: CGPoint, bottomLeft: CGPoint, bottomRight: CGPoint, topRight: CGPoint)</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> topLeft: CGPoint &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> topRight: CGPoint &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> bottomLeft: CGPoint &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> bottomRight: CGPoint &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹å‰ç”¨è¿‡Visionçš„åŒå­¦è‚¯å®šå¾ˆç†Ÿæ‚‰çˆ¶ç±»<code>VNDetectedObjectObservation</code>,åœ¨<code>VNDetectedObjectObservation</code>ä¸­æœ‰ä¸€ä¸ª<code>boundingBox</code>ç†Ÿæ‚‰</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment">    @brief The bounding box of the detected object. The coordinates are normalized to the dimensions of the processed image, with the origin at the image's lower-left corner.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGRect</span> boundingBox;</span><br></pre></td></tr></table></figure><p><code>boundingBox</code> ä¸­çš„åæ ‡è¢«å½’ä¸€åŒ–ï¼Œæ„å‘³ç€ xã€yã€å®½åº¦å’Œé«˜åº¦éƒ½æ˜¯ 0.0 åˆ° 1.0 ä¹‹é—´çš„å°æ•°ï¼ŒåŒæ—¶åŸç‚¹ (0,0) åœ¨å·¦ä¸‹è§’ï¼Œè¿™äº›éƒ½éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥è½¬æ¢ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132301074.png" alt=""><br>åŒæ ·åœ¨æ–‡æ¡£è„šç‚¹æ£€æµ‹ä¸­è¿”å›çš„å››ä¸ªè„šç‚¹<code>topLeft</code>,<code>topRight</code>,<code>bottomLeft</code>,<code>bottomRight</code>,ä¹Ÿæ˜¯å½’ä¸€åŒ–çš„ï¼Œèµ·ç‚¹åœ¨å·¦ä¸‹è§’ï¼Œéœ€è¦è¿›è¡Œåæ ‡è½¬æ¢åæ‰èƒ½åœ¨å›¾ç‰‡ä¸Šå±•ç¤ºè¯†åˆ«æ¡†ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œå…ˆæŠŠåŸå›¾è¿›è¡Œ<code>imageOrientation</code>å¤„ç†å’Œå°ºå¯¸å‹ç¼©ï¼Œå±•ç¤ºåœ¨å±å¹•ä¸Šåå»ºç«‹ä¸€ä¸ªå’Œå±•ç¤ºimageå¤§å°ä¸€è‡´çš„CALayerå›¾å±‚ï¼Œåç»­æ¡†ä½“å±•ç¤ºã€æ‹–æ‹½ã€æ—‹è½¬ç­‰éƒ½æ–¹ä¾¿å¤„ç†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132302468.png" alt=""><br>åæ ‡è½¬æ¢ä»£ç </p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> size = self.pathLayer!.bounds</span><br><span class="line">var transform: CGAffineTransform</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="module-access"><span class="module"><span class="identifier">UIApplication</span>.</span></span>shared.statusBarOrientation.isLandscape &#123;</span><br><span class="line">    transform = <span class="module-access"><span class="module"><span class="identifier">CGAffineTransform</span>.</span></span>identity</span><br><span class="line">        .scaled<span class="constructor">By(<span class="params">x</span>: -1, <span class="params">y</span>: 1)</span></span><br><span class="line">        .translated<span class="constructor">By(<span class="params">x</span>: -<span class="params">size</span>.<span class="params">width</span>, <span class="params">y</span>: 0)</span></span><br><span class="line">        .scaled<span class="constructor">By(<span class="params">x</span>: <span class="params">size</span>.<span class="params">width</span>, <span class="params">y</span>: <span class="params">size</span>.<span class="params">height</span>)</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    transform = <span class="module-access"><span class="module"><span class="identifier">CGAffineTransform</span>.</span></span>identity</span><br><span class="line">        .scaled<span class="constructor">By(<span class="params">x</span>: 1, <span class="params">y</span>: -1)</span></span><br><span class="line">        .translated<span class="constructor">By(<span class="params">x</span>: 0, <span class="params">y</span>: -<span class="params">size</span>.<span class="params">height</span>)</span></span><br><span class="line">        .scaled<span class="constructor">By(<span class="params">x</span>: <span class="params">size</span>.<span class="params">width</span>, <span class="params">y</span>: <span class="params">size</span>.<span class="params">height</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è½¬æ¢ä¸ºUIKitåæ ‡ç³»</span></span><br><span class="line">convertedTopLeft = result.topLeft.applying(transform)</span><br><span class="line">convertedTopRight = result.topRight.applying(transform)</span><br><span class="line">convertedBottomLeft = result.bottomLeft.applying(transform)</span><br><span class="line">convertedBottomRight = result.bottomRight.applying(transform)</span><br></pre></td></tr></table></figure><p>å½“ç„¶åªæ˜¯æ¡†é€‰å‡ºæ¥æ–‡æ¡£æ¡†æ¶æ‰æ˜¯ç¬¬ä¸€æ­¥ï¼Œç”¨æˆ·è¿˜èƒ½æ‹–æ‹½è„šç‚¹ç¼–è¾‘æ¡†é€‰åŒºåŸŸã€‚æ‰€ä»¥åæ ‡ç‚¹è¿˜éœ€è¦åå‘è½¬æ¢ã€‚<br>åšæ¡†é€‰ä¸­ï¼Œè¿˜éœ€è¦åˆ¤æ–­çŸ©å½¢æ˜¯å¦æœ‰æ•ˆï¼ˆå†…è§’æ˜¯å¦å¤§äº180åº¦ï¼‰ï¼Œå¯ä»¥æ ¹æ®å¯¹è§’çº¿ <code>ac</code> å’Œ <code>bd</code> å¯¹è§’çº¿æ˜¯å¦äº¤å‰ æ ¹æ®å‰ç§¯(å‘é‡ç§¯)è®¡ç®—<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132305134.gif" alt=""></p><p>å·®ç§¯ç®—æ³•</p><figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> func checkInnerAngleAvailable() -&gt; Bool &#123;</span><br><span class="line">       let <span class="keyword">x</span><span class="number">1</span> = self.topLeftPoint.<span class="keyword">x</span></span><br><span class="line">       let y<span class="number">1</span> = self.topLeftPoint.y</span><br><span class="line">       let <span class="keyword">x</span><span class="number">2</span> = self.bottomRightPoint.<span class="keyword">x</span></span><br><span class="line">       let y<span class="number">2</span> = self.bottomRightPoint.y</span><br><span class="line">       let <span class="keyword">x</span><span class="number">3</span> = self.bottomLeftPoint.<span class="keyword">x</span></span><br><span class="line">       let y<span class="number">3</span> = self.bottomLeftPoint.y</span><br><span class="line">       let <span class="keyword">x</span><span class="number">4</span> = self.topRightPoint.<span class="keyword">x</span></span><br><span class="line">       let y<span class="number">4</span> = self.topRightPoint.y</span><br><span class="line">       </span><br><span class="line">       if <span class="keyword">max</span>(<span class="keyword">x</span><span class="number">1</span>, <span class="keyword">x</span><span class="number">2</span>) &lt; <span class="keyword">min</span>(<span class="keyword">x</span><span class="number">3</span>, <span class="keyword">x</span><span class="number">4</span>) || <span class="keyword">max</span>(y<span class="number">1</span>, y<span class="number">2</span>) &lt; <span class="keyword">min</span>(y<span class="number">3</span>, y<span class="number">4</span>) || <span class="keyword">min</span>(<span class="keyword">x</span><span class="number">1</span>, <span class="keyword">x</span><span class="number">2</span>) &gt; <span class="keyword">max</span>(<span class="keyword">x</span><span class="number">3</span>, <span class="keyword">x</span><span class="number">4</span>) || <span class="keyword">min</span>(y<span class="number">1</span>, y<span class="number">2</span>) &gt; <span class="keyword">max</span>(y<span class="number">3</span>, y<span class="number">4</span>) &#123;</span><br><span class="line">           return <span class="keyword">false</span></span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       if ((<span class="keyword">x</span><span class="number">3</span> - <span class="keyword">x</span><span class="number">1</span>) * (y<span class="number">3</span> - y<span class="number">4</span>) - (y<span class="number">3</span> - y<span class="number">1</span>) * (<span class="keyword">x</span><span class="number">3</span> - <span class="keyword">x</span><span class="number">4</span>)) * (</span><br><span class="line">                  (<span class="keyword">x</span><span class="number">3</span> - <span class="keyword">x</span><span class="number">2</span>) * (y<span class="number">3</span> - y<span class="number">4</span>) - (y<span class="number">3</span> - y<span class="number">2</span>) * (<span class="keyword">x</span><span class="number">3</span> - <span class="keyword">x</span><span class="number">4</span>)) &lt;= <span class="number">0</span> &amp;&amp; (</span><br><span class="line">                  (<span class="keyword">x</span><span class="number">1</span> - <span class="keyword">x</span><span class="number">3</span>) * (y<span class="number">1</span> - y<span class="number">2</span>) - (y<span class="number">1</span> - y<span class="number">3</span>) * (<span class="keyword">x</span><span class="number">1</span> - <span class="keyword">x</span><span class="number">2</span>)) * (</span><br><span class="line">                   (<span class="keyword">x</span><span class="number">1</span> - <span class="keyword">x</span><span class="number">4</span>) * (y<span class="number">1</span> - y<span class="number">2</span>) - (y<span class="number">1</span> - y<span class="number">4</span>) * (<span class="keyword">x</span><span class="number">1</span> - <span class="keyword">x</span><span class="number">2</span>)) &lt;= <span class="number">0</span> &#123;</span><br><span class="line">           return <span class="keyword">true</span></span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       return <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè„šç‚¹ç›‘æµ‹çš„æœ€ç»ˆæ–¹æ¡ˆä¹Ÿå®šä¸‹æ¥äº†ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹å„ä¸ªæ–¹æ³•çš„è¯†åˆ«å¯¹æ¯”<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132307587.png;%20charset=binary" alt=""><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132307167.png;%20charset=binary" alt=""><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132308623.png;%20charset=binary" alt=""></p><blockquote><p>å¯ä»¥çœ‹åˆ°Apple Visionä¸‹çš„<code>VNDetectDocumentSegmentationRequest</code>æ£€æµ‹æ•ˆæœæ˜¯ä¼˜äºè‡ªç ”æ¨¡å‹çš„ï¼Œéƒ¨åˆ†badcaseæ•ˆæœè¿˜è¶…è¿‡ä¹Ÿç«å“ã€‚<br>å½“ç„¶å”¯ä¸€çš„é™åˆ¶å°±æ˜¯iOS15+æ‰èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯å‚è€ƒAppleæä¾›çš„ç³»ç»Ÿå æ¯”æ•°æ®ï¼Œæˆªæ­¢åˆ°2022å¹´5æœˆ iOS15ä»¥ä¸Šå æ¯”89%<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132308674.png" alt=""><br>update:<br>Appleåœ¨<code>2023å¹´2æœˆ14æ—¥å…¬å¸ƒäº†æœ€æ–°æ•°æ®ï¼ŒiOS15ä»¥ä¸Šå æ¯”96%</code><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132308595.png" alt=""></p></blockquote><p>åˆ°æ­¤å·²ç»å®Œæˆäº†æ–‡æ¡£è„šç‚¹æ£€æµ‹ï¼Œæ¥ä¸‹æ¥è¦è§£å†³å›¾ç‰‡è§†è§‰çŸ«æ­£ã€‚</p><h4 id="2-é€è§†çŸ«æ­£"><a href="#2-é€è§†çŸ«æ­£" class="headerlink" title="2.é€è§†çŸ«æ­£"></a>2.é€è§†çŸ«æ­£</h4><p>å›¾ç‰‡çŸ«æ­£(é€è§†çŸ«æ­£)åœ¨OCRä¸­å¹¿æ³›ä½¿ç”¨ï¼Œä¸»æµåšæ³•å°±æ˜¯ä½¿ç”¨opencvè¿›è¡Œå¤„ç†ã€‚<br>åŸç†æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬æ˜¯è¾¹ç¼˜æŠ•å½±çš„ã€Houghå˜æ¢ã€çº¿æ€§æ‹Ÿåˆï¼Œå‚…é‡Œå¶å˜æ¢å›¾åƒé¢‘åŸŸç­‰æ–¹æ³•ã€‚è¿™é‡Œä¸å†å±•å¼€è®²äº†ã€‚</p><p>å¹¶ä¸”opencvé‡Œé¢å¸¸ç”¨çš„æ˜¯çŸ©å½¢ç›‘æµ‹å’ŒçŸ«æ­£ä¸€èµ·ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€éƒ¨åˆ†å·²ç»å®Œæˆäº†è„šç‚¹æ£€æµ‹ï¼Œåªæ˜¯åšçŸ©å½¢çŸ«æ­£å°±æ²¡å¿…è¦å†ç”¨opencväº†ã€‚</p><p>Apple VisionKitä¸­çš„<code>VNDocumentCameraViewController</code>æ˜¯æ”¯æŒæ–¹å‘çŸ«æ­£çš„ï¼Œé‚£ä¹ˆAppleè‡ªèº«æä¾›çš„APIåº”è¯¥æ˜¯å¯ä»¥å®ç°çš„ã€‚</p><p>é‚£æåˆ°Appleå†…ç½®çš„å›¾åƒå¤„ç†ï¼Œè‚¯å®šå°±ç»•ä¸å¼€<code>CoreImage</code>äº†</p><p><code>CoreImage</code>å¯ä»¥å®ç°å¤šç§å¤šæ ·çš„æ»¤é•œæ•ˆæœï¼Œæ»¤é•œä¸€èˆ¬åŸºäº<code>CIFilter</code>,åœ¨<code>CIFilter</code>ä¸­å°±æœ‰ç°æˆçš„çŸ©å½¢çŸ«æ­£ç®—æ³•ã€‚</p><p>æ›´å¤šå…³äºCoreImageçš„ä¿¡æ¯å‚è€ƒï¼š<br><a href="https://developer.apple.com/documentation/coreimage" target="_blank" rel="noopener">Core Image</a><br><a href="https://developer.apple.com/documentation/coreimage/cifilter" target="_blank" rel="noopener">CIFilter</a></p><h5 id="CIFilter"><a href="#CIFilter" class="headerlink" title="CIFilter"></a>CIFilter</h5><p>è¦å®ç°çŸ«æ­£ï¼Œé¦–å…ˆè¦æŠŠè„šç‚¹æ£€æµ‹å4ä¸ªç‚¹å½¢æˆçš„å›¾ç‰‡è£å‰ªå‡ºæ¥ã€‚4ä¸ªç‚¹æ˜¯å½’ä¸€åŒ–åçš„ï¼Œå…ˆæŠŠå›¾ç‰‡è¿›è¡ŒCIImageè½¬æ¢,è°ƒç”¨croppedæ–¹æ³•è¿›è¡Œè£å‰ªã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">clipAction</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> image = <span class="keyword">self</span>.cleanImage</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> ciImage = <span class="keyword">self</span>.cleanImage.ciImage ?? <span class="type">CIImage</span>(image: <span class="keyword">self</span>.imageView.image!) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">                </span><br><span class="line">        <span class="comment">//é‡æ–°è®¡ç®—resultObservation</span></span><br><span class="line">        <span class="comment">//self.updateResultObservation()</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">DispatchQueue</span>.global().async &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> result = <span class="keyword">self</span>.resultObservation &#123;</span><br><span class="line">                <span class="keyword">let</span> imageSize = ciImage.extent.size</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">let</span> boundingBox = result.boundingBox.scaled(to: imageSize)</span><br><span class="line">                <span class="keyword">let</span> tmpImage = ciImage</span><br><span class="line">                    .cropped(to: boundingBox)</span><br><span class="line">                &#125;</span><br><span class="line">             &#125;</span><br><span class="line">                ......</span><br><span class="line">                ......</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//scaledæ˜¯ä¸€ä¸ªextension</span></span><br><span class="line">    <span class="class"><span class="keyword">extension</span> <span class="title">CGRect</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">scaled</span><span class="params">(to size: CGSize)</span></span> -&gt; <span class="type">CGRect</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">CGRect</span>(</span><br><span class="line">            x: <span class="keyword">self</span>.origin.x * size.width,</span><br><span class="line">            y: <span class="keyword">self</span>.origin.y * size.height,</span><br><span class="line">            width: <span class="keyword">self</span>.size.width * size.width,</span><br><span class="line">            height: <span class="keyword">self</span>.size.height * size.height</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°è£å‰ªåçš„å›¾ç‰‡ï¼Œå°±å¯ä»¥è¿›è¡Œé€è§†çŸ«æ­£äº†ï¼ŒiOSä¸­é€è§†çŸ«æ­£ä½¿ç”¨<code>CIVector</code><br><code>CIVector</code>éœ€è¦æ­é…<code>CIFilter</code>ä½¿ç”¨ï¼Œå¯ä»¥äº§ç”Ÿä¸°å¯Œçš„æ•ˆæœ</p><p>åœ†å½¢ç¼ ç»•è¿‡æ»¤å™¨</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> newImage = applying<span class="constructor">Filter(CICircularWrap, <span class="params">parameters</span>: [<span class="params">kCIInputImageKey</span>: <span class="params">image</span>, <span class="params">kCIInputCenterKey</span> : CIVector.<span class="params">init</span>(<span class="params">x</span>: 100, <span class="params">y</span>: 200)</span>, kCIInputRadiusKey : <span class="number">20</span>, kCIInputAngleKey : <span class="number">3</span>])</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132308858.png" alt=""><br>è¾¹ç¼˜é‡‡æ ·è¿‡æ»¤å™¨</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">applying<span class="constructor">Filter(<span class="string">"CIEdgePreserveUpsampleFilter"</span>, <span class="params">parameters</span>: [<span class="params">kCIInputImageKey</span>: <span class="params">image</span>, <span class="params">inputLumaSigma</span> : 0.15, <span class="params">inputSpatialSigma</span> : 3, <span class="params">inputSmallImage</span> : <span class="params">image2</span>])</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132309709.png" alt=""></p><p>è€Œæˆ‘ä»¬è¦ä½¿ç”¨çš„å°±æ˜¯çŸ©å½¢çŸ«æ­£è¿‡æ»¤å™¨<code>CIPerspectiveCorrection</code></p><p>ä¸‹é¢æ˜¯åšçš„ä¸€ä¸ªExtension,åªéœ€è¦ä¼ é€’å››ä¸ªè¿˜åŸåçš„åæ ‡å³å¯å®ŒæˆçŸ«æ­£</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CIImage</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">perspectiveCorrect</span><span class="params">(by observation: VNRectangleObservation, imageSize: CGSize?)</span></span> -&gt; <span class="type">CIImage</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> imageSize = imageSize ?? <span class="keyword">self</span>.extent.size</span><br><span class="line">        <span class="keyword">let</span> newImage =</span><br><span class="line">        applyingFilter(<span class="string">"CIPerspectiveCorrection"</span>, parameters: [</span><br><span class="line">            <span class="string">"inputTopLeft"</span>: <span class="type">CIVector</span>(cgPoint: observation.topLeft.scaled(to: imageSize)),</span><br><span class="line">            <span class="string">"inputTopRight"</span>: <span class="type">CIVector</span>(cgPoint: observation.topRight.scaled(to: imageSize)),</span><br><span class="line">            <span class="string">"inputBottomLeft"</span>: <span class="type">CIVector</span>(cgPoint: observation.bottomLeft.scaled(to: imageSize)),</span><br><span class="line">            <span class="string">"inputBottomRight"</span>: <span class="type">CIVector</span>(cgPoint: observation.bottomRight.scaled(to: imageSize))</span><br><span class="line">        ])</span><br><span class="line">        <span class="keyword">return</span> newImage</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CGPoint</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">scaled</span><span class="params">(to size: CGSize)</span></span> -&gt; <span class="type">CGPoint</span> &#123;</span><br><span class="line">        <span class="type">CGPoint</span>(x: x * size.width,</span><br><span class="line">                y: y * size.height)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹çŸ«æ­£æ•ˆæœ<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132309782.gif" alt=""></p><hr><p>è‡³äºå…¶ä½™åŠŸèƒ½æ¯”å¦‚æœ€å°è£å‰ªå¤§å°ï¼Œæ—‹è½¬ï¼Œé•œåƒç­‰åŠŸèƒ½å°±ä¸å†è®¨è®ºäº†ã€‚è‡³æ­¤å·²ç»å®Œæˆäº†æ–‡æ¡£æ‰«æçš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p><p>ä¼˜ç‚¹æœ‰å¾ˆå¤š</p><ul><li>çº¯ç¦»çº¿ï¼Œæ— ç½‘ç»œè¦æ±‚</li><li>è„šç‚¹æ£€æµ‹é€Ÿåº¦å¿«ï¼Œèƒ½è¿è¡Œåœ¨GPUä¸Š</li><li>çº¯åŸç”Ÿæ”¯æŒï¼Œä¸ä¾èµ–ä¸‰æ–¹åº“</li><li>æ•ˆæœä¼˜äºè‡ªç ”SDK</li></ul><p>iScannerç›®å‰å·²ç»ä¸Šçº¿ï¼Œæ¬¢è¿å¤§å®¶å»ä½“éªŒï¼Œå¦‚æœæœ‰å…¶ä»–ç–‘é—®ä¹Ÿå¯ä»¥å’Œæˆ‘è”ç³»</p><blockquote><p>æä¼Ÿç¿<br>ç½‘æ˜“æœ‰é“-å›½é™…App<br>liweican#corp.netease.com</p></blockquote><p>æ„Ÿè°¢é˜…è¯»~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;å›½é™…è¯å…¸å›¢é˜Ÿè‡´åŠ›äºæ‰“é€ é«˜è´¨é‡å‡ºæµ·å·¥å…·ç±»Appäº§å“çŸ©é˜µï¼Œç›®å‰æ——ä¸‹æœ‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯å…¸ç¿»è¯‘ç±»ï¼š U-Dictionaryã€One 
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>iOSæŠ•æ”¾å½’å› â€”SKAN3.0å®æˆ˜</title>
    <link href="http://yoursite.com/2022/08/19/iOS%E6%8A%95%E6%94%BE%E5%BD%92%E5%9B%A0%E2%80%94SKAN3-0%E5%AE%9E%E6%88%98/"/>
    <id>http://yoursite.com/2022/08/19/iOS%E6%8A%95%E6%94%BE%E5%BD%92%E5%9B%A0%E2%80%94SKAN3-0%E5%AE%9E%E6%88%98/</id>
    <published>2022-08-19T14:34:00.000Z</published>
    <updated>2025-07-14T07:58:50.590Z</updated>
    
    <content type="html"><![CDATA[<p>èƒŒæ™¯</p><p>åœ¨iOS14.5ä»¥åAppleå¯ç”¨ATTï¼ˆAppTransparencyTrackingï¼‰ã€‚ATT æ„å‘³ç€ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ”¶é›†æœ‰å…³æœ€ç»ˆç”¨æˆ·çš„æ•°æ®å¹¶ä¸å…¶ä»–å…¬å¸å…±äº«ä»¥è·¨åº”ç”¨ç¨‹åºå’Œç½‘ç«™è¿›è¡Œè·Ÿè¸ªï¼ˆIDFAï¼‰ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ ATT åŒæ„æç¤ºå¹¶åœ¨å‘å¸ƒå•†å’Œå¹¿å‘Šå•†åº”ç”¨ç¨‹åºä¸­è·å¾—ç”¨æˆ·åŒæ„ã€‚å¦‚æœä¸è·Ÿè¸ªï¼Œåˆ™æ— éœ€æ˜¾ç¤ºæç¤ºã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132252093.png" alt=""></p><p>ATTæ”¿ç­–æ­£åœ¨åŠ é€Ÿç§»åŠ¨å¹¿å‘Šè¡Œä¸šè·ƒå˜ï¼Œç”¨äºå¹¿å‘Šè¿½è¸ªçš„ IDFA æˆ–å°†é€æ¸æ·¡å‡ºå†å²èˆå°ï¼Œè‡³æ­¤iOSè¿›å…¥åIDFAæ—¶ä»£ã€‚</p><p>Appleç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ­£æ˜¯SKAdNetWork(SKAN),ä½†æ˜¯SKANå¹¶ä¸æ˜¯iOS14.5ä¹‹åæ‰å‘å¸ƒçš„ï¼ŒSKAN 1.0æ˜¯Appleäº2018å¹´æ¨å‡ºçš„APIï¼Œåœ¨iOS14.5æ¨å‡ºATTåæ¨å‡º2.0ã€‚åç»­æ›´æ–°åˆ°äº†3.0ç‰ˆæœ¬ï¼Œåœ¨iOS16.1åæ¨å‡ºäº†å…¨æ–°çš„SKAN 4.0ç‰ˆæœ¬ã€‚</p><p>å¤§è§„æ¨¡çš„ä½¿ç”¨æ˜¯åœ¨SKAN 3.0ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯åœ¨3.0ç‰ˆæœ¬å¼€å§‹æ¥å…¥ã€‚ä¸‹é¢å…ˆç®€å•ä»‹ç»ä¸‹SKANå½’å› çš„åŸç†ã€‚</p><p>SKAN3.0å½’å› æµç¨‹</p><p>ä¸‹é¢æ˜¯å½’å› çš„æµç¨‹å›¾ï¼Œçœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼Œå…ˆææ˜ç™½å‡ ä¸ªæ¦‚å¿µã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132254060.png" alt=""></p><p>1.Conversion value (CV)</p><p>ä¸Šå›¾æœ‰2ä¸ªæ–¹æ³•registerAppforAdNetworkattribution()å’ŒupdateConversionValue(:_)</p><p>updateConversionValue(:_)æåˆ°äº†ConversionValueå°±æ˜¯å½’å› çš„é‡ç‚¹ã€‚</p><p>ä½ å¯ä»¥ç†è§£æˆAppleæœ€åå›ä¼ ç»™å¹¿å‘Šä¸»çš„å°±æ˜¯è¿™ä¸ªCVå€¼ï¼Œå–å€¼èŒƒå›´åœ¨0-63ä¹‹é—´ã€‚</p><p>ä¸ºä»€ä¹ˆæ˜¯0-63å‘¢ï¼Œå› ä¸ºè¿™ä¸ªCVæ˜¯ä¸€ä¸ª6bitçš„å€¼ï¼Œåœ¨äºŒè¿›åˆ¶ä¸­å–å€¼èŒƒå›´ä¸­å°±æ˜¯0-63ä¹‹é—´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132254389.png" alt=""></p><p>SKANçš„é‡ç‚¹å°±æ˜¯åˆç†åˆ©ç”¨è¿™ä¸ª64ä¸ªæ•°</p><p>CVå€¼æ˜¯å¯ä»¥æ›´æ–°çš„ï¼Œè°ƒç”¨updateConversionValueå³å¯æ›´æ–°ã€‚ä½†æ˜¯æ–°çš„å€¼å¿…é¡»æ¯”æ—§çš„å¤§ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚</p><p>2.è®¡æ—¶å™¨æŒ‘æˆ˜</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132255621.png" alt=""></p><p>Appleåœ¨SKANä¸­è®¾è®¡äº†ä¸€ä¸ªè®¡æ—¶å™¨åŠŸèƒ½ï¼ŒAppé¦–æ¬¡å®‰è£…æ—¶å€™é¦–å…ˆè°ƒç”¨registerAppforAdNetworkattribution()</p><p>å¼€å‘è€…å¯ä»¥åœ¨24å°æ—¶çš„å¾ªç¯å‘¨æœŸå†…åå¤è°ƒç”¨updateConversionValueï¼š å»æ›´æ–°è½¬åŒ–æ•°å€¼ã€‚</p><p>è°ƒç”¨æ­¤æ–¹æ³•æœ‰ä¸¤ä¸ªç›®çš„ï¼š </p><p>äº§ç”Ÿä¸€ä¸ªå®‰è£…é€šçŸ¥,æ˜¯ä¸€ä¸ªåŠ å¯†ç­¾åçš„æ•°æ®åŒ…,ç”¨äºéªŒè¯æ˜¯å¦æ¥è‡ªå¹¿å‘Š</p><p>åº”ç”¨æä¾›æˆ–æ›´æ–°ä¸€ä¸ªè½¬åŒ–æ•°å€¼</p><p>æ¯æ¬¡æ›´æ–°CVå€¼æˆåŠŸï¼Œè®¡æ—¶å™¨å»¶è¿Ÿ24ä¸ªå°æ—¶ã€‚</p><p>å¦‚æœ24å°æ—¶å†…CVéƒ½æ²¡æ›´æ–°ï¼Œåˆ™ç¡®å®šäº†æœ€ç»ˆçš„CVå€¼ï¼Œæœ€ç»ˆå€¼ç¡®å®šåï¼Œåˆä¼šåœ¨24å°æ—¶ä¹‹å†…æŠŠCVå€¼å›ä¼ ç»™å¹¿å‘Šå¹³å°ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å®‰è£…æ¿€æ´»è½¬åŒ–å€¼åœ¨æœ€å¿«ä¼šåœ¨24-48å°æ—¶å†…å›ä¼ ç»™å¹¿å‘Šä¸»ã€‚</p><p>å¦‚ä½•ç†è§£ï¼Ÿå®‰è£…çš„CVå€¼éƒ½æ˜¯0ï¼Œç”¨æˆ·å®‰è£…24å°æ—¶éƒ½æ²¡æœ‰è§¦å‘CVå€¼æ›´æ–°ï¼Œ24å°æ—¶åè®¡æ—¶å™¨åœæ­¢ï¼Œæœ€ç»ˆCVå€¼å°±æ˜¯0ï¼Œè€ŒAppleåˆä¼šåœ¨24å°æ—¶å†…postbackï¼Œä¹Ÿå°±æ˜¯å†åŠ 0-24å°æ—¶ä¹‹é—´çš„æ—¶é—´ï¼Œé‚£å°±æ˜¯24-48å°æ—¶ã€‚</p><p>è¿™åœ¨ç”¨ä¹ æƒ¯IDFAå½’å› çœ‹æ¥ç®€ç›´æ•ˆç‡ä½ä¸‹ï¼Œä¹‹å‰IDFAå½’å› å¹¿å‘ŠæŠ•æ”¾åç”¨æˆ·å®‰è£…åç«‹åˆ»å°±èƒ½çŸ¥é“ï¼Œè€Œä½¿ç”¨SKANæœ€å¿«ä¹Ÿè¦24-48å°æ—¶ä¹‹åæ‰çŸ¥é“å®‰è£…æ•°ï¼ˆè¿˜ä¸åŒ…æ‹¬åç»­CVæ›´æ–°ï¼Œåªçœ‹æ¿€æ´»æ•°ï¼‰</p><p>ä¸¾ä¸ªæç«¯ä¾‹å­ï¼Œå¦‚æœCVå€¼å¯¹åº”çš„è½¬æ¢äº‹ä»¶è®¾ç½®ä¸æ°å½“ï¼Œç”¨æˆ·ä»0ä¸€ç›´æ›´æ–°åˆ°63ï¼Œé‚£ä¹ˆä½ è¦åœ¨60å¤šå¤©åæ‰æ‹¿åˆ°è¿™ä¸ªç”¨æˆ·æœ€ç»ˆçš„CVå€¼ã€‚</p><p>3.éšç§é˜ˆå€¼</p><p>çœ‹äº†ä¸Šé¢çš„è®¡æ—¶å™¨è§‰å¾—SKANå·²ç»å¾ˆéš¾ç”¨äº†å§ï¼Œåˆ«æ…Œï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´åçš„æ¶ˆæ¯ã€‚CVå€¼æœ€ç»ˆæ˜¯å¦ä¼ é€’ç»™å¹¿å‘Šä¸»è¿˜è¦çœ‹ç”¨æˆ·çš„è¡Œä¸ºæ˜¯å¦æ»¡è¶³Appleçš„éšç§é˜ˆå€¼ã€‚</p><p>è¿™æ˜¯é˜ˆå€¼å…·ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼ŸæŠ±æ­‰ï¼ŒAppleæ²¡è¯´ï¼Œä¸€åˆ‡éƒ½æ˜¯é»‘ç›’ã€‚</p><p>ï¼ˆåœ¨æˆ‘ä»¬æ¥å…¥è¿‡ç¨‹ä¸­æœ‰å¹¿å‘Šä¸»è¯•äº†ä¸‹ï¼Œå¾—å‡ºçš„å¤§æ¦‚ç»“è®ºæ˜¯æ¯ä¸ªå¹¿å‘Šç³»åˆ—å¹³å‡æ¯å¤©å®‰è£…120ä¸ªä»¥ä¸Šæ‰ç¬¦åˆï¼Œä½†æ˜¯å¾ˆå¿«Appleåˆè°ƒæ•´äº†éšç§é˜ˆå€¼ï¼‰</p><p>å¦‚æœä¸ç¬¦åˆé˜ˆå€¼å‘¢ï¼Œé‚£Appleä¼šå›ä¼ ç»™ä½ ä¸€ä¸ªNullã€‚</p><p>è€Œç»è¿‡æˆ‘ä»¬æµ‹è¯•ï¼Œæ–°å¼€çš„å¹¿å‘Šç³»åˆ—æˆ–è€…æ•ˆæœä¸€èˆ¬çš„å¹¿å‘Šï¼Œä¸ç¬¦åˆéšç§é˜ˆå€¼æ‹¿åˆ°CVå€¼ä¸ºnullçš„å æ¯”é«˜è¾¾90%</p><p><img src="/images/pasted-4.png" alt="upload successful"></p><p>SKANæŠ€å·§åŠå‘</p><p>äº†è§£äº†SKANçš„åŸç†ï¼Œé‚£ä¹ˆè¯´ä¸€ä¸‹SKNAçš„ä¼˜ç¼ºç‚¹ã€‚</p><p>Appleè¯´ä¼˜ç‚¹æœ‰å¾ˆå¤šï¼Œæˆ‘éƒ½æ”¾ä¸‹é¢è¿™ä¸ªå›¾é‡Œäº†ï¼Œåœ¨éšç§è¶Šæ¥è¶Šä¸¥æ ¼çš„èƒŒæ™¯ä¸‹ï¼Œå¯ä»¥é¢„è§SKANåœ¨å¾ˆä¹…ä¸€æ®µæ—¶é—´éƒ½ä¼šæ˜¯å¸¸æ€ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132255620.png" alt=""></p><p>ç¼ºç‚¹å‘¢ï¼Œæœ‰å¾ˆå¤šï¼Œæœ€é‡è¦çš„ä¸€æ¡å°±æ˜¯æ—¶æ•ˆæ€§å¤ªå·®å¤ªå·®ã€‚</p><p>è¿™å¯¹æ•´ä¸ªå›¢é˜Ÿä¹Ÿæ˜¯ä¸€ç§è€ƒéªŒï¼Œä½œä¸ºç ”å‘äººå‘˜ï¼Œä½ ä¸ä½†è¦æ·±å…¥äº†è§£SKNAåŸç†ï¼Œè¿˜éœ€è¦äº†è§£å„ä¸ªå¹¿å‘Šå¹³å°ï¼ŒMMPå¹³å°çš„SKNAè§£å†³æ–¹æ¡ˆï¼ˆæ¯ä¸ªå¹³å°æ–¹æ¡ˆéƒ½ä¸åŒï¼‰ï¼Œè¿˜è¦è®©æŠ•æ”¾ã€äº§å“ã€å¸‚åœºéƒ½äº†è§£å’Œä½¿ç”¨SKAN,åˆç†åˆ©ç”¨64ä¸ªCVå€¼çš„æ˜ å°„ï¼Œè¿™æ— ç–‘ä¹Ÿæ˜¯ä¸ªæŒ‘æˆ˜ã€‚</p><p>1.ä½¿ç”¨MMPå¹³å°</p><p>å¹¿å‘Šå½’å› å¹³å°(Mobile Measurement Partner,ç®€ç§°MMP)ï¼ŒSKANå½’å› ç‰¹åˆ«å¤æ‚ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½ä½¿ç”¨MMPå¹³å°æ¥é›†æˆï¼ŒMMPå¹³å°å»å¯¹æ¥å„å¤§å¹¿å‘Šå¹³å°ï¼Œå’Œå„å¤§å¹¿å‘Šå¹³å°çš„SKANæ–¹æ¡ˆåšæ¡¥æ¥å¯ä»¥åšåˆ°åªè®¾ç½®ä¸€ä¸ªCVæ˜ å°„è¡¨å¯¹åº”æ‰€æœ‰å¹¿å‘Šå¹³å°ã€‚</p><p>æ‹¿æˆ‘ä»¬ä½¿ç”¨çš„AppsFlyerå¹³å°ä¸¾ä¾‹ï¼Œä»–ä»¬çš„CVæ˜ å°„æ–¹æ¡ˆå¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132255755.png" alt=""></p><p>å…·ä½“æ¥è®²æœ‰åˆ†ä¸ºå‡ ä¸ªå¤§çš„ç»´åº¦<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132256914.png" alt=""></p><p>æ›´å¤šä¿¡æ¯å¯ä»¥å»å¯¹åº”çš„MMPå¹³å°æŸ¥çœ‹ã€‚</p><p>ä¸‹é¢æ˜¯æ•´ä¸ªMMPå¹³å°å’Œå¹¿å‘Šå¹³å°å½’å› æµç¨‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132256514.png" alt=""></p><p>2.åˆç†è®¾ç½®CVå€¼</p><p>åœ¨MMPå¹³å°ï¼Œå¯ä»¥è®¾ç½®CVæ˜ å°„è¡¨ï¼Œä¸€èˆ¬å°±æ˜¯åº”ç”¨å†…äº‹ä»¶ã€è®¢é˜…æ”¶å…¥ç­‰ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•ç†è§£CVå€¼çš„ï¼Œæ‹¿ä¸‹å›¾æ¥è¯´ï¼Œæˆ‘ä»¬ç»Ÿè®¡äº†</p><p>1.æ”¶å…¥ä»·å€¼ï¼Œåˆ†äº†4ä¸ªèŒƒå›´ï¼ˆå¯¹æ¥FBè¦æ±‚å¿…é¡»4ä¸ªèŒƒå›´ï¼Œå®é™…å¯èƒ½ç”¨ä¸åˆ°è¿™ä¹ˆå¤šï¼‰</p><p>2.åº”ç”¨å†…äº‹ä»¶subs_success</p><p>3.å½’å› çª—å£æœŸ<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132256726.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132257744.png" alt=""></p><p>æˆ‘ä»¬ä¼šåœ¨subs_successäº‹ä»¶ä¸ŠæŠ¥ä¸€ä¸ªäº‹ä»¶ä»·å€¼ï¼ˆä»·å€¼æ˜¯å–å¹³å‡å€¼ï¼Œæ¯”å¦‚ä½ ä¸ŠæŠ¥çš„ä»·å€¼è½åœ¨0-20ä¹‹é—´ï¼ŒMMPå¹³å°ç»Ÿä¸€ç»Ÿè®¡ä¸º10ç¾é‡‘ï¼‰ï¼Œé‚£ä¹ˆCVå€¼=6å°±ä»£è¡¨ï¼šç”¨æˆ·åœ¨æ¿€æ´»å0-12å°æ—¶ä¹‹å†…è®¢é˜…äº†ï¼Œäº§ç”Ÿäº†subs_successäº‹ä»¶ï¼Œäº‹ä»¶ä»·å€¼10ç¾é‡‘ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132257355.png" alt=""></p><p>é‚£ä¹ˆ7å°±ä»£è¡¨ç”¨æˆ·åœ¨æ¿€æ´»å0-12å°æ—¶ä¹‹å†…è®¢é˜…äº†ï¼Œäº§ç”Ÿäº†subs_successäº‹ä»¶ï¼Œäº§ç”Ÿäº†ï¼ˆ20+40ï¼‰/ 2 = 30ç¾é‡‘çš„ä»·å€¼ã€‚</p><p>3.å„å¹¿å‘Šå¹³å°äº‹ä»¶æ˜ å°„</p><p>MMPå’Œå„ä¸ªå¹¿å‘Šå¹³å°å¯¹æ¥æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œè¿™é‡Œä¸å†å±•å¼€è®²ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯CVæ˜ å°„å€¼çš„è°ƒæ•´ï¼Œåœ¨éƒ¨åˆ†å¹³å°åŒæ­¥ç”Ÿæ•ˆéœ€è¦36-48å°æ—¶ä¸ç­‰ï¼Œæ›´æ”¹CVæ˜ å°„è¡¨æœŸé—´åº”è¯¥æš‚åœå¹¿å‘Šå¹¶ä¸”æ–°æ—§æ˜ å°„è¡¨äº¤æ›¿æ—¶å€™æ•°æ®ä¼šæœ‰éƒ¨åˆ†æ··ä¹±ã€‚</p><p>å…·ä½“çœ‹MMPå¹³å°æ–‡æ¡£ã€‚</p><p>å¦å¤–è¿˜é…åˆ°ä¸€äº›æ˜ å°„ä¸ä¸Šï¼Œæ— æ³•æ‹‰å–æˆæœ¬ç­‰ç­‰é—®é¢˜ï¼Œæœ‰äº›æ˜¯å¹¿å‘Šå¹³å°çš„é—®é¢˜ï¼Œéœ€è¦ç£ä¿ƒMMPå¹³å°æ‰¾å¹¿å‘Šå¹³å°è§£å†³ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132257738.png" alt=""></p><p>è¿™é‡Œè¡¥å……ä¸‹ï¼ŒMMPå¹³å°å’Œå¹¿å‘Šå¹³å°CVå€¼æ€ä¹ˆåŒæ­¥çš„é—®é¢˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132257413.png" alt=""></p><p>é‡ç‚¹å°±æ˜¯ä½ åœ¨GoogleæŠ•æ”¾çš„å¹¿å‘Šï¼ŒAppleä¼šæŠŠæœ€ç»ˆCVå€¼ç»™Googleï¼Œæ¯”å¦‚CV=6,Googleè¦ä¹ˆä¼šä»MMPæ‹‰å–ä¸€ä»½ä½ é…ç½®çš„CVæ˜ å°„è¡¨ï¼Œè¦ä¹ˆå›å»MMPé—®CV=6ä»£è¡¨ä»€ä¹ˆã€‚åŒæ—¶æŠŠCV=6å‘é€ç»™MMP,MMPå†åœ¨é¢æ¿ä¸Šå±•ç¤ºæ•°æ®ã€‚</p><p>è¿˜æœ‰æé†’ä¸€ä¸‹ï¼ŒMMPå¹³å°çš„SKANç­–ç•¥å’Œå¹¿å‘Šå¹³å°çš„ä¼šä¸ä¸€è‡´ï¼Œæ‹¿Googleæ¥è¯´ï¼ŒGoogleåå°å¯ä»¥Appleç»™çš„CVå€¼ï¼Œä½†æ˜¯Googleè¿˜æœ‰è‡ªå½’å› é€»è¾‘ï¼Œå­˜åœ¨nullçš„æƒ…å†µä¸‹GGä¼šè‡ªå½’å› åˆ¤æ–­æ˜¯å¦æ¿€æ´»ã€‚CVå€¼å’ŒMMPæœ€ç»ˆå¯¹ä¸ä¸Šã€‚</p><p>é‚£ä¹ˆæœ‰çš„åŒå­¦å°±å‘ç°è¿™é‡Œå­˜åœ¨æ¼æ´ï¼Œæ—¢ç„¶æ˜¯Appleç»™å¹¿å‘Šå¹³å°ï¼Œå¹¿å‘Šå¹³å°å†ç»™MMPï¼Œå¹¿å‘Šå¹³å°ä¼šä¸ä¼šç¯¡æ”¹CVå€¼å‘¢ã€‚</p><p>å› ä¸ºæœ‰äº›å¹³å°ç»“ç®—æ˜¯æŒ‰æ¿€æ´»é‡çš„ã€‚è¿™ä¸ªå°±æ˜¯ä¸‹é¢è¦æçš„äº¤å‰éªŒè¯äº†ã€‚</p><p>4.MMPäº¤å‰éªŒè¯</p><p>Appleåœ¨iOS15æ¨å‡ºäº†æ–°åŠŸèƒ½ï¼Œå¯ä»¥åœ¨å‘é€CVå€¼ç»™å¹¿å‘Šå¹³å°æ—¶å€™ï¼ŒåŒæ­¥å‘é€ç»™å¦å¤–ä¸€ä¸ªåœ°å€ã€‚è¿™æ ·å°±æœç»äº†å¹¿å‘Šå¹³å°æ¬ºè¯ˆçš„æƒ…å†µã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132257160.png" alt=""></p><p>4.æˆç»©</p><p>å…¶å®å¯¹SKANçš„ä»‹ç»è¦æƒ³è¯´é€å½»å¿…é¡»å•å¼€ä¸€ç¯‡æ–‡ç« æ¥è®²äº†ã€‚</p><p>ä¸‹é¢è¯´ä¸‹æˆ‘ä»¬çš„æˆç»©ï¼Œæˆªæ­¢åˆ°SKAN4.0ä¹‹å‰ï¼ŒSKANçš„å½’å› æ•°æ®è‚¯å®šä¸çœŸå®çš„ï¼Œä¸ºä»€ä¹ˆ?å› ä¸ºéšç§é˜ˆå€¼çš„å­˜åœ¨ï¼Œæ•°æ®ç›¸å½“äºæŠ½æ ·ã€‚</p><p>ä½†æ˜¯æ¯ä¸ªå¹³å°éƒ½æŠ½æ ·ï¼Œåªçœ‹ç»å¯¹å€¼è¿˜æ˜¯èƒ½å¯¹æ¯”é‚£ä¸ªå¹¿å‘Šæ¸ é“è½¬æ¢å’Œæ”¶ç›Šå¥½çš„ã€‚</p><p>æœŸé—´ä¹Ÿç»å†äº†MMPå¹³å°CVå€¼æ··ä¹±bugç­‰ç­‰ï¼Œä½†æ˜¯æ€»ä½“æ¥è¯´SKANæ˜¯ç›®å‰æœ€ä¼˜è§£å†³æ–¹æ¡ˆã€‚</p><p>ç›®å‰æˆ‘ä»¬ä¸€ä¸ªè®¢é˜…ä¸ŠæŠ¥10ç¾é‡‘ä»·å€¼ï¼Œæ•°æ®å»é™¤éšç§é˜ˆå€¼çš„æŸè€—ï¼Œçœ‹æ•´ä½“è¶‹åŠ¿ä¹Ÿèƒ½å’ŒAppleåå°æ•°æ®å¯¹å¾—ä¸Šã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/202303132257124.png" alt=""></p><p>é™¤äº†SKANï¼Œè¿˜å¯ä»¥ä½¿ç”¨Appleå®˜æ–¹çš„ASM(App Store Search Marketing )åˆå ASA(Apple Search Ads)ã€‚ASMå¹¶ä¸ä½¿ç”¨SKANï¼Œè€Œæ˜¯ä¼ ç»Ÿçš„å½’å› ï¼ˆæœç„¶å¥½ä¸œè¥¿è¿˜æ˜¯ç•™ç»™è‡ªå·±å¹³å°ï¼‰ã€‚</p><p>å…³äºæ›´å¤šSKAN4.0çš„ä¿¡æ¯ï¼Œæˆ‘ä¼šå•ç‹¬å¼€ä¸€ç¯‡æ¥è®²ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;èƒŒæ™¯&lt;/p&gt;
&lt;p&gt;åœ¨iOS14.5ä»¥åAppleå¯ç”¨ATTï¼ˆAppTransparencyTrackingï¼‰ã€‚ATT æ„å‘³ç€ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ”¶é›†æœ‰å…³æœ€ç»ˆç”¨æˆ·çš„æ•°æ®å¹¶ä¸å…¶ä»–å…¬å¸å…±äº«ä»¥è·¨åº”ç”¨ç¨‹åºå’Œç½‘ç«™è¿›è¡Œè·Ÿè¸ªï¼ˆIDFAï¼‰ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ ATT åŒæ„æç¤ºå¹¶åœ¨å‘å¸ƒå•†å’Œå¹¿å‘Šå•†åº”ç”¨ç¨‹
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>iOS XCTestå®æˆ˜â€”è§£å†³å›½é™…åŒ–å¼€å‘æµ‹è¯•ç—›ç‚¹ï¼ˆä¸‹ï¼‰</title>
    <link href="http://yoursite.com/2021/10/15/iOS-XCTest%E5%AE%9E%E6%88%98%E2%80%94%E8%A7%A3%E5%86%B3%E5%9B%BD%E9%99%85%E5%8C%96%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%97%9B%E7%82%B9%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
    <id>http://yoursite.com/2021/10/15/iOS-XCTest%E5%AE%9E%E6%88%98%E2%80%94%E8%A7%A3%E5%86%B3%E5%9B%BD%E9%99%85%E5%8C%96%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%97%9B%E7%82%B9%EF%BC%88%E4%B8%8B%EF%BC%89/</id>
    <published>2021-10-15T04:11:00.000Z</published>
    <updated>2025-07-18T02:25:58.721Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸Šç¯‡è¯¦è§ï¼š<a href="http://leevcan.com/2021/10/11/iOS-XCTest%E5%AE%9E%E6%88%98%E2%80%94%E8%A7%A3%E5%86%B3%E5%9B%BD%E9%99%85%E5%8C%96%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%97%9B%E7%82%B9/" target="_blank" rel="noopener">iOS XCTestå®æˆ˜â€”è§£å†³å›½é™…åŒ–å¼€å‘æµ‹è¯•ç—›ç‚¹ï¼ˆä¸Šï¼‰</a></p></blockquote><h1 id="4-StoreKit-Configuration-Fileï¼ˆæ— è®¢é˜…éœ€æ±‚å¯ç•¥è¿‡ï¼‰"><a href="#4-StoreKit-Configuration-Fileï¼ˆæ— è®¢é˜…éœ€æ±‚å¯ç•¥è¿‡ï¼‰" class="headerlink" title="4. StoreKit Configuration Fileï¼ˆæ— è®¢é˜…éœ€æ±‚å¯ç•¥è¿‡ï¼‰"></a>4. StoreKit Configuration Fileï¼ˆæ— è®¢é˜…éœ€æ±‚å¯ç•¥è¿‡ï¼‰</h1><p>å› ä¸ºæˆ‘ä»¬æ˜¯æµ·å¤–è®¢é˜…ç±»Appï¼Œè¿™ä¸ªæµ‹è¯•è„šæœ¬æœ€åˆçš„ç›®çš„å°±æ˜¯ä¸ºäº†æµ‹è¯•è®¢é˜…é¡µä»¥åŠæ•´ä¸ªè´­ä¹°æµç¨‹ï¼Œå› æ­¤è¦å¯¹ä¸»è¦å›½å®¶çš„è´§å¸å’Œä»·æ ¼è¿›è¡Œæµ‹è¯•ã€‚<br>ä½†æ˜¯åœ¨Xcode12ä¸­ï¼Œæ¨¡æ‹Ÿå™¨å¹¶ä¸èƒ½è¯»å–çº¿ä¸Šçš„<code>SKProuduct</code>ä¿¡æ¯ï¼ˆXcode13å·²ç»ä¿®å¤ï¼‰ã€‚è€ŒçœŸæœºæµ‹è¯•ä¹Ÿåªèƒ½æ¯æ¬¡æ‰‹åŠ¨åˆ‡æ¢æ²™ç›’è´¦æˆ·æ¥åˆ‡æ¢å›½é™…å’Œè´§å¸å¸ç§ã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®¢é˜…é¡µéœ€è¦é€‚é…ä¸€äº›è¶…é•¿çš„è´§å¸ï¼ˆä¸€èˆ¬å¦æ¡‘å°¼äºšè´§å¸æœ€é•¿ï¼‰ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215163909.png" alt=""><br>é€šè¿‡<code>StoreKit</code>å¯ä»¥å¾ˆæ–¹ä¾¿çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>Apple åœ¨ Xcode12 ä¸­å¼•å…¥äº†æœ¬åœ° StoreKit æµ‹è¯•ï¼Œæ— éœ€è¿æ¥åˆ° App Store æœåŠ¡å™¨å³å¯æµ‹è¯•ä¸åŒçš„ IAP åœºæ™¯ã€‚<br>æ›´å¤šä¿¡æ¯è¯¦è§ï¼š<a href="https://developer.apple.com/documentation/xcode/setting-up-storekit-testing-in-xcode#Overview" target="_blank" rel="noopener">ã€ŠSetting Up StoreKit Testing in Xcodeã€‹</a></p><h2 id="i-åˆ›å»ºStoreKit-Configuration-File"><a href="#i-åˆ›å»ºStoreKit-Configuration-File" class="headerlink" title="i.åˆ›å»ºStoreKit Configuration File"></a>i.åˆ›å»ºStoreKit Configuration File</h2><p>åˆ›å»ºæ–¹å¼å¾ˆç®€å•ï¼Œåœ¨æ–°å»ºæ–‡ä»¶ä¸­æ‰¾åˆ°<code>StoreKit Configuration File</code><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215163923.png" alt=""><br>ç‚¹å‡»åŠ å·ï¼Œæ–°å¢ä¸€ä¸ªè‡ªåŠ¨ç»­æœŸSKU,å½“ç„¶ä¹Ÿå¯ä»¥ç”¨æ¥æµ‹è¯•æ¶ˆè€—ç±»å†…è´­ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215163934.png" alt=""></p><p>æŒ‰ç€çœŸå®çš„çº¿ä¸ŠSKUè¿›è¡Œé…ç½®ï¼Œè¿˜èƒ½é…ç½®æ¨ä»‹ä¿ƒé”€ä¼˜æƒ ã€ä¿ƒé”€ä¼˜æƒ ã€å®¶åº­å…±äº«ç­‰åŠŸèƒ½ã€‚ä»·æ ¼è¿™é‡Œåªéœ€è¦å¡«å†™é‡‘é¢<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215163946.png" alt=""><br>åœ¨Schemesè®¾ç½®ä¸­ï¼Œæ·»åŠ åˆšåˆšé…ç½®çš„StoreKit Configuration<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164022.png" alt=""></p><p>é‡æ–°è¿è¡Œé¡¹ç›®ï¼Œå°±èƒ½åœ¨è·å–<code>SKProductsRequestDelegate</code>çš„<code>productsRequest</code>æ–¹æ³•ä¸­æ‹¿åˆ°æ¨¡æ‹Ÿçš„SKUäº†ï¼Œé‡‘é¢é»˜è®¤æ˜¯ç¾å…ƒã€‚</p><p>è€Œæ›´æ”¹è´§å¸ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œåœ¨é¡¹ç›®ä¸­é€‰ä¸­StoreKit Configurationæ–‡ä»¶ï¼Œåœ¨Xcodeä¸­çš„<code>Editor</code>â€”&gt;<code>Default Storefront</code>ä¸­è¿›è¡Œé€‰æ‹©ç›¸åº”çš„å¸ç§ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164039.png" alt=""><br>åªéœ€è¦åœ¨StoreKit Configurationä¸­æ›´æ”¹ä»·æ ¼å°±è¡Œäº†ï¼Œä¼šè‡ªåŠ¨è¯»å–è®¾ç½®çš„Storefrontå¸ç§ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164057.png" alt=""></p><p>æ›´æ”¹Storefrontæœ¬è´¨ä¸Šå°±æ˜¯æ›´æ”¹<code>SKProduct</code>çš„<code>priceLocale</code>,æ³¨æ„æœ€ç»ˆä»·æ ¼çš„å‘ˆç°æ–¹å¼è¦ç”¨ç³»ç»Ÿæä¾›çš„<code>NumberFormatter</code>æ¥è®¡ç®—</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> formatter = <span class="module-access"><span class="module"><span class="identifier">NumberFormatter</span>.</span></span>init<span class="literal">()</span></span><br><span class="line">formatter.formatterBehavior = <span class="module-access"><span class="module"><span class="identifier">NumberFormatter</span>.</span><span class="module"><span class="identifier">Behavior</span>.</span></span>behavior10_4</span><br><span class="line">formatter.numberStyle = <span class="module-access"><span class="module"><span class="identifier">NumberFormatter</span>.</span><span class="module"><span class="identifier">Style</span>.</span></span>currency</span><br><span class="line">formatter.locale = product.priceLocale</span><br><span class="line">self.price = formatter.<span class="built_in">string</span>(from: product.price) ?? <span class="string">""</span></span><br></pre></td></tr></table></figure><h2 id="ii-åœ¨XCTestä¸­ä½¿ç”¨StoreKit-Configuration-File"><a href="#ii-åœ¨XCTestä¸­ä½¿ç”¨StoreKit-Configuration-File" class="headerlink" title="ii. åœ¨XCTestä¸­ä½¿ç”¨StoreKit Configuration File"></a>ii. åœ¨XCTestä¸­ä½¿ç”¨StoreKit Configuration File</h2><p>åˆšåˆšçš„é…ç½®åªæ˜¯åœ¨<code>Schemes</code>çš„<code>Run</code>ç¯å¢ƒä¸‹é…ç½®äº†StoreKit Configuration<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164137.png" alt=""><br>è€Œåœ¨æˆ‘ä»¬éœ€è¦çš„<code>Test</code>ç¯å¢ƒä¸‹å¹¶æ²¡æœ‰é…ç½®å…¥å£<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164204.png" alt=""></p><p>å› æ­¤éœ€è¦ç”¨ä»£ç æ¥è§£å†³</p><p>é¦–å…ˆæ‰¾åˆ°StoreKit Configurationï¼ŒæŠŠæ–‡ä»¶å…±äº«ç»™UITests Target<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164212.png" alt=""></p><p>ç„¶ååœ¨éœ€è¦ç”¨åˆ°StoreKit Configurationçš„testæ–¹æ³•ä¸­ï¼Œæ ¹æ®æ–°å»ºnameæ–°å»º<code>SKTestSession</code><br>æ›´å¤šä¿¡æ¯è¯·å‚è€ƒï¼š<a href="https://developer.apple.com/documentation/storekittest/sktestsession" target="_blank" rel="noopener">ã€ŠSKTestSession | Apple Developer Documentationã€‹</a></p><blockquote><p>æ³¨æ„ï¼šæƒ³è¦åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•ä¸­ä½¿ç”¨StoreKit Configurationï¼Œéœ€è¦ç”¨åˆ°SKTestSessionï¼Œåªæœ‰iOS14ä»¥ä¸Šæ‰æ”¯æŒã€‚</p></blockquote><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testSubscribePage</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> #available(iOS <span class="number">14.0</span>, *) &#123;</span><br><span class="line">           <span class="keyword">let</span> session = <span class="keyword">try</span>? <span class="type">SKTestSession</span>.<span class="keyword">init</span>(configurationFileNamed: <span class="string">"Configuration"</span>)</span><br><span class="line">           session?.disableDialogs = <span class="literal">true</span></span><br><span class="line">           session?.clearTransactions()</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           ....</span><br><span class="line">       &#125;</span><br><span class="line">       .....</span><br></pre></td></tr></table></figure><h1 id="5-xcodebuild"><a href="#5-xcodebuild" class="headerlink" title="5. xcodebuild"></a>5. xcodebuild</h1><p>æ‰§è¡Œå®Œä¸Šè¿°æ­¥éª¤ï¼Œå·²ç»å¯ä»¥å¯¹å•ä¸ªæ¨¡æ‹Ÿå™¨æˆ–çœŸæœºæ‰§è¡ŒTest Plansã€‚å¦‚æœæƒ³ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªæœºå‹ï¼Œå°±éœ€è¦ç”¨åˆ°<code>xcodebuild</code>å‘½ä»¤äº†ã€‚<br>ç†Ÿæ‚‰Jenkinsæ‰“åŒ…çš„åŒå­¦åº”è¯¥å¯¹<code>xcodebuild</code>å¾ˆç†Ÿæ‚‰ï¼Œå…¶å®æˆ‘ä»¬æ¯æ¬¡åœ¨Xcodeè¿›è¡Œçš„<code>Run</code>ã€<code>Build</code>ã€<code>Archive</code>ç­‰æ“ä½œæœ¬è´¨ä¸Šéƒ½æ˜¯æ‰§è¡Œç›¸åº”çš„<code>xcodebuild</code>å‘½ä»¤ã€‚<br>ä½¿ç”¨<code>xcodebuild</code>å‘½ä»¤è¿è¡ŒTest Planså‘½ä»¤å¦‚ä¸‹</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨äº†podçš„è¯å°±éœ€è¦æ‰§è¡Œxxx.xcworkspace</span></span><br><span class="line"><span class="comment">//scheme é€‰æ‹©UITest</span></span><br><span class="line">xcodebuild test -workspace <span class="built_in">UITestDemo</span>.xcworkspace -scheme <span class="built_in">UITestDemoUITests</span> -destination <span class="string">'platform=iOS Simulator,name=iPhone 12 Pro Max,OS=14.5'</span></span><br></pre></td></tr></table></figure><h2 id="i-åŒæ—¶è¿è¡Œå¤šä¸ªæ¨¡æ‹Ÿå™¨å’ŒçœŸæœº"><a href="#i-åŒæ—¶è¿è¡Œå¤šä¸ªæ¨¡æ‹Ÿå™¨å’ŒçœŸæœº" class="headerlink" title="i. åŒæ—¶è¿è¡Œå¤šä¸ªæ¨¡æ‹Ÿå™¨å’ŒçœŸæœº"></a>i. åŒæ—¶è¿è¡Œå¤šä¸ªæ¨¡æ‹Ÿå™¨å’ŒçœŸæœº</h2><p>ä¸€æ¬¡è¿è¡Œå¤šä¸ªæ¨¡æ‹Ÿå™¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿˜å¯ä»¥çœŸæœºæ¨¡æ‹Ÿå™¨ä¸€èµ·è¿è¡Œï¼Œæ”¯æŒä¸åŒiOSç‰ˆæœ¬çš„æ¨¡æ‹Ÿå™¨åŒæ—¶è¿è¡Œã€‚</p><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">xcodebuild test -workspace UITestDemo.xcworkspace -scheme UITestDemoUITests </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">12</span> Pro Max,<span class="attr">OS=14.5'</span> </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">12</span>,<span class="attr">OS=14.5'</span></span><br><span class="line"> -destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">8</span> Plus,<span class="attr">OS=14.5'</span> </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">8</span>,<span class="attr">OS=14.5'</span> </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> SE (<span class="number">2</span>nd generation),<span class="attr">OS=14.5'</span></span><br><span class="line">-destination '<span class="attr">platform=iOS,name=caniPhone'</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºçš„Nameå¿…é¡»å‡†ç¡®ï¼ŒæŸ¥çœ‹æ‰€æœ‰å¯æ‰§è¡Œçš„æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºå¯ä»¥ä½¿ç”¨<code>xcrun xctrace list devices</code></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164226.png" alt=""></p><h2 id="ii-æŒ‡å®šderivedDataPath"><a href="#ii-æŒ‡å®šderivedDataPath" class="headerlink" title="ii. æŒ‡å®šderivedDataPath"></a>ii. æŒ‡å®šderivedDataPath</h2><p>æ­£å¸¸è¿è¡ŒTest Plansï¼Œè¿è¡Œç»“æœåªèƒ½åœ¨Xcodeä¸­æŸ¥çœ‹å¹¶ä¸”è·¯å¾„å¾ˆæ·±ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>derivedDataPath</code>æŒ‡å®šç»“æœçš„è¾“å‡ºè·¯å¾„</p><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">xcodebuild test -workspace UITestDemo.xcworkspace -scheme UITestDemoUITests -derivedDataPath '/Users/cc/Desktop/outData'</span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">12</span> Pro Max,<span class="attr">OS=14.5'</span> </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">12</span>,<span class="attr">OS=14.5'</span></span><br><span class="line"> -destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">8</span> Plus,<span class="attr">OS=14.5'</span> </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">8</span>,<span class="attr">OS=14.5'</span> </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> SE (<span class="number">2</span>nd generation),<span class="attr">OS=14.5'</span></span><br><span class="line">-destination '<span class="attr">platform=iOS,name=caniPhone'</span></span><br></pre></td></tr></table></figure><h2 id="iii-å¼€å¯parallel"><a href="#iii-å¼€å¯parallel" class="headerlink" title="iii. å¼€å¯parallel"></a>iii. å¼€å¯parallel</h2><p>åœ¨<a href="https://kms.netease.com/article/45514" target="_blank" rel="noopener">iOS XCTestå®æˆ˜â€”è§£å†³å›½é™…åŒ–å¼€å‘æµ‹è¯•ç—›ç‚¹ï¼ˆä¸Šï¼‰</a>ä¸­Test Plansæ ç›®ä»‹ç»äº†ä¸ºè®¾å¤‡å¼€å¯parallel testingã€‚åœ¨xcode buildä¸­åŒæ ·å¯ä»¥ä½¿ç”¨<code>-parallel-testing-enabled YES -parallelize-tests-among-destinations</code>å¼€å¯ï¼ˆä¸è¿‡åŒæ—¶è¿è¡Œå¤šä¸ªä¸åŒçš„æ¨¡æ‹Ÿå™¨ï¼Œä¸€èˆ¬æ²¡æœ‰é¢å¤–èµ„æºå¯¹åŒä¸€ä¸ªæ¨¡æ‹Ÿå™¨å†å¼€å¯parallel testingï¼‰</p><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">xcodebuild test -workspace UITestDemo.xcworkspace -scheme UITestDemoUITests -derivedDataPath '/Users/cc/Desktop/outData'</span><br><span class="line">-parallel-testing-enabled YES -parallelize-tests-among-destinations</span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">12</span> Pro Max,<span class="attr">OS=14.5'</span> </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">12</span>,<span class="attr">OS=14.5'</span></span><br><span class="line"> -destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">8</span> Plus,<span class="attr">OS=14.5'</span> </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> <span class="number">8</span>,<span class="attr">OS=14.5'</span> </span><br><span class="line">-destination '<span class="attr">platform=iOS</span> Simulator,<span class="attr">name=iPhone</span> SE (<span class="number">2</span>nd generation),<span class="attr">OS=14.5'</span></span><br><span class="line">-destination '<span class="attr">platform=iOS,name=caniPhone'</span></span><br></pre></td></tr></table></figure><blockquote><p>ç³»ç»Ÿä¼šæŒ‰ç…§å¯ç”¨èµ„æºåŒæ—¶å¹¶è¡Œè¿è¡Œå¤šä¸ªæ¨¡æ‹Ÿå™¨(ä¸€èˆ¬æ˜¯5ä¸ª)ï¼Œå½“ä½ æŒ‡å®šè¶…è¿‡5ä¸ªï¼Œæœ€å¼€å§‹è¿è¡Œç»“æŸçš„æ¨¡æ‹Ÿå™¨ä¼šè‡ªåŠ¨å…³é—­ç„¶åè¿è¡Œä¸‹ä¸€ä¸ªã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164352.png" alt=""></p><p>æ›´å¤šçš„xcodebuildè¯¦è§:</p><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">man xcodebuild</span></span><br></pre></td></tr></table></figure><h1 id="6-ä»xcresultä¸­æå–æˆªå›¾"><a href="#6-ä»xcresultä¸­æå–æˆªå›¾" class="headerlink" title="6. ä»xcresultä¸­æå–æˆªå›¾"></a>6. ä»xcresultä¸­æå–æˆªå›¾</h1><p>ä¸Šé¢æåˆ°è¿‡è¦çœ‹Test Plansè¿è¡Œå®Œåçš„æˆªå›¾ï¼Œåªèƒ½åœ¨Xcodeä¸­æŸ¥çœ‹ï¼Œå¹¶ä¸”æ¯æ¬¡åªèƒ½æŸ¥çœ‹ä¸€ä¸ªé…ç½®ï¼Œå›¾ç‰‡ä¹Ÿåªèƒ½ä¸€æ¬¡æŸ¥çœ‹ä¸€å¼ ã€‚<br>åœ¨Xcodeä¸­æ‰¾åˆ°æµ‹è¯•ç»“æœï¼Œåœ¨Finderä¸­æ˜¾ç¤ºå¯ä»¥çœ‹åˆ°ç»“æœæ˜¯ä»¥<code>.xcresult</code>ç»“å°¾çš„æ–‡ä»¶<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164427.png" alt=""><br>ç‚¹å‡»æ˜¾ç¤ºåŒ…å†…å®¹åå‘ç°ç»“æœä¹Ÿæ— æ³•è¯»å–ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164442.png" alt=""></p><p>é€šè¿‡æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://help.apple.com/xcode/mac/current/#/devc38fc7392" target="_blank" rel="noopener">ã€ŠView and share test resultsã€‹</a>å¾—çŸ¥ï¼Œå¯ä»¥ä½¿ç”¨<code>xcrun xcresulttool</code>å‘½ä»¤æ¥å¯¼å‡ºç»“æœã€‚<br>æ›´å¤šå‘½ä»¤è¯·æŸ¥çœ‹</p><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">xcrun xcresulttool --<span class="keyword">help</span> </span><br><span class="line"><span class="comment">//or</span></span><br><span class="line"><span class="keyword">man</span> xcresulttool</span><br></pre></td></tr></table></figure><h2 id="i-xcparse"><a href="#i-xcparse" class="headerlink" title="i.xcparse"></a>i.xcparse</h2><p>ä½†æ˜¯å…¶å®ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼Œå› ä¸ºåœ¨Githubä¸Šæœ‰å¾ˆå¥½ç”¨çš„å¼€æºåº“ï¼š<a href="https://github.com/ChargePoint/xcparse" target="_blank" rel="noopener">xcparse</a></p><p>é€šè¿‡<code>brew</code>å®‰è£…åï¼Œè¿è¡Œxcparseå‘½ä»¤å³å¯</p><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">//install</span>  xcparse</span><br><span class="line">brew install chargepoint/xcparse/xcparse</span><br><span class="line"></span><br><span class="line"><span class="string">//run</span> xcparse</span><br><span class="line">xcparse screenshots <span class="params">--os</span> <span class="params">--model</span> <span class="params">--test-plan-config</span> <span class="string">/path/to/Test.xcresult</span> <span class="string">/path/to/outputDirectory</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœå°±ä¼šæŒ‰æœºå‹ã€è¯­è¨€åˆ†ç»„å±•ç¤ºï¼Œæ¸…æ™°æ˜äº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215164459.png" alt=""></p><h1 id="7-æœ€ç»ˆæ–¹æ¡ˆShellè„šæœ¬"><a href="#7-æœ€ç»ˆæ–¹æ¡ˆShellè„šæœ¬" class="headerlink" title="7. æœ€ç»ˆæ–¹æ¡ˆShellè„šæœ¬"></a>7. æœ€ç»ˆæ–¹æ¡ˆShellè„šæœ¬</h1><p>åšå®Œä¸Šè¿°æ‰€æœ‰æ“ä½œï¼Œå°±å·²ç»åŸºæœ¬æ»¡è¶³éœ€æ±‚äº†ã€‚ä½†æ˜¯è¿˜æ˜¯å·®é‚£ä¹ˆç‚¹æ„æ€ï¼Œç›®å‰è¿˜å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>æ¯æ¬¡æ”¹æ¨¡æ‹Ÿå™¨ï¼Œéƒ½éœ€è¦ä¿®æ”¹xcodebuildå‘½ä»¤</li><li>è¾“å‡ºpathè¦æ‰‹åŠ¨æŒ‡å®šï¼Œå¦‚æœå­˜åœ¨ä¹Ÿä¸ä¼šè¦†ç›–ä¼šä¸€ç›´å¢åŠ </li><li>è¿è¡Œå®Œxcodebuildå‘½ä»¤åï¼Œè¦å¯¼å‡ºå›¾ç‰‡è¿˜è¦æ‰‹åŠ¨æ‰§è¡Œxcparseå‘½ä»¤</li><li>æ— æ³•éƒ¨ç½²åˆ°Jenkinsç­‰è®©éå¼€å‘äººå‘˜å»æµ‹è¯•<br>â€¦.</li></ul><p>æ‰€ä»¥æˆ‘ç”¨äº†ä¸€æ®µæ—¶é—´åï¼Œå†³å®šè¦shellè„šæœ¬å°è£…ä¸€ä¸‹ï¼Œåšåˆ°ä¸€é”®æ“ä½œã€‚åªéœ€è¦ä¸€ä¸ªå‘½ä»¤ï¼Œå°±å¯ä»¥è‡ªåŠ¨æ‰§è¡Œ<code>Test Plans</code>,æ‹¿åˆ°<code>xcresult</code>åè‡ªåŠ¨æ‰§è¡Œ<code>xcparse</code>å‘½ä»¤å¯¼å‡ºåˆ°æŒ‡å®šè·¯å¾„ã€‚</p><p>å› ä¸ºæ‰€æœ‰çš„éš¾é¢˜ä¹‹å‰å·²ç»è§£å†³äº†ï¼Œè„šæœ¬ä¹Ÿæ˜¯æ°´åˆ°æ¸ æˆã€‚é€»è¾‘ä¹Ÿå¾ˆç®€å•</p><h2 id="i-è„šæœ¬"><a href="#i-è„šæœ¬" class="headerlink" title="i.è„šæœ¬"></a>i.è„šæœ¬</h2><ul><li><p>å…ˆæŒ‡å®šschemeåå­—</p></li><li><p>æŒ‡å®šxcresultè¾“å‡ºç›®å½•å’Œxcparseå›¾ç‰‡è¾“å‡ºç›®å½•ï¼Œä¹‹å‰å­˜åœ¨å°±è¦†ç›–</p></li><li><p>é…ç½®æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºList</p></li><li><p>test plansè¿è¡Œå®Œæ¯•åæ‹¿åˆ°xcresultï¼Œç”¨xcparseå¯¼å‡ºå›¾ç‰‡</p></li></ul><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  UITest.sh</span></span><br><span class="line"><span class="comment">#  UDictionary</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  Created by æä¼Ÿç¿ on 2021/8/24.</span></span><br><span class="line"><span class="comment">#  Copyright Â© 2021 com.youdao. All rights reserved.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#chmod +x UITest.sh</span></span><br><span class="line"><span class="comment">#./UITest.sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"=========å¼€å§‹æ‰§è¡Œ========="</span></span><br><span class="line"></span><br><span class="line">path=$(<span class="built_in">pwd</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"path is <span class="variable">$path</span>"</span></span><br><span class="line"></span><br><span class="line">scheme=<span class="string">"UDictionary"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºç›®å½•</span></span><br><span class="line">outPath=<span class="string">"<span class="variable">$HOME</span>/Desktop/outData"</span></span><br><span class="line">resultPath=<span class="string">"<span class="variable">$HOME</span>/Desktop/outResult"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#XCUITest function</span></span><br><span class="line"><span class="function"><span class="title">xcUITestFunc</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> -e <span class="variable">$scheme</span>.xcodeproj</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">'=========Xcode Projectå­˜åœ¨'</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">'=========Xcode Projectä¸å­˜åœ¨ è¯·æ£€æŸ¥æ‰§è¡Œè·¯å¾„'</span></span><br><span class="line">        <span class="built_in">exit</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> -e <span class="variable">$outPath</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"=========outPath existed, clean outPath"</span></span><br><span class="line">        rm -rf <span class="variable">$outPath</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    mkdir <span class="variable">$outPath</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"=========outPath mkdir"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Get All Devices</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#xcrun xctrace list devices</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#å…¼å®¹çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ ä¸è¿‡æœ€å¥½æ¨¡æ‹Ÿå™¨ä¸€èµ·è·‘ çœŸæœºä¸€èµ·è·‘</span></span><br><span class="line">    simulators=(</span><br><span class="line">                <span class="comment">#iPhone</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPhone 12 Pro Max,OS=15.0"</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPhone 12,OS=15.0"</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPhone 8 Plus,OS=15.0"</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPhone 8,OS=15.0"</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPhone SE (2nd generation),OS=15.0"</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">#iPad</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPad (9th generation),OS=15.0"</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPad mini (6th generation),OS=15.0"</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPad Air (4th generation),OS=15.0"</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPad Pro (9.7-inch),OS=15.0"</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPad Pro (11-inch) (3rd generation),OS=15.0"</span></span><br><span class="line">                <span class="string">"platform=iOS Simulator,name=iPad Pro (12.9-inch) (5th generation),OS=15.0"</span></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">    destinationStr=<span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> subSimulator <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;simulators[@]&#125;</span>"</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        tmpStr=<span class="string">"-destination '<span class="variable">$subSimulator</span>' "</span></span><br><span class="line">        destinationStr=<span class="variable">$destinationStr</span><span class="variable">$tmpStr</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$destinationStr</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ‹¼æ¥å‘½ä»¤</span></span><br><span class="line">    commandStr=<span class="string">"xcodebuild test -workspace <span class="variable">$scheme</span>.xcworkspace -scheme <span class="variable">$scheme</span> -derivedDataPath '<span class="variable">$outPath</span>' <span class="variable">$destinationStr</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$commandStr</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    <span class="built_in">eval</span> <span class="variable">$commandStr</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"=========XCTestPlanæ‰§è¡Œç»“æŸ========="</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"----------------------------------"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"----------------------------------"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">getAllScreenShots</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> -e <span class="variable">$resultPath</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"=========resultPath existed, clean resultPath"</span></span><br><span class="line">        rm -rf <span class="variable">$resultPath</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#find xcresult</span></span><br><span class="line">    xcresultpath=$(find <span class="variable">$outPath</span>/Logs/Test -name <span class="string">"*.xcresult"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"=========å³å°†è¾“å‡ºå›¾ç‰‡åˆ°<span class="variable">$resultPath</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Install xcparse</span></span><br><span class="line">    <span class="comment">#brew install chargepoint/xcparse/xcparse</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ‰§è¡Œxcparse</span></span><br><span class="line">    commandStr=<span class="string">"xcparse screenshots --os --model --test-plan-config <span class="variable">$xcresultpath</span> <span class="variable">$resultPath</span>"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$commandStr</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    <span class="built_in">eval</span> <span class="variable">$commandStr</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"=========xcparseæ‰§è¡Œç»“æŸ========="</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xcUITestFunc</span><br><span class="line"></span><br><span class="line">getAllScreenShots</span><br></pre></td></tr></table></figure><h2 id="ii-è¿è¡Œè„šæœ¬"><a href="#ii-è¿è¡Œè„šæœ¬" class="headerlink" title="ii.è¿è¡Œè„šæœ¬"></a>ii.è¿è¡Œè„šæœ¬</h2><p>è¿è¡Œæ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨Terminalä¸­æ‰¾åˆ°å·¥ç¨‹ç›®å½•ï¼Œæ‰§è¡ŒShellè„šæœ¬ï¼Œæ¯”å¦‚æˆ‘ä»¬Shellè„šæœ¬ä¸ºUITest.sh</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">chmod +x <span class="module-access"><span class="module"><span class="identifier">UITest</span>.</span></span>sh</span><br><span class="line">./<span class="module-access"><span class="module"><span class="identifier">UITest</span>.</span></span>sh</span><br></pre></td></tr></table></figure><h1 id="8-ç»“è¯­"><a href="#8-ç»“è¯­" class="headerlink" title="8.ç»“è¯­"></a>8.ç»“è¯­</h1><p>è‡³æ­¤ï¼ŒUIè‡ªåŠ¨èµ°æŸ¥æ–¹æ¡ˆå·²ç»å…¨éƒ¨å®Œæˆäº†ã€‚æœ‰äº†è¿™ä¸ªè„šæœ¬åï¼Œæˆ‘ä»¬å·¥ç¨‹æ¯ä¸ªç‰ˆæœ¬å¼€å‘è‡ªæµ‹å’Œæµ‹è¯•å¹³å‡èŠ‚çœäº†<code>5/äºº/å¤©</code>çš„å·¥ä½œé‡ã€‚ç‰¹åˆ«æ˜¯åæ¥æˆ‘ä»¬å¼€å¯äº†iPadé€‚é…åã€‚è€ŒUIèµ°æŸ¥ä¹Ÿèƒ½çœ‹åˆ°æœ€ç»ˆç»“æœçš„çœŸå®å‘ˆç°ã€‚ç›®å‰å·²ç»ç¨³å®šè¿è¡Œäº†4ä¸ªå¤šæœˆï¼Œåç»­è¿˜ä¼šæ ¹æ®éœ€æ±‚ç»§ç»­ä¼˜åŒ–ã€‚<br>æœ¬æ–¹æ¡ˆè®¾è®¡åˆ°å¾ˆå¤šæŠ€æœ¯ç‚¹ï¼Œæ¯”å¦‚<code>XCTest</code>ã€<code>Test Plans</code>ã€<code>xcodebuild</code>ã€<code>StoreKit Configuration</code>ç­‰ç­‰ï¼Œæ¯ä¸€éƒ¨åˆ†å•ç‹¬æ‹å‡ºæ¥è¯´éƒ½å¯ä»¥å•ç‹¬å†™ä¸€ç¯‡ã€‚<br>æ‰€ä»¥æœ¬æ–‡å¾ˆå¤šåœ°æ–¹éƒ½ä¸€ç¬”å¸¦è¿‡ï¼Œä¸»è¦è®²æ–¹æ¡ˆçš„é€‰æ‹©å’Œèåˆã€‚å¦‚æœå“ªæ–¹é¢æœ‰ç–‘é—®æ¬¢è¿å¤§å®¶è”ç³»æˆ‘è¿›è¡Œè®¨è®ºå’Œäº¤æµã€‚</p><h2 id="è”ç³»æ–¹å¼ï¼š"><a href="#è”ç³»æ–¹å¼ï¼š" class="headerlink" title="è”ç³»æ–¹å¼ï¼š"></a>è”ç³»æ–¹å¼ï¼š</h2><blockquote><p>æä¼Ÿç¿<br>ç½‘æ˜“æœ‰é“ å›½é™…App<br><a href="https://github.com/liweican1992" target="_blank" rel="noopener">Github</a><br>liweican#corp.netease.com<br>liweican1992#163.com</p></blockquote><p>æ„Ÿè°¢æ‚¨çš„é˜…è¯»~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä¸Šç¯‡è¯¦è§ï¼š&lt;a href=&quot;http://leevcan.com/2021/10/11/iOS-XCTest%E5%AE%9E%E6%88%98%E2%80%94%E8%A7%A3%E5%86%B3%E5%9B%BD%E9%99%85%E5%8C%
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>iOS XCTestå®æˆ˜â€”è§£å†³å›½é™…åŒ–å¼€å‘æµ‹è¯•ç—›ç‚¹ï¼ˆä¸Šï¼‰</title>
    <link href="http://yoursite.com/2021/10/11/iOS-XCTest%E5%AE%9E%E6%88%98%E2%80%94%E8%A7%A3%E5%86%B3%E5%9B%BD%E9%99%85%E5%8C%96%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%97%9B%E7%82%B9/"/>
    <id>http://yoursite.com/2021/10/11/iOS-XCTest%E5%AE%9E%E6%88%98%E2%80%94%E8%A7%A3%E5%86%B3%E5%9B%BD%E9%99%85%E5%8C%96%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%97%9B%E7%82%B9/</id>
    <published>2021-10-11T07:34:00.000Z</published>
    <updated>2025-07-07T06:09:16.141Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æµ·å¤–é¡¹ç›®ä¸€å®šç¦»ä¸å¼€å›½é™…åŒ–é€‚é…ï¼Œè€Œå›½é™…åŒ–æ–‡æ¡ˆçš„å±•ç¤º&amp;æœºå‹é€‚é…ä¸€ç›´æ˜¯å¼€å‘å’Œæµ‹è¯•ä¸­çš„ç—›ç‚¹ã€‚<br>æœ¬äººè´Ÿè´£çš„é¡¹ç›®ä¸€ç›´æ·±è€•æµ·å¤–ï¼Œç›®å‰æ”¯æŒ13ç§å›½é™…åŒ–è¯­è¨€åŒ…æ‹¬R2Lçš„é˜¿æ‹‰ä¼¯è¯­ã€‚ä½œä¸ºè®¢é˜…ç±»Appï¼Œéœ€è¦è¿›è¡Œå¤§é‡çš„è®¢é˜…é¡µABæµ‹è¯•ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»äº†åœ¨é¡¹ç›®ä¸­å¦‚ä½•åˆ©ç”¨<code>XCTest</code>ã€<code>Test Plan</code>ã€<code>StoreKit Configuration</code>ã€<code>xcodebuild</code>å‘½ä»¤ã€<code>Shell</code>è„šæœ¬è¿›è¡Œå¿«é€ŸUIèµ°æŸ¥çš„ã€‚</p></blockquote><h1 id="0-å›½é™…åŒ–ç—›ç‚¹"><a href="#0-å›½é™…åŒ–ç—›ç‚¹" class="headerlink" title="0.å›½é™…åŒ–ç—›ç‚¹"></a>0.å›½é™…åŒ–ç—›ç‚¹</h1><p>åœ¨å›½é™…åŒ–æ—¥å¸¸å¼€å‘ä¸­ï¼Œå›½é™…åŒ–æ–‡æ¡ˆé€‚é…æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼Œé™¤äº†å¼€å‘éœ€è¦è€ƒè™‘å„ç§æ¢è¡Œå’Œè¾¹ç•Œé—®é¢˜ç­‰ï¼Œæµ‹è¯•åŒå­¦ä¹Ÿè¦èŠ±ç²¾åŠ›æŒ¨ä¸ªè¯­ç§å’Œæœºå‹è¿›è¡Œèµ°æŸ¥ã€‚å°¤å…¶æ˜¯è®¢é˜…é¡µé¢å„ä¸ªå›½å®¶çš„è´§å¸å±•ç¤ºé¡µä¸ç›¸åŒã€‚<br>ä¸‹å›¾åˆ—ä¸¾äº†ä¸€äº›å›½é™…åŒ–å¸¸è§çš„é—®é¢˜ï¼š<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215160447.png" alt=""><br>â¬†ï¸æ¢è¡Œåä¾æ—§æ— æ³•å±•ç¤º<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215165931.png" alt=""><br>â¬†ï¸æ–‡æ¡ˆè¿‡é•¿ï¼Œå°å±å¹•æœºå‹å±•ç¤ºé—®é¢˜<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215160349.png" alt=""><br>â¬†ï¸è´§å¸ä»·æ ¼è¿‡é•¿ï¼Œéœ€è¦é¢å¤–é€‚é…</p><hr><p>è¿™äº›é—®é¢˜éƒ½éœ€è¦å¼€å‘è‡ªæµ‹æˆ–UIèµ°æŸ¥æ‰èƒ½å‘ç°ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥è§£å†³è¿™äº›ç—›ç‚¹ã€‚</p><h1 id="1-éœ€æ±‚æ¢³ç†"><a href="#1-éœ€æ±‚æ¢³ç†" class="headerlink" title="1.éœ€æ±‚æ¢³ç†"></a>1.éœ€æ±‚æ¢³ç†</h1><p>å¼€å§‹ä¹‹å‰å…ˆæ¢³ç†ä¸€ä¸‹éœ€æ±‚ï¼Œé€šè¿‡å¹³æ—¶æˆ‘è‡ªæµ‹çš„ç—›ç‚¹ä»¥åŠå’Œæµ‹è¯•åŒå­¦çš„æ²Ÿé€šï¼Œå¦‚æœç”¨è„šæœ¬è¿›è¡Œæµ‹è¯•éœ€è¦è¾¾åˆ°ä»¥ä¸‹æ•ˆæœï¼š</p><ol><li>æ‰€æœ‰å›½é™…åŒ–æ–‡æ¡ˆå’Œä¸»è¦æœºå‹éƒ½è¦è¦†ç›–</li><li>ä»¥é¡µé¢æˆªå›¾ä¸ºå‡†ï¼Œäººå·¥è¿‡ä¸€ä¸‹ï¼Œæ–¹ä¾¿å‘ç°é—®é¢˜å’ŒæŠ¥bugï¼Œæœ€é‡è¦çš„æ˜¯æ–¹ä¾¿åæœŸUI Debugã€‚</li><li>å¯¹è®¢é˜…åŠŸèƒ½ï¼Œå¯ä»¥æ–¹ä¾¿åˆ‡æ¢ä¸åŒå›½å®¶å±•ç¤ºä¸åŒçš„è´§å¸</li><li>è„šæœ¬è¦æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥æ–¹ä¾¿é…ç½®ä¸åŒçš„æœºå‹ã€å›½é™…åŒ–è¯­è¨€å’Œè´§å¸å¸ç§ï¼ŒåæœŸæ–¹ä¾¿éƒ¨ç½²åˆ°Jenkins</li><li>ç»“æœå‘ˆç°è¦åˆ†æœºå‹ã€iOSç³»ç»Ÿï¼Œé€šè¿‡æˆªå›¾åç§°å¯ä»¥çŸ¥é“æ˜¯å“ªä¸ªé¡µé¢</li></ol><h1 id="2-XCTest"><a href="#2-XCTest" class="headerlink" title="2.XCTest"></a>2.XCTest</h1><p><code>XCTest</code>æ˜¯Xocdeçš„åŸç”Ÿæµ‹è¯•æ¡†æ¶ã€‚ç›¸å¯¹äº<a href="https://github.com/kiwi-bdd/Kiwi" target="_blank" rel="noopener">Kiwi</a>ã€<a href="https://github.com/specta/specta" target="_blank" rel="noopener">Specta</a>ã€<a href="https://github.com/specta/expecta" target="_blank" rel="noopener">Expecta</a>ç­‰ç¬¬ä¸‰æ–¹æ¡†æ¶æ›´å®¹æ˜“ä¸Šæ‰‹ã€‚è€Œé€‰æ‹©<code>XCTest</code>è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åŸå› æ˜¯Appleåœ¨2019 WWDCæ¨å‡ºçš„<code>Test Plans</code>å¯¹å›½é™…åŒ–æµ‹è¯•éå¸¸å‹å¥½ã€‚</p><p>(è¯¦è§ï¼š<a href="https://developer.apple.com/videos/play/wwdc2019/413/" target="_blank" rel="noopener">Testing in Xcode</a>ï¼Œä¸‹æ–‡ä¹Ÿä¼šè¯¦ç»†ä»‹ç»ï¼‰</p><p>Xcodeåœ¨åˆ›å»ºé¡¹ç›®æ—¶å€™ä¸€èˆ¬ä¼šè‡ªåŠ¨åˆ›å»ºTestå’ŒUITestå·¥ç¨‹ï¼Œå› ä¸ºåªéœ€è¦æµ‹è¯•UIï¼Œä½¿ç”¨UITestå³å¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215160550.png" alt=""><br>å…·ä½“çš„XCTestæ–‡æ¡£è¯¦è§<a href="https://developer.apple.com/documentation/xctest/user_interface_tests" target="_blank" rel="noopener">User Interface Tests</a>ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è®²äº†ã€‚</p><p>åœ¨å¼€å§‹å†™æµ‹è¯•è„šæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><h2 id="i-å¯¹é¡µé¢è¿›è¡Œæˆªå›¾"><a href="#i-å¯¹é¡µé¢è¿›è¡Œæˆªå›¾" class="headerlink" title="i.å¯¹é¡µé¢è¿›è¡Œæˆªå›¾"></a>i.å¯¹é¡µé¢è¿›è¡Œæˆªå›¾</h2><p>æˆªå›¾æ–¹æ³•å¾ˆç®€å•ï¼Œå°è£…æˆä¸€ä¸ªæ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">takeAScreenshot</span><span class="params">(<span class="number">_</span> name: String)</span></span> &#123;</span><br><span class="line">      <span class="keyword">let</span> screenshot = <span class="type">XCUIScreen</span>.main.screenshot()</span><br><span class="line">      <span class="keyword">let</span> screenshotAttachment = <span class="type">XCTAttachment</span>(</span><br><span class="line">          uniformTypeIdentifier: <span class="string">"public.png"</span>,</span><br><span class="line">          name: <span class="string">"Screenshot-\(UIDevice.current.name)-\(name).png"</span>,</span><br><span class="line">          payload: screenshot.pngRepresentation,</span><br><span class="line">          userInfo: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">      screenshotAttachment.lifetime = .keepAlways</span><br><span class="line">      add(screenshotAttachment)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥æŒ‡å®šæˆªå›¾çš„è´¨é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬å·¥ç¨‹è¿è¡Œä¸€æ¬¡è„šæœ¬éœ€è¦æˆªå›¾500+ï¼Œå°±éœ€è¦æŒ‡å®šä½è´¨é‡äº†ã€‚ç»è¿‡æµ‹è¯•ä½è´¨é‡çš„å›¾ç‰‡å ç”¨å¤§å°æ¯”é«˜è´¨é‡èƒ½å‹ç¼©è¿‘20å€å·¦å³ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œåœ¨M1èŠ¯ç‰‡çš„Macä¸Šï¼ŒæŒ‡å®šè´¨é‡çš„æˆªå›¾æ–¹æ³•ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯Xcodeçš„é€‚é…é—®é¢˜ã€‚</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">func take<span class="constructor">AScreenshot(<span class="params">_</span> <span class="params">name</span>: String)</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> screenshot = <span class="module-access"><span class="module"><span class="identifier">XCUIScreen</span>.</span></span>main.screenshot<span class="literal">()</span></span><br><span class="line">      <span class="keyword">let</span> screenshotAttachment = <span class="module-access"><span class="module"><span class="identifier">XCTAttachment</span>.</span></span>init(screenshot: screenshot, quality: .low)</span><br><span class="line">      screenshotAttachment.name = <span class="string">"\(UIDevice.current.name)-\(name).jpeg"</span></span><br><span class="line">      screenshotAttachment.lifetime = .keepAlways</span><br><span class="line">      add(screenshotAttachment)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å®Œæˆåï¼Œæˆªå›¾å¯ä»¥åœ¨Xcodeä¸­æŸ¥çœ‹<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215160607.png" alt=""></p><h2 id="ii-å›½é™…åŒ–é€‚é…"><a href="#ii-å›½é™…åŒ–é€‚é…" class="headerlink" title="ii. å›½é™…åŒ–é€‚é…"></a>ii. å›½é™…åŒ–é€‚é…</h2><p>åœ¨XCTestä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·çš„æ“ä½œï¼Œæ¯”å¦‚ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»ä¸€ä¸ªLabelç­‰ï¼Œè€Œæ‰¾åˆ°æ§ä»¶çš„æ–¹å¼ä¸€èˆ¬æ˜¯æŒ‰Buttonæ–‡æœ¬æˆ–è€…Labelçš„Text.<br>æ¯”å¦‚æˆ‘é¡µé¢æœ‰ä¸€ä¸ªButtonï¼Œtitleæ˜¯â€œtestButtonâ€</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">func test<span class="constructor">Example()</span> throws &#123;</span><br><span class="line">     <span class="comment">// UI tests must launch the application that they test.</span></span><br><span class="line">     <span class="keyword">let</span> btn = app.buttons<span class="literal">["<span class="identifier">testButton</span>"]</span></span><br><span class="line">     <span class="constructor">XCTAssertTrue(<span class="params">btn</span>.<span class="params">exists</span>)</span></span><br><span class="line">     <span class="comment">//tap btn</span></span><br><span class="line">     btn.tap<span class="literal">()</span></span><br><span class="line">     sleep(<span class="number">2</span>)</span><br><span class="line">     take<span class="constructor">AScreenshot(<span class="string">"button"</span>)</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å½“æˆ‘å¼€å¯å›½é™…åŒ–åï¼ŒæŒ‰é’®æ–‡æ¡ˆæ˜¯è·Ÿéšç³»ç»Ÿè¯­è¨€å˜åŒ–çš„ï¼Œé‚£ä¸Šè¿°ä»£ç å°±ä¼šæ‰§è¡Œå¤±è´¥ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215160630.png" alt=""></p><p>è§£å†³åŠæ³•æ˜¯ä¸ºæ§ä»¶è®¾ç½®<code>accessibilityIdentifier</code>å±æ€§ã€‚<code>accessibilityIdentifier</code>æ˜¯ä¸“ä¸ºUITestè®¾è®¡çš„ã€‚å¯ä»¥æ–¹ä¾¿çš„æ‰¾åˆ°éœ€è¦çš„å…ƒç´ ã€‚</p><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸ºbtnè®¾ç½®accessibilityIdentifier</span></span><br><span class="line">btn<span class="selector-class">.accessibilityIdentifier</span> = <span class="string">"myTestButton"</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">//åœ¨XCTestä¸­ æŒ‰accessibilityIdentifieræŸ¥æ‰¾</span></span><br><span class="line">let btn = app<span class="selector-class">.buttons</span>[<span class="string">"myTestButton"</span>]</span><br></pre></td></tr></table></figure><h2 id="iii-ä¸»Appå¼€å¯æµ‹è¯•ç¯å¢ƒ"><a href="#iii-ä¸»Appå¼€å¯æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="iii. ä¸»Appå¼€å¯æµ‹è¯•ç¯å¢ƒ"></a>iii. ä¸»Appå¼€å¯æµ‹è¯•ç¯å¢ƒ</h2><p>XCTestæ¯æ¬¡è¿è¡Œéƒ½ä¼šé‡æ–°è¿è¡ŒAppï¼Œä¸€èˆ¬ä¸»Appå¯åŠ¨å…¥å£ä¼šæœ‰å¾ˆå¤šä¸šåŠ¡é€»è¾‘ï¼Œå¯¹æµ‹è¯•ä¼šé€ æˆå½±å“ã€‚æˆ‘ä»¬éœ€è¦åˆ¤æ–­æœ¬æ¬¡å¯åŠ¨æ˜¯ä»XCTestå¯åŠ¨çš„ï¼Œè¿™æ ·å¯ä»¥å¼€å¯æµ‹è¯•ç¯å¢ƒï¼Œå»æ‰ä¸€äº›æ— å…³çš„é€»è¾‘ã€‚<br>åœ¨UITestä¸­å¯ä»¥å‘<code>launchArguments</code>ä¸­åŠ å…¥è‡ªå®šä¹‰å‚æ•°ã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UITestDemoUITests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> app: <span class="type">XCUIApplication!</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUpWithError</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line"></span><br><span class="line">        continueAfterFailure = <span class="literal">false</span></span><br><span class="line">        app = <span class="type">XCUIApplication</span>()</span><br><span class="line">        <span class="comment">//å‘ä¸»Appä¼ é€’å‚æ•° ä¹Ÿå¯ä»¥å†™åœ¨æµ‹è¯•æ–¹æ³•ä¸­</span></span><br><span class="line">        app.launchArguments.append(<span class="string">"UDUIXCTestConfig#SubscribePage"</span>)</span><br><span class="line">        app.launch()</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>Appdelegate</code>çš„<code>didFinishLaunchingWithOptions</code>ä¸­åˆ¤æ–­ï¼Œå¯ä»¥æŒ‡å®šæ ¹æ®å­—ç¬¦ä¸²æŒ‡å®šéœ€è¦æµ‹è¯•çš„åœºæ™¯ã€‚</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: <span class="literal">[UIA<span class="identifier">pplication</span>.L<span class="identifier">aunchOptionsKey</span>: A<span class="identifier">ny</span>]</span>?) -&gt; Bool &#123;</span><br><span class="line">    ...</span><br><span class="line">      for subArgue: String <span class="keyword">in</span> <span class="module-access"><span class="module"><span class="identifier">CommandLine</span>.</span></span>arguments &#123;</span><br><span class="line">            <span class="keyword">if</span> subArgue.has<span class="constructor">Prefix(<span class="string">"UDUIXCTestConfig"</span>)</span> &#123;</span><br><span class="line">                <span class="comment">//å¼€å¯æµ‹è¯•æ¨¡å¼</span></span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">UDXCTestManager</span>.</span></span>share<span class="constructor">Instance()</span>.argument = subArgue</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">UDXCTestManager</span>.</span></span>share<span class="constructor">Instance()</span>.testModeOn = <span class="literal">true</span></span><br><span class="line">                break</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="iv-Demo"><a href="#iv-Demo" class="headerlink" title="iv. Demo"></a>iv. Demo</h2><blockquote><p>å¼€å¯ä¸Šè¿°æ­¥éª¤åï¼Œå·²ç»å¯ä»¥åˆæ­¥è¿›è¡ŒUIæµ‹è¯•äº†ï¼Œé€šè¿‡è®¾ç½®æµ‹è¯•ç¯å¢ƒï¼Œç¡®ä¿å¯åŠ¨åè¿›å…¥å¾…æµ‹è¯•é¡µé¢ã€‚åˆç†åˆ©ç”¨forå¾ªç¯ä»¥åŠæˆªå›¾ã€‚éœ€è¦æ³¨æ„æ¥å…¥å‰å¦‚æœæ¶‰åŠé¡µé¢è·³è½¬ç­‰ï¼Œè¦ç”¨sleep()å‡½æ•°ç­‰å¾…é¡µé¢æ¸²æŸ“å®Œåå†æˆªå›¾</p></blockquote><p>æ¯”å¦‚æˆ‘ä»¬å·¥ç¨‹ä¸­ä¸€ä¸ªæµ‹è¯•æ–¹æ³•</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">func test<span class="constructor">SubscribePage()</span> throws &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> #available(iOS <span class="number">14.0</span>, *) &#123;</span><br><span class="line">          <span class="keyword">let</span> session = <span class="keyword">try</span>? <span class="module-access"><span class="module"><span class="identifier">SKTestSession</span>.</span></span>init(configurationFileNamed: <span class="string">"Configuration"</span>)</span><br><span class="line">          session?.disableDialogs = <span class="literal">true</span></span><br><span class="line">          session?.clear<span class="constructor">Transactions()</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      app.launchArguments.append(<span class="string">"UDUIXCTestConfig#SubscribePage"</span>)</span><br><span class="line">      app.launch<span class="literal">()</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> TypeList = <span class="literal">["S", "T", "U", "V", "V3"]</span></span><br><span class="line">      for sub <span class="keyword">in</span> TypeList &#123;</span><br><span class="line">          <span class="keyword">let</span> typeElement = app.tables.staticTexts<span class="literal">[<span class="identifier">sub</span>]</span></span><br><span class="line">          <span class="constructor">XCTAssertTrue(<span class="params">typeElement</span>.<span class="params">exists</span>)</span></span><br><span class="line">          typeElement.tap<span class="literal">()</span></span><br><span class="line">          sleep(<span class="number">2</span>)</span><br><span class="line">          self.take<span class="constructor">AScreenshot(<span class="string">"\(sub) List"</span>)</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">//æµ‹è¯•å­é¡µé¢</span></span><br><span class="line">          <span class="keyword">let</span> <span class="built_in">list</span> = <span class="literal">["<span class="identifier">weekly_free</span>", "<span class="identifier">monthly_free</span>", "<span class="identifier">yearly_free</span>"]</span></span><br><span class="line">          for sublist <span class="keyword">in</span> <span class="built_in">list</span> &#123;</span><br><span class="line">              sleep(<span class="number">2</span>)</span><br><span class="line">              <span class="keyword">let</span> subtypeElement = app.tables.staticTexts<span class="literal">[<span class="identifier">sublist</span>]</span></span><br><span class="line">              <span class="constructor">XCTAssertTrue(<span class="params">subtypeElement</span>.<span class="params">exists</span>)</span></span><br><span class="line">              <span class="comment">//è¿›å…¥å¾…æµ‹è¯•é¡µ</span></span><br><span class="line">              subtypeElement.tap<span class="literal">()</span></span><br><span class="line">              sleep(<span class="number">2</span>)</span><br><span class="line">              self.take<span class="constructor">AScreenshot(<span class="string">"\(sub)-\(sublist)-1"</span>)</span></span><br><span class="line">              sleep(<span class="number">1</span>)</span><br><span class="line">              <span class="keyword">if</span> sub<span class="operator"> == </span><span class="string">"S"</span><span class="operator"> || </span>sub<span class="operator"> == </span><span class="string">"T"</span> &#123;</span><br><span class="line">                  <span class="comment">//æ»šåŠ¨åˆ°åº•éƒ¨</span></span><br><span class="line">                  app.swipe<span class="constructor">Up()</span></span><br><span class="line">                  sleep(<span class="number">1</span>)</span><br><span class="line">                  <span class="comment">//å¯¹åº•éƒ¨æˆªå›¾ æ— æ³•æ»šåŠ¨çš„é¡µé¢å¯ä»¥è€ƒè™‘è¿‡æ»¤æ‰</span></span><br><span class="line">                  self.take<span class="constructor">AScreenshot(<span class="string">"\(sub)-\(sublist)-2"</span>)</span></span><br><span class="line">                  sleep(<span class="number">3</span>)</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  sleep(<span class="number">4</span>)</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//è¿”å›ä¸Šä¸€é¡µé¢</span></span><br><span class="line">          <span class="keyword">let</span> backButton = <span class="constructor">XCUIApplication()</span>.navigationBars.buttons<span class="literal">["<span class="identifier">backButton</span>"]</span></span><br><span class="line">          <span class="constructor">XCTAssert(<span class="params">backButton</span>.<span class="params">exists</span>)</span></span><br><span class="line">          backButton.tap<span class="literal">()</span></span><br><span class="line">          sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="3-TestPlans"><a href="#3-TestPlans" class="headerlink" title="3.TestPlans"></a>3.TestPlans</h1><p>ä¸Šè¿°æ–¹æ¡ˆæ¯æ¬¡åªèƒ½æµ‹è¯•ä¸€ä¸ªå›½é™…åŒ–è¯­è¨€ï¼Œæ¯æ¬¡åˆ‡æ¢è¯­è¨€åéœ€è¦é‡æ–°è¿è¡Œã€‚åœ¨<code>TestPlans</code>æ¨å‡ºä¹‹å‰éœ€è¦æˆ‘ä»¬è‡ªå·±å†™<code>xcodebuild</code>å‘½ä»¤æ¥æŒ‡å®šå›½é™…åŒ–è¯­è¨€æˆ–è€…åœ¨Schemesä¸­é…ç½®App Langauge<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215160655.png" alt=""></p><p><code>TestPlans</code>æ˜¯Appleåœ¨2019å¹´WWDCæ¨å‡ºçš„æµ‹è¯•å·¥å…·ï¼Œè¯¦ç»†ä¿¡æ¯è¯¦è§<a href="https://developer.apple.com/videos/play/wwdc2019/413/" target="_blank" rel="noopener">ã€ŠTesting in Xcodeã€‹</a>, æ¨å‡ºåå¯ä»¥æ›´æ–¹ä¾¿çš„è¿›è¡Œå›½é™…åŒ–è¯­è¨€ä»¥åŠå…¶ä½™é…ç½®çš„åˆ‡æ¢ã€‚</p><p>å¼€å¯æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨â€œEdit Scheme..â€â€”&gt; â€œTestâ€ â€”&gt; â€œCovert to use Test Plansâ€<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215160726.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215160746.png" alt=""><br>é€‰æ‹©æ”¾åˆ°ä¸»å·¥ç¨‹ä¸­ï¼Œè®¾ç½®æˆDefault<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215160807.png" alt=""></p><h2 id="i-é…ç½®Configuration"><a href="#i-é…ç½®Configuration" class="headerlink" title="i. é…ç½®Configuration"></a>i. é…ç½®Configuration</h2><p>åœ¨ä¸»å·¥ç¨‹ä¸­æ‰¾åˆ°<code>.xctestplan</code>åç¼€çš„æ–‡ä»¶ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215161029.png" alt=""><br>å¯ä»¥å‘ç°åœ¨Configurationä¸­å¯ä»¥è®¾ç½®è¯­è¨€ã€åœ°åŒºã€å¼€å¯<code>Code Coverage</code>ç­‰åŠŸèƒ½ã€‚</p><p>å¯ä»¥ç‚¹å‡»åŠ å·åŠ æ–°çš„é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤çš„é…ç½®æ˜¯è¯»å–Share Settingsçš„é…ç½®ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215161044.png" alt=""><br>æ¯”å¦‚æˆ‘ä»¬çš„å·¥ç¨‹ï¼Œé…ç½®äº†ä¸»è¦é€‚é…çš„è¯­è¨€ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215161113.png" alt=""></p><h2 id="ii-é€‰æ‹©æµ‹è¯•æ–¹æ³•ã€å¼€å¯å¹¶è¡Œ"><a href="#ii-é€‰æ‹©æµ‹è¯•æ–¹æ³•ã€å¼€å¯å¹¶è¡Œ" class="headerlink" title="ii. é€‰æ‹©æµ‹è¯•æ–¹æ³•ã€å¼€å¯å¹¶è¡Œ"></a>ii. é€‰æ‹©æµ‹è¯•æ–¹æ³•ã€å¼€å¯å¹¶è¡Œ</h2><p>åœ¨Testé¢æ¿ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰æµ‹è¯•æ–¹æ³•ï¼Œå¯ä»¥å‹¾é€‰éœ€è¦æµ‹è¯•çš„æ–¹æ³•ï¼Œå‹¾é€‰å¤šä¸ªä¼šæŒ‰ç€ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºæ‰§è¡Œã€‚åœ¨Optionsä¸­æ‰“å¼€<code>Execute in parallel</code>ã€‚æ‰“å¼€åå¯ä»¥åœ¨èµ„æºå…è®¸çš„æƒ…å†µä¸‹ï¼Œå¼€å¯å¤šä¸ªå…‹éš†çš„æ¨¡æ‹Ÿå™¨ï¼Œæé«˜æµ‹è¯•é€Ÿåº¦ã€‚</p><blockquote><p>æ¯”å¦‚æ‰§è¡ŒPhone Xæœºå‹çš„ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼Œåœ¨Configurationä¸­é…ç½®äº†6ä¸ªé…ç½®æ–‡ä»¶ï¼Œèµ„æºå…è®¸æƒ…å†µä¸‹ä¼šå¼€å¯3ä¸ªiPhone Xæ¨¡æ‹Ÿå™¨ï¼Œæ¯ä¸ªæ¨¡æ‹Ÿå™¨è·‘2ä¸ªé…ç½®ï¼Œé€Ÿåº¦æé«˜äº†3å€ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215161123.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215161136.png" alt=""></p><h2 id="iii-è¿è¡ŒTest-Plans"><a href="#iii-è¿è¡ŒTest-Plans" class="headerlink" title="iii.  è¿è¡ŒTest Plans"></a>iii.  è¿è¡ŒTest Plans</h2><p><code>Test Plans</code>çš„è¿è¡Œæ–¹å¼å’Œä¹‹å‰ä¸€æ ·ï¼Œæ‰¾åˆ°ä¹‹å‰çš„æ–¹æ³•å…¥å£ï¼Œç‚¹å‡»è¿è¡Œæˆ–è€…æŒ‰å³é”®åªè¿è¡Œéƒ¨åˆ†é…ç½®<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215161152.png" alt=""></p><h2 id="iv-æŸ¥çœ‹ç»“æœ"><a href="#iv-æŸ¥çœ‹ç»“æœ" class="headerlink" title="iv. æŸ¥çœ‹ç»“æœ"></a>iv. æŸ¥çœ‹ç»“æœ</h2><p>Test Plansè¿è¡Œå®Œåå¯ä»¥åœ¨Xcodeä¸­æŸ¥çœ‹ç»“æœï¼Œå¦‚æœè¿è¡Œå¤šä¸ªé…ç½®ï¼Œæ¯ä¸ªé…ç½®çš„ç»“æœéƒ½ä¼šå•ç‹¬å‘ˆç°<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215161209.png" alt=""></p><blockquote><p>å›½é™…åŒ–æµ‹è¯•éœ€è¦æ³¨æ„ï¼Œåœ¨Configurationä¸­æœ‰<code>Localization Screenshots</code>é€‰å‹ï¼Œé»˜è®¤æ˜¯<code>On</code>ï¼Œåªè¦æœ¬é¡µé¢æ–‡ä»¶è¿›è¡Œäº†å›½é™…åŒ–ï¼ˆä½¿ç”¨<code>NSLocalizedString</code>ï¼‰éƒ½ä¼šè‡ªåŠ¨æˆªå›¾ï¼Œå¦‚ä¸éœ€è¦å¯ä»¥å…³é—­ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20211215161224.png" alt=""></p><blockquote><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªåˆæ­¥çš„æµ‹è¯•æ–¹æ¡ˆï¼Œå¯ä»¥ç”¨XCTestå†™å®Œé¡µé¢æˆªå›¾é€»è¾‘åï¼Œä½¿ç”¨Test Plansæ‰¹é‡è¿è¡Œå¤šä¸ªè¯­è¨€ã€‚ä¸‹ä¸€ç« ä¼šä»‹ç»å¦‚ä½•è§£å†³è®¢é˜…ä¸­å¤šå¸ç§çš„é€‚é…ã€å¦‚ä½•å¿«é€Ÿå¯¼å‡ºæµ‹è¯•æˆªå›¾ä»¥åŠæœ€ç»ˆç”¨xcodebuildå’Œshellè„šæœ¬è‡ªåŠ¨åŒ–æ‰€æœ‰æ“ä½œã€‚</p></blockquote><h1 id="4-iOS-XCTestå®æˆ˜â€”è§£å†³å›½é™…åŒ–å¼€å‘æµ‹è¯•ç—›ç‚¹ï¼ˆä¸‹ï¼‰"><a href="#4-iOS-XCTestå®æˆ˜â€”è§£å†³å›½é™…åŒ–å¼€å‘æµ‹è¯•ç—›ç‚¹ï¼ˆä¸‹ï¼‰" class="headerlink" title="4.iOS XCTestå®æˆ˜â€”è§£å†³å›½é™…åŒ–å¼€å‘æµ‹è¯•ç—›ç‚¹ï¼ˆä¸‹ï¼‰"></a>4.iOS XCTestå®æˆ˜â€”è§£å†³å›½é™…åŒ–å¼€å‘æµ‹è¯•ç—›ç‚¹ï¼ˆä¸‹ï¼‰</h1><p>ä¸‹ç¯‡è¯¦è§ï¼š<a href="http://leevcan.com/2021/10/15/iOS-XCTest%E5%AE%9E%E6%88%98%E2%80%94%E8%A7%A3%E5%86%B3%E5%9B%BD%E9%99%85%E5%8C%96%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%97%9B%E7%82%B9%EF%BC%88%E4%B8%8B%EF%BC%89/" target="_blank" rel="noopener">iOS XCTestå®æˆ˜â€”è§£å†³å›½é™…åŒ–å¼€å‘æµ‹è¯•ç—›ç‚¹ï¼ˆä¸‹ï¼‰</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æµ·å¤–é¡¹ç›®ä¸€å®šç¦»ä¸å¼€å›½é™…åŒ–é€‚é…ï¼Œè€Œå›½é™…åŒ–æ–‡æ¡ˆçš„å±•ç¤º&amp;amp;æœºå‹é€‚é…ä¸€ç›´æ˜¯å¼€å‘å’Œæµ‹è¯•ä¸­çš„ç—›ç‚¹ã€‚&lt;br&gt;æœ¬äººè´Ÿè´£çš„é¡¹ç›®ä¸€ç›´æ·±è€•æµ·å¤–ï¼Œç›®å‰æ”¯æŒ13ç§å›½é™…åŒ–è¯­è¨€åŒ…æ‹¬R2Lçš„é˜¿æ‹‰ä¼¯è¯­ã€‚ä½œä¸ºè®¢é˜…ç±»Appï¼Œéœ€è¦è¿›è¡Œå¤§é‡çš„è®¢é˜…é¡µABæµ‹è¯•ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»äº†åœ¨é¡¹ç›®ä¸­å¦‚ä½•
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>iOSå›½é™…åŒ–â€”XLIFFæ‰¹é‡å½•å…¥è„šæœ¬(ä¸€é”®æ“ä½œ)</title>
    <link href="http://yoursite.com/2020/10/12/iOS%E5%9B%BD%E9%99%85%E5%8C%96%E2%80%94Xliff%E5%BD%95%E5%85%A5%E8%84%9A%E6%9C%AC/"/>
    <id>http://yoursite.com/2020/10/12/iOS%E5%9B%BD%E9%99%85%E5%8C%96%E2%80%94Xliff%E5%BD%95%E5%85%A5%E8%84%9A%E6%9C%AC/</id>
    <published>2020-10-12T08:19:00.000Z</published>
    <updated>2025-07-07T06:09:16.142Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>XLIFFï¼ˆXML Localisation Interchange File Formatï¼Œå³XMLæœ¬åœ°åŒ–äº¤æ¢æ–‡ä»¶æ ¼å¼ï¼‰æ˜¯ä¸€ç§åŸºäºXMLçš„äº¤æ¢æ ¼å¼ï¼Œæ—¨åœ¨æ ‡å‡†åŒ–æœ¬åœ°åŒ–è¿‡ç¨‹ä¸­åœ¨å·¥å…·ä¹‹é—´ä¼ é€’å¯æœ¬åœ°åŒ–æ•°æ®çš„æ–¹å¼ï¼Œæ˜¯CATå·¥å…·ä¸­å¸¸ç”¨çš„ä¸€ç§æ–‡ä»¶æ ¼å¼ã€‚XLIFFç”±ç»“æ„åŒ–ä¿¡æ¯æ ‡å‡†ä¿ƒè¿›ç»„ç»‡ï¼ˆOASISï¼‰äº2002å¹´æ ‡å‡†åŒ–ï¼Œç›®å‰è§„èŒƒä¸º2014å¹´8æœˆ5æ—¥å‘å¸ƒçš„v2.0<br>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ â€”â€”Wiki</p></blockquote><hr><p>update:å‡çº§åˆ°Xcode13ä»¥åï¼ŒExport Localizationns ä¼šæŠ¥é”™ï¼Œéœ€è¦åœ¨<code>Build Setting</code>ä¸­è®¾ç½®<code>Use Compiler to Extract Swift Strings</code>ä¸º<code>NO</code>ã€‚å¤šä¸ªtargertçš„è¯æ¯ä¸ªtargetéƒ½è®¾ç½®å³å¯ã€‚</p><hr><p>Appleå¯¹å›½é™…åŒ–æ–‡æ¡ˆçš„ç®¡ç†ä¹Ÿæ˜¯åŸºäº<code>XLIFF</code>çš„ï¼Œè¿™å‡ å¹´ä¸€ç›´è´Ÿè´£æµ·å¤–é¡¹ç›®ã€‚å›½é™…åŒ–æ–‡æ¡ˆç¿»è¯‘å’Œå½•å…¥æ˜¯å¿…ä¸å¯å…çš„ã€‚XLIFFæ˜¯ä¸šå†…çš„é€šç”¨åšæ³•ã€‚</p><p>å¦‚æœä½ å¯¹XLIFFä¸äº†è§£ï¼Œå¯ä»¥å‚è€ƒWWDC Session 401:<br><a href="https://developer.apple.com/videos/play/wwdc2017/401" target="_blank" rel="noopener">ã€ŠLocalizing with Xcode 9ã€‹</a></p><p>Appleåœ¨2018å¹´å‡çº§äº†å›½é™…åŒ–æ–‡æ¡ˆç®¡ç†æ–¹å¼ï¼Œä»<code>XLIFF</code>å‡çº§åˆ°äº†<code>Localization Catalog</code>ã€‚ä¸è¿‡æœ¬è´¨ä¸Šæ–‡æ¡ˆç®¡ç†è¿˜æ˜¯XLIFFã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201012164605.png" alt=""></p><p>å…·ä½“å‚è€ƒWWDC Session404:<br><a href="https://developer.apple.com/videos/play/wwdc2018/404/" target="_blank" rel="noopener">ã€ŠNew Localization Workflows in Xcode 10ã€‹</a></p><p><code>Localization Catalog</code> è§£å†³äº†XLIFFçš„å•ä¸€æ€§ï¼Œå¯ä»¥è®©ç¿»è¯‘äººå‘˜æ ¹æ®ä¸Šä¸‹æ–‡è¯­å¢ƒæ›´å‡†ç¡®çš„ç¿»è¯‘ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201012165247.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201012164625.png" alt=""></p><hr><p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œæ­£ç¡®çš„æ–¹æ³•æ˜¯ä»Xcodeä¸­ç”Ÿæˆ<code>Localization Catalog</code>ï¼Œç›´æ¥æŠŠ<code>Localization Catalog</code>ç»™åˆ°ç¿»è¯‘äººå‘˜ï¼Œç¿»è¯‘äººå‘˜æ ¹æ®storyboardæˆ–è€…å›¾ç‰‡ç»“åˆä¸Šä¸‹æ–‡ï¼Œå¯¹æ–‡æ¡ˆè¿›è¡Œç¿»è¯‘ï¼Œå¹¶ä¸”å½•å…¥åˆ°<code>XLIFF</code>ä¸­ã€‚ç„¶åæˆ‘ä»¬åªéœ€è¦å¯¼å…¥åˆ°Xcodeä¸­å°±å¯ä»¥äº†ã€‚</strong></p><hr><a id="more"></a><p>ä¸è¿‡ç°å®ä¸­ä¸€èˆ¬éƒ½æ˜¯ç”¨<code>Excel</code>è¿›è¡Œæ–‡æ¡ˆç®¡ç†ï¼Œç‰¹åˆ«æ˜¯<code>äº‘ç«¯Excel</code>ï¼Œå¯ä»¥æ–¹ä¾¿ç®¡ç†ä¹Ÿæ–¹ä¾¿å®‰å“ä½¿ç”¨ã€‚ä¹‹å‰æ¨åŠ¨è¿‡XLIFFï¼Œç”¨äº†å‡ æ¬¡æ¯æ¬¡éƒ½è¦ç»™å¯¹æ–¹è¿›è¡ŒåŸ¹è®­ã€‚æˆæœ¬å¤ªé«˜ã€‚</p><p>åœ¨å†™è„šæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯<code>XLiffTool</code>è¿™ä¸ªå·¥å…·ï¼Œå¯ä»¥åœ¨Macçš„App Storeç›´æ¥ä¸‹è½½ã€‚æ¯”è¾ƒæ–¹äººå·¥å½•å…¥ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201012170224.png" alt=""></p><p>ä½†æ˜¯äººå·¥å½•å…¥è€—æ—¶è€—åŠ›è¿˜å®¹æ˜“å‡ºé”™ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬æœ‰åå‡ ç§å›½é™…åŒ–è¯­è¨€ï¼Œæ¯æ¬¡è¦å½•å…¥å‡ åƒæ¡æ–‡æ¡ˆã€‚</p><p>æ‰€ä»¥è€ƒè™‘ç”¨Pythonæ’¸ä¸€ä¸ªè„šæœ¬ã€‚Pythonå¯¹Excelå’ŒXMLçš„è¯»å†™éƒ½å¾ˆå‹å¥½ã€‚ä¹Ÿé¡ºå¸¦å­¦ä¹ ä¸‹Python3.8çš„è¯­æ³•ã€‚</p><p>å¯¹Excelçš„è¯»å†™å¯ä»¥ä½¿ç”¨<code>xlrd</code>,æŒ‡å®šExcelçš„è·¯å¾„å’Œè¦è¯»å–çš„sheetã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201012172402.png" alt=""></p><blockquote><p>updateï¼šæ›´æ–°äº†ä¸‹pythonæ–‡ä»¶ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> keyword</span><br><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£æxliffçš„nameSpace Xliffç‰ˆæœ¬å˜æ›´è¯·æ›´æ”¹è¿™é‡Œ</span></span><br><span class="line">ns = dict(xliffNameSpace=<span class="string">'urn:oasis:names:tc:xliff:document:1.2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># excelåœ°å€</span></span><br><span class="line">excelPath = os.path.join(os.path.expanduser(<span class="string">"~"</span>), <span class="string">'Desktop/localizable.xlsx'</span>)</span><br><span class="line"><span class="comment"># xliffæ ¹ç›®å½•</span></span><br><span class="line">xliffRootPath = os.path.join(os.path.expanduser(<span class="string">"~"</span>), <span class="string">'Desktop/exportLoaclization'</span>)</span><br><span class="line"><span class="comment"># è¯­è¨€list</span></span><br><span class="line">languages = &#123;<span class="string">"Spanish"</span> : <span class="string">"es"</span>, <span class="string">"Portuguese"</span> : <span class="string">"pt"</span>, <span class="string">"Indonesian"</span> : <span class="string">"id"</span>, <span class="string">"Arabic"</span> : <span class="string">"ar"</span>, <span class="string">"Japanese"</span> : <span class="string">"ja"</span>, <span class="string">"Vietnam"</span> : <span class="string">"vi-VN"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡è¯­è¨€ éœ€è¦å’Œexcelä¸­ä¸€è‡´</span></span><br><span class="line">targetName = <span class="string">""</span></span><br><span class="line">sourceName = <span class="string">"English"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sheetName ä»å“ªä¸ªè¡¨è¯»å–ï¼Œæ‰¾ä¸åˆ°ä¼šé»˜è®¤è¯»å–ç¬¬ä¸€ä¸ªè¡¨</span></span><br><span class="line">sheetName = <span class="string">"ios"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetDesktopPath</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> os.path.join(os.path.expanduser(<span class="string">"~"</span>), <span class="string">'Desktop'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readExcel</span><span class="params">()</span>:</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(excelPath):</span><br><span class="line">        print(<span class="string">'excelè·¯å¾„ä¸å­˜åœ¨'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if not os.path.exists(xliffPath):</span></span><br><span class="line">    <span class="comment">#     print('xliffè·¯å¾„ä¸å­˜åœ¨')</span></span><br><span class="line">    <span class="comment">#     return</span></span><br><span class="line"></span><br><span class="line">    data = xlrd.open_workbook(excelPath)</span><br><span class="line">    <span class="comment"># æ‹¿åˆ°ç´¢å¼• é»˜è®¤æ˜¯åœ¨sheet0</span></span><br><span class="line">    sheet1 = data.sheet_by_index(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> sheetName <span class="keyword">in</span> data.sheet_names():</span><br><span class="line">        sheet1 = data.sheet_by_name(sheetName)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"sheetNameä¸å­˜åœ¨ é»˜è®¤è¯»å–ç¬¬ä¸€ä¸ª"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰¾Englishç´¢å¼•</span></span><br><span class="line">    sourceIndex = <span class="number">-1</span></span><br><span class="line">    <span class="comment"># ç¡®å®šIndex</span></span><br><span class="line">    row_0 = sheet1.row_values(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(len(row_0)):</span><br><span class="line">        <span class="keyword">if</span> row_0[k] == sourceName:</span><br><span class="line">            sourceIndex = k</span><br><span class="line">            print(sourceName + <span class="string">" æ‰€åœ¨ç´¢å¼• "</span> + str(k))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sourceIndex == <span class="number">-1</span>:</span><br><span class="line">        print(<span class="string">'æœªæ‰¾åˆ°English Index'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ‰¾targetç´¢å¼•</span></span><br><span class="line">    <span class="keyword">for</span> subLan <span class="keyword">in</span> languages:</span><br><span class="line">        print(subLan)</span><br><span class="line">        targetName = subLan</span><br><span class="line">        targetIndex = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(len(row_0)):</span><br><span class="line">            <span class="keyword">if</span> row_0[k] == targetName:</span><br><span class="line">                targetIndex = k</span><br><span class="line">                print(targetName + <span class="string">" æ‰€åœ¨ç´¢å¼• "</span> + str(k))</span><br><span class="line">                <span class="comment"># éå†å­—å…¸</span></span><br><span class="line">                dict = &#123;&#125;</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(sheet1.nrows):</span><br><span class="line">                    row_value = sheet1.cell_value(i, targetIndex)</span><br><span class="line">                    row_key = sheet1.cell_value(i, sourceIndex)</span><br><span class="line">                    <span class="keyword">if</span> row_key == <span class="string">'English'</span> <span class="keyword">or</span> row_key == <span class="string">""</span>:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    dict[row_key] = row_value</span><br><span class="line">                print(<span class="string">'excelæ•°æ®è¯»å–å®Œæ¯•ï¼Œå…± '</span>, len(dict), <span class="string">' æ¡æ•°æ®'</span>)</span><br><span class="line">                print(dict)</span><br><span class="line">                <span class="comment"># è¯»å–Xliff</span></span><br><span class="line">                writeXliff(dict,targetName)</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°éœ€è¦çš„æ–‡æ¡ˆï¼Œæ”¾åˆ°å­—å…¸é‡Œé¢ï¼Œç„¶åå¼€å§‹è¯»å†™XLIFF</p><p>æŸ¥çœ‹XLIFFæºç å¯ä»¥çœ‹åˆ°å†…éƒ¨ç»“æ„ã€‚æ³¨æ„æ˜¯æœ‰namespaceçš„ï¼Œéœ€è¦è¿›è¡Œå¤„ç†<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201012172615.png" alt=""><br>æŠŠdictä¼ é€’ç»™writeXliffå‡½æ•°ï¼ŒæŠŠè¯‘æ–‡å¡«å†™åˆ°targetä¸­ï¼Œæ²¡æœ‰targetè¦å…ˆè¿›è¡Œåˆ›å»ºã€‚</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">def writeXliff(dict, targetName):</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'è¯»å–'</span>+targetName+<span class="string">'xliffæ–‡ä»¶'</span>)</span><br><span class="line">   <span class="built_in"> lan </span>= languages[targetName]</span><br><span class="line">    xliffPath = os.path.join(xliffRootPath, lan+<span class="string">'.xcloc/Localized Contents/'</span>+lan+<span class="string">'.xliff'</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(xliffPath)</span><br><span class="line">    # é‡å†™nameSpace</span><br><span class="line">    ET.register_namespace(<span class="string">''</span>, <span class="string">'urn:oasis:names:tc:xliff:document:1.2'</span>)</span><br><span class="line">    # æ‹¿åˆ°æ ¹èŠ‚ç‚¹</span><br><span class="line">    tree = ET.parse(xliffPath)</span><br><span class="line">    root = tree.getroot()</span><br><span class="line">    # <span class="builtin-name">print</span>(root.tag)</span><br><span class="line">    count = 0</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> root.findall(<span class="string">'xliffNameSpace:file'</span>, ns):</span><br><span class="line">        #<span class="builtin-name">print</span>(<span class="string">'è¯»å–å­æ–‡ä»¶ï¼š'</span> + file.attrib[<span class="string">'original'</span>])</span><br><span class="line">        body = file.<span class="builtin-name">find</span>(<span class="string">'xliffNameSpace:body'</span>, ns)</span><br><span class="line">        <span class="keyword">for</span> unit <span class="keyword">in</span> body.findall(<span class="string">'xliffNameSpace:trans-unit'</span>, ns):</span><br><span class="line">            source = unit.<span class="builtin-name">find</span>(<span class="string">'xliffNameSpace:source'</span>, ns)</span><br><span class="line">            #<span class="builtin-name">print</span>(source.text)</span><br><span class="line">            target = unit.<span class="builtin-name">find</span>(<span class="string">'xliffNameSpace:target'</span>, ns)</span><br><span class="line">            # targetä¸å­˜åœ¨å°±åˆ›å»º åœ¨excelä¸­å¡«å†™è¯‘æ–‡ å¦åˆ™å†™å…¥åŸæ–‡</span><br><span class="line">            <span class="keyword">if</span> target is None:</span><br><span class="line">                # åˆ›å»ºtarget</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">"targetä¸ºç©º"</span>)</span><br><span class="line">                node = ET.SubElement(unit, <span class="string">"target"</span>)</span><br><span class="line">                <span class="keyword">if</span> source.text <span class="keyword">in</span> dict:</span><br><span class="line">                    node.text = dict[source.text]</span><br><span class="line">                    count += 1</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    node.text = source.text</span><br><span class="line">                    <span class="builtin-name">print</span>(<span class="string">'å¡«è¡¥ç©ºç™½è¯‘æ–‡'</span>)</span><br><span class="line">                node.tail = <span class="string">'\n\t'</span></span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">'create success'</span>)</span><br><span class="line">            elif source.text <span class="keyword">in</span> dict:</span><br><span class="line">                target.text = dict[source.text]</span><br><span class="line">                count += 1</span><br><span class="line"></span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'å†™å…¥å®Œæˆï¼Œå…±å†™å…¥ '</span> + str(count) + <span class="string">' æ¡æ•°æ®'</span>)</span><br><span class="line">    saveXML(root, xliffPath)</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'finish'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def subElement(root, tag, text):</span><br><span class="line">    ele = ET.SubElement(root, tag)</span><br><span class="line">    ele.text = text</span><br><span class="line"><span class="comment"># æ ¼å¼ä¼˜åŒ– ä¸å†æ¢è¡Œ</span></span><br><span class="line">def saveXML(root, filename, <span class="attribute">indent</span>=<span class="string">"\t"</span>, <span class="attribute">newl</span>=<span class="string">""</span>, <span class="attribute">encoding</span>=<span class="string">"utf-8"</span>):</span><br><span class="line">    rawText = ET.tostring(root)</span><br><span class="line">    dom = minidom.parseString(rawText)</span><br><span class="line">    with open(filename, <span class="string">'w'</span>) as f:</span><br><span class="line">        dom.writexml(f, <span class="string">""</span>, indent, newl, encoding)</span><br></pre></td></tr></table></figure><p><code>saveXML</code>æ˜¯ä¸€ä¸ªè‡ªå·±å†™çš„ä¼˜åŒ–XMLæ ¼å¼çš„æ–¹æ³•ã€‚</p><p>æ³¨æ„å­˜çš„æ—¶å€™è¦æŒ‡å®š<code>UTF-8</code>ç¼–ç ï¼Œè¦ä¸ä¼šæœ‰ä¹±ç é—®é¢˜ã€‚</p><p>Xcodeå¯¼å‡ºå’Œå¯¼å…¥Xliffæ–‡ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨<code>xocdebuild</code>å‘½ä»¤åšæˆè‡ªåŠ¨åŒ–ã€‚<br>æ‰€ä»¥å¯ä»¥ç”¨shellè„šæœ¬è§£å†³ï¼Œæ”¯æŒä¸€é”®å¯¼å‡ºã€å½•å…¥ã€å¯¼å…¥æ“ä½œã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  Localization.sh</span></span><br><span class="line"><span class="comment">#  UDictionary</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  Created by æä¼Ÿç¿ on 2021/8/27.</span></span><br><span class="line"><span class="comment">#  Copyright Â© 2021 com.youdao. All rights reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"=========å¼€å§‹æ‰§è¡Œ========="</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">languages=(<span class="string">"ar"</span></span><br><span class="line">            <span class="comment">#"de"</span></span><br><span class="line">            <span class="string">"en"</span></span><br><span class="line">            <span class="string">"es"</span></span><br><span class="line">            <span class="comment">#"fr"</span></span><br><span class="line">            <span class="string">"id"</span></span><br><span class="line">            <span class="comment">#"it"</span></span><br><span class="line">            <span class="string">"ja"</span></span><br><span class="line">            <span class="comment">#"ko"</span></span><br><span class="line">            <span class="string">"pt"</span></span><br><span class="line">            <span class="comment">#"ru"</span></span><br><span class="line">            <span class="string">"vi-VN"</span></span><br><span class="line">            <span class="string">"zh-Hant"</span></span><br><span class="line">            )</span><br><span class="line">outPath=<span class="string">"<span class="variable">$HOME</span>/Desktop/exportLoaclization"</span></span><br><span class="line">scheme=<span class="string">"UDictionary"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å‡ºxliff xcode10åä¸º.xclocæ ¼å¼æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="function"><span class="title">exportLocalizations</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"=========å¼€å§‹å¯¼å‡ºXliffæ–‡ä»¶========="</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> -e <span class="variable">$outPath</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"=========outPath existed, clean outPath"</span></span><br><span class="line">        rm -rf <span class="variable">$outPath</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    exportLanguageStr=<span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> subLanguage <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;languages[@]&#125;</span>"</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        tmpStr=<span class="string">"-exportLanguage <span class="variable">$subLanguage</span> "</span></span><br><span class="line">        exportLanguageStr=<span class="variable">$exportLanguageStr</span><span class="variable">$tmpStr</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">        <span class="comment">#echo $exportLanguageStr</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#xcodebuild -exportLocalizations -project UDictionary.xcodeproj -localizationPath $HOME/Desktop/outData2 -exportLanguage en -exportLanguage ja</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ‹¼æ¥å‘½ä»¤</span></span><br><span class="line">    commandStr=<span class="string">"xcodebuild -exportLocalizations -project <span class="variable">$scheme</span>.xcodeproj -localizationPath <span class="variable">$outPath</span> <span class="variable">$exportLanguageStr</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$commandStr</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">eval</span> <span class="variable">$commandStr</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"=========Xliffå¯¼å‡ºå®Œæˆ========="</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">runPython</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"=========æ‰§è¡ŒPythonè„šæœ¬è¯»å–Excel========="</span></span><br><span class="line"><span class="comment">#    path=$HOME/Desktop/ExcelToXliff</span></span><br><span class="line"><span class="comment">#    cd $path</span></span><br><span class="line">    chmod +x xliff.py</span><br><span class="line">    python3 xliff.py</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">importLocalizations</span></span>()&#123;</span><br><span class="line">    <span class="keyword">for</span> sub <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;languages[@]&#125;</span>"</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$sub</span></span><br><span class="line"></span><br><span class="line">        tmpStr=<span class="string">"-localizationPath <span class="variable">$outPath</span>/<span class="variable">$sub</span>.xcloc "</span></span><br><span class="line">        commandStr=<span class="string">"xcodebuild -importLocalizations -project <span class="variable">$scheme</span>.xcodeproj <span class="variable">$tmpStr</span>"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$commandStr</span></span><br><span class="line">        <span class="built_in">eval</span> <span class="variable">$commandStr</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"=========Xliffå¯¼å…¥å®Œæˆ========="</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å‡ºxliff</span></span><br><span class="line">exportLocalizations</span><br><span class="line"><span class="comment">#è¯»å–excel å†™å…¥xliff</span></span><br><span class="line">runPython</span><br><span class="line"><span class="comment">#å¯¼å…¥xliff</span></span><br><span class="line">importLocalizations</span><br></pre></td></tr></table></figure><p>æŠŠexcelæ”¾åˆ°æ¡Œé¢ï¼Œåœ¨Terminalä¸­è¿è¡Œshellå³å¯</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">chmod +x <span class="module-access"><span class="module"><span class="identifier">Localization</span>.</span></span>sh</span><br><span class="line">./<span class="module-access"><span class="module"><span class="identifier">Localization</span>.</span></span>sh</span><br></pre></td></tr></table></figure><p>é™„ä¸Šè„šæœ¬Gitåœ°å€ï¼š<a href="https://github.com/liweican1992/ExcelToXliff" target="_blank" rel="noopener">https://github.com/liweican1992/ExcelToXliff</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;XLIFFï¼ˆXML Localisation Interchange File Formatï¼Œå³XMLæœ¬åœ°åŒ–äº¤æ¢æ–‡ä»¶æ ¼å¼ï¼‰æ˜¯ä¸€ç§åŸºäºXMLçš„äº¤æ¢æ ¼å¼ï¼Œæ—¨åœ¨æ ‡å‡†åŒ–æœ¬åœ°åŒ–è¿‡ç¨‹ä¸­åœ¨å·¥å…·ä¹‹é—´ä¼ é€’å¯æœ¬åœ°åŒ–æ•°æ®çš„æ–¹å¼ï¼Œæ˜¯CATå·¥å…·ä¸­å¸¸ç”¨çš„ä¸€ç§æ–‡ä»¶æ ¼å¼ã€‚XLIFFç”±ç»“æ„åŒ–ä¿¡æ¯æ ‡å‡†ä¿ƒè¿›ç»„ç»‡ï¼ˆOASISï¼‰äº2002å¹´æ ‡å‡†åŒ–ï¼Œç›®å‰è§„èŒƒä¸º2014å¹´8æœˆ5æ—¥å‘å¸ƒçš„v2.0&lt;br&gt;ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ â€”â€”Wiki&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;update:å‡çº§åˆ°Xcode13ä»¥åï¼ŒExport Localizationns ä¼šæŠ¥é”™ï¼Œéœ€è¦åœ¨&lt;code&gt;Build Setting&lt;/code&gt;ä¸­è®¾ç½®&lt;code&gt;Use Compiler to Extract Swift Strings&lt;/code&gt;ä¸º&lt;code&gt;NO&lt;/code&gt;ã€‚å¤šä¸ªtargertçš„è¯æ¯ä¸ªtargetéƒ½è®¾ç½®å³å¯ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Appleå¯¹å›½é™…åŒ–æ–‡æ¡ˆçš„ç®¡ç†ä¹Ÿæ˜¯åŸºäº&lt;code&gt;XLIFF&lt;/code&gt;çš„ï¼Œè¿™å‡ å¹´ä¸€ç›´è´Ÿè´£æµ·å¤–é¡¹ç›®ã€‚å›½é™…åŒ–æ–‡æ¡ˆç¿»è¯‘å’Œå½•å…¥æ˜¯å¿…ä¸å¯å…çš„ã€‚XLIFFæ˜¯ä¸šå†…çš„é€šç”¨åšæ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å¯¹XLIFFä¸äº†è§£ï¼Œå¯ä»¥å‚è€ƒWWDC Session 401:&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2017/401&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ã€ŠLocalizing with Xcode 9ã€‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Appleåœ¨2018å¹´å‡çº§äº†å›½é™…åŒ–æ–‡æ¡ˆç®¡ç†æ–¹å¼ï¼Œä»&lt;code&gt;XLIFF&lt;/code&gt;å‡çº§åˆ°äº†&lt;code&gt;Localization Catalog&lt;/code&gt;ã€‚ä¸è¿‡æœ¬è´¨ä¸Šæ–‡æ¡ˆç®¡ç†è¿˜æ˜¯XLIFFã€‚&lt;br&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201012164605.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“å‚è€ƒWWDC Session404:&lt;br&gt;&lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2018/404/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ã€ŠNew Localization Workflows in Xcode 10ã€‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Localization Catalog&lt;/code&gt; è§£å†³äº†XLIFFçš„å•ä¸€æ€§ï¼Œå¯ä»¥è®©ç¿»è¯‘äººå‘˜æ ¹æ®ä¸Šä¸‹æ–‡è¯­å¢ƒæ›´å‡†ç¡®çš„ç¿»è¯‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201012165247.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201012164625.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;ä¸€èˆ¬æ¥è¯´ï¼Œæ­£ç¡®çš„æ–¹æ³•æ˜¯ä»Xcodeä¸­ç”Ÿæˆ&lt;code&gt;Localization Catalog&lt;/code&gt;ï¼Œç›´æ¥æŠŠ&lt;code&gt;Localization Catalog&lt;/code&gt;ç»™åˆ°ç¿»è¯‘äººå‘˜ï¼Œç¿»è¯‘äººå‘˜æ ¹æ®storyboardæˆ–è€…å›¾ç‰‡ç»“åˆä¸Šä¸‹æ–‡ï¼Œå¯¹æ–‡æ¡ˆè¿›è¡Œç¿»è¯‘ï¼Œå¹¶ä¸”å½•å…¥åˆ°&lt;code&gt;XLIFF&lt;/code&gt;ä¸­ã€‚ç„¶åæˆ‘ä»¬åªéœ€è¦å¯¼å…¥åˆ°Xcodeä¸­å°±å¯ä»¥äº†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>SKStorefrontâ€”åˆ¤æ–­ç”¨æˆ·App Storeæ‰€åœ¨åœ°åŒº</title>
    <link href="http://yoursite.com/2020/06/23/IAP%E2%80%94%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7App-Store%E6%89%80%E5%9C%A8%E5%9C%B0%E5%8C%BA/"/>
    <id>http://yoursite.com/2020/06/23/IAP%E2%80%94%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7App-Store%E6%89%80%E5%9C%A8%E5%9C%B0%E5%8C%BA/</id>
    <published>2020-06-23T12:53:36.000Z</published>
    <updated>2025-07-07T06:09:16.139Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘ä¸€å¹´çš„å·¥ä½œé‡å¿ƒéƒ½åœ¨æµ·å¤–è®¢é˜…é¡¹ç›®ä¸Šã€‚ROIæ•°æ®è¿˜ä¸é”™ï¼Œæ‰€ä»¥ABæµ‹è¯•è¶Šåšè¶Šå¤šã€‚<br>è¿‘æœŸè¦å®ç°ä¸€ä¸ªæ ¹æ®å›½å®¶å’Œåœ°åŒºæ¥ä¸‹å‘ä¸åŒçš„SKUçš„éœ€æ±‚ã€‚è®°å½•ä¸€ä¸‹ã€‚</p></blockquote><p>åˆ¤æ–­ç”¨æˆ·çš„å›½å®¶å’Œåœ°åŒºå¯ä»¥ç®€åŒ–ä¸ºåˆ¤æ–­ç”¨æˆ·Apple IDçš„åœ°åŒºï¼Œä¹Ÿå°±æ˜¯App Storeåœ°åŒºã€‚</p><p>ä¸Šæ¬¡å’ŒAppleäº¤æµï¼Œé—®äº†è¿™ä¸ªä¸ºé—®é¢˜ã€‚å‘ŠçŸ¥å¹¶æ²¡æœ‰æä¾›ç›¸å…³APIï¼ŒåŸå› æ˜¯ä½ Appæ‰€é€‰çš„é”€å”®åœ°åŒºå°±æ˜¯ä½ å†…è´­æä¾›çš„åœ°åŒºï¼Œç”¨æˆ·å¯ä»¥è½¬åŒºï¼Œè½¬åŒºåæ‰€è®¢é˜…çš„é¡¹ç›®ä¹Ÿèƒ½åœ¨æ–°åœ°åŒºæä¾›ã€‚</p><p><strong>ä½†æ˜¯æˆ‘è®°å¾—WWDC 2019ä¸­ï¼Œä»‹ç»äº†ä¸€ä¸ªiOS13æ–°å¢çš„APIï¼Œå¯ä»¥ç›‘å¬App Storeåœ°åŒºçš„å˜åŒ–ã€‚</strong></p><p>WWDCè¯¦è§ï¼š</p><p><a href="https://developer.apple.com/videos/play/wwdc2019/302/?time=129" target="_blank" rel="noopener">ã€ŠIn-App Purchases and Using Server-to-Server Notificationsã€‹</a></p><p>æ–°å¢çš„APIæ˜¯<code>SKStorefront</code></p><h2 id="SKStorefront"><a href="#SKStorefront" class="headerlink" title="SKStorefront"></a>SKStorefront</h2><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200623231316.png" alt=""></p><p>å®˜æ–¹æ–‡æ¡£è§ï¼š<br><a href="https://developer.apple.com/documentation/storekit/skstorefront" target="_blank" rel="noopener">https://developer.apple.com/documentation/storekit/skstorefront</a></p><p>è·å–åœ°åŒºä»£ç </p><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="meta">#available(iOS 13.0, *) &#123;</span></span><br><span class="line">    <span class="built_in">print</span>(SKPaymentQueue.<span class="keyword">default</span>().storefront?.countryCode ?? <span class="string">""</span>)</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æœ‰å¯èƒ½ä¸ºnil</p><p>countryCodeä½¿ç”¨çš„æ˜¯ISO 3166-1 Alpha-3ä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200623232654.png" alt=""></p><p>SKStorefrontè¿˜å¯ä»¥é€šè¿‡<code>paymentQueueDidChangeStorefront</code>ç›‘å¬App Storeåœ°åŒºçš„å˜åŒ–</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">func payment<span class="constructor">QueueDidChangeStorefront(<span class="params">_</span> <span class="params">queue</span>: SKPaymentQueue)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> storefront = queue.storefront &#123;</span><br><span class="line">        <span class="comment">// Refresh the displayed products based on the new storefront.</span></span><br><span class="line">        for product <span class="keyword">in</span> storeProducts &#123;</span><br><span class="line">            <span class="keyword">if</span> should<span class="constructor">Show(<span class="params">product</span>.<span class="params">productIdentifier</span>, <span class="params">in</span>: <span class="params">storefront</span>)</span> &#123;</span><br><span class="line">                <span class="comment">// Display this product in your store UI.</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Appleå®˜æ–¹æ–‡æ¡£è¯´SKStorefrontéšæ—¶å¯èƒ½å˜åŒ–ï¼Œç”šè‡³æ˜¯åœ¨è´­ä¹°è¿‡ç¨‹ä¸­ï¼Œå› æ­¤æ–°å¢äº†ä¸€ä¸ªä»£ç†æ–¹æ³•<code>paymentQueue:shouldContinueTransaction:inStorefront:</code><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200624111003.png" alt=""><br>æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯åœ¨è´­ä¹°æ—¶å€™å‘ç”ŸSKStorefrontå˜åŒ–,å¯ä»¥åˆ¤æ–­è¦ä¸è¦ç»§ç»­æ‰§è¡Œè¿™ä¸ªTransactionã€‚</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">SKPaymentQueue</span>.<span class="keyword">default</span>().delegate = <span class="keyword">self</span>  <span class="comment">// Set your object as the SKPaymentQueue delegate.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">paymentQueue</span><span class="params">(<span class="number">_</span> paymentQueue: SKPaymentQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                  shouldContinue transaction: SKPaymentTransaction,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">in</span> newStorefront: SKStorefront)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> shouldShow(transaction.payment.productIdentifier, <span class="keyword">in</span>: newStorefront)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ­¤åœ°åŒºä¸æ”¯æŒè´­ä¹°<code>paymentQueue:shouldContinueTransaction:inStorefront:</code>è¿”å›<code>false</code>ã€‚åœ¨Transactionå›è°ƒä¸­å°±ä¼šæ”¶åˆ°ä¸€ä¸ª<code>SKErrorStoreProductNotAvailable</code>çš„Errorä¿¡æ¯</p><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">paymentQueue</span><span class="params">(<span class="number">_</span> queue: SKPaymentQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                  updatedTransactions transactions: [SKPaymentTransaction])</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> transaction <span class="keyword">in</span> transactions &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> transactionError = transaction.error <span class="keyword">as</span> <span class="type">NSError?</span>,</span><br><span class="line">            transactionError.domain == <span class="type">SKErrorDomain</span></span><br><span class="line">            &amp;&amp; transactionError.code == <span class="type">SKError</span>.storeProductNotAvailable.rawValue &#123;</span><br><span class="line">            <span class="comment">// Show an alert.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯<code>SKStorefront</code>åªæ”¯æŒiOS13+ï¼Œå¹¶ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚å› æ­¤è¿˜è¦æƒ³åˆ«çš„åŠæ³•ã€‚</p><h2 id="é€šç”¨åšæ³•"><a href="#é€šç”¨åšæ³•" class="headerlink" title="é€šç”¨åšæ³•"></a>é€šç”¨åšæ³•</h2><p> æˆ‘ä»¬çš„éœ€æ±‚æ˜¯æ ¹æ®å›½å®¶å’Œåœ°åŒºï¼Œä¸‹å‘ä¸åŒæ¯”ä¾‹çš„SKU,ä¸å­˜åœ¨è¿™ä¸ªSKUåªåœ¨è¿™ä¸ªåœ°åŒºé”€å”®çš„æƒ…å†µã€‚<strong>å› ä¸ºè®¢é˜…ç±»å‹çš„SKUï¼Œç”¨æˆ·å¯ä»¥åœ¨è®¢é˜…ç®¡ç†é‡Œé¢åˆ‡æ¢å¥—é¤</strong></p><p> æˆ‘çš„åšæ³•æ˜¯ä»SKUä»·æ ¼å¤„ç†å…¥æ‰‹ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯æµ·å¤–é¡¹ç›®ï¼Œåœ¨å…¨çƒé”€å”®ã€‚æ‰€ä»¥è¦è¦å‘ˆç°ç”¨æˆ·æ‰€åœ¨åœ°åŒºçš„ä»·æ ¼å’Œè´§å¸ã€‚å¯ä»¥é€šè¿‡<code>NumberFormatter</code>è¿›è¡Œè½¬æ¢<br> <figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> formatter = <span class="module-access"><span class="module"><span class="identifier">NumberFormatter</span>.</span></span>init<span class="literal">()</span></span><br><span class="line">formatter.formatterBehavior = <span class="module-access"><span class="module"><span class="identifier">NumberFormatter</span>.</span><span class="module"><span class="identifier">Behavior</span>.</span></span>behavior10_4</span><br><span class="line">formatter.numberStyle = <span class="module-access"><span class="module"><span class="identifier">NumberFormatter</span>.</span><span class="module"><span class="identifier">Style</span>.</span></span>currency</span><br><span class="line"><span class="comment">//SKProductä¸­æœ‰priceLocale</span></span><br><span class="line">formatter.locale = product!.priceLocale</span><br><span class="line"><span class="keyword">let</span> price :String = formatter.<span class="built_in">string</span>(from: self.product!.price) ?? <span class="string">"$4.99"</span></span><br></pre></td></tr></table></figure></p><p> ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼ŒSKProductä¸­æœ‰ä¸ª<code>priceLocale</code>å±æ€§ï¼Œèµ‹å€¼ç»™NumberFormatteråå¯ä»¥å¯¹ä»·æ ¼è¿›è¡Œå¤„ç†ã€‚</p><p>priceLocaleæ˜¯Localç±»å‹ï¼ˆOCä¸­æ˜¯NSLocalï¼‰</p><p> <img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200624161049.png" alt=""></p><p> Localä¸­æœ‰<code>identifier</code>ã€<code>regionCode</code>ç­‰å±æ€§ã€‚<code>regionCode</code>ä»£è¡¨çš„å°±æ˜¯åœ°åŒºï¼Œå¯èƒ½ä¸ºnilï¼Œ<code>identifier</code>æ˜¯æ ‡è¯†ç¬¦ï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><p> ä¸‹å›¾æ˜¯App Storeåˆ‡æ¢åˆ°æ¾³å¤§åˆ©äºšåœ°åŒºï¼Œæ‰“å°çš„ç»“æœ<br> <img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200624151437.png" alt=""><br> ä¸‹å›¾æ˜¯ç¾å›½<br> <img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200624161330.png" alt=""></p><p> ä½†æ˜¯regionCodeå¯èƒ½ä¸ºnilï¼Œæ‰€ä»¥è¦åšä¸‹åˆ¤æ–­ï¼Œå½“regionCodeä¸ºnilæ—¶å€™ä½¿ç”¨identifierï¼Œæˆ–è€…è·Ÿç€ä¸šåŠ¡é€»è¾‘è°ƒæ•´ã€‚</p><p> identifierçš„æ ¼å¼ä¸€èˆ¬æ˜¯éƒ½æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥æ ¹æ®@ç¬¦åˆ†å‰²ï¼Œæ‹¿åˆ°å‰é¢çš„<code>è¯­è¨€_åœ°åŒº</code>çš„å€¼ã€‚</p><blockquote><p>å¦‚ä½•å¿«é€Ÿåˆ‡æ¢App Storeåœ°åŒºå¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡ç« <a href="http://leevcan.com/2016/03/25/iOS%E5%BC%80%E5%8F%91%E4%B8%AD%E4%B8%80%E4%BA%9B%E5%B0%8F%E5%B7%A5%E5%85%B7/" target="_blank" rel="noopener">ã€ŠiOSå¼€å‘ä¸­ä¸€äº›å°å·¥å…·ã€‹</a> ä½¿ç”¨Switcherè¿™ä¸ªå·¥å…·ã€‚å®‰è£…åœ°å€ï¼š<a href="http://switchr.imagility.io/" target="_blank" rel="noopener">http://switchr.imagility.io/</a></p></blockquote><p>è¿™ä¸ªåŠæ³•å¿…é¡»å…ˆè·å–ä¸€ä¸ªå¯ç”¨çš„<code>SKProduct</code>,å¹¶ä¸èƒ½åœ¨è¯·æ±‚<code>SKProduct</code>ä¹‹å‰æ‹¿åˆ°åœ°åŒºã€‚æ‰€ä»¥è¿˜æ˜¯æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚</p><p>æˆ‘ä¸€èˆ¬æ˜¯åœ¨<code>productsRequest:didReceiveResponse:</code>å›è°ƒä¸­ï¼Œæ‹¿åˆ°ä¸€ä¸ª<code>SKProduct</code>è·å–åˆ°åœ°åŒºåå°±å­˜èµ·æ¥ã€‚æœ‰ä¸ªè¿™ä¸ªå‚æ•°ä¹Ÿå¯ä»¥åœ¨åŸ‹ç‚¹ä¸ŠæŠ¥ä¸­ç”¨åˆ°ï¼Œæ ‡æ˜ç”¨æˆ·çš„App Storeåœ°åŒºã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘ä¸€å¹´çš„å·¥ä½œé‡å¿ƒéƒ½åœ¨æµ·å¤–è®¢é˜…é¡¹ç›®ä¸Šã€‚ROIæ•°æ®è¿˜ä¸é”™ï¼Œæ‰€ä»¥ABæµ‹è¯•è¶Šåšè¶Šå¤šã€‚&lt;br&gt;è¿‘æœŸè¦å®ç°ä¸€ä¸ªæ ¹æ®å›½å®¶å’Œåœ°åŒºæ¥ä¸‹å‘ä¸åŒçš„SKUçš„éœ€æ±‚ã€‚è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åˆ¤æ–­ç”¨æˆ·çš„å›½å®¶å’Œåœ°åŒºå¯ä»¥ç®€åŒ–ä¸ºåˆ¤æ–­ç”¨æˆ·Apple ID
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>ä»æºç åˆ†æSwiftå¤šçº¿ç¨‹â€”DispatchGroup</title>
    <link href="http://yoursite.com/2020/05/30/%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90Swift%E5%A4%9A%E7%BA%BF%E7%A8%8B%E2%80%94DispatchGroup/"/>
    <id>http://yoursite.com/2020/05/30/%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90Swift%E5%A4%9A%E7%BA%BF%E7%A8%8B%E2%80%94DispatchGroup/</id>
    <published>2020-05-30T14:18:46.000Z</published>
    <updated>2025-07-15T02:53:49.982Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä»æºç åˆ†æGCDä¸­çš„DispatchGroupæ˜¯æ€ä¹ˆè°ƒåº¦çš„ï¼Œnotifyçš„èƒŒåæ˜¯å¦‚ä½•å®ç°çš„ã€‚å¦‚æœä½ å¯¹Swiftä¸­GCDå¦‚ä½•ä½¿ç”¨ä¸å¤ªäº†è§£ã€‚å¯ä»¥å‚è€ƒ<a href="http://leevcan.com/2020/05/22/%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90Swift%E5%A4%9A%E7%BA%BF%E7%A8%8B/" target="_blank" rel="noopener">ã€Šè¯¦è§£Swiftå¤šçº¿ç¨‹ã€‹</a></p></blockquote><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>ä»¥ä¸‹ä»£ç æ˜¯DispatchGroupçš„å¸¸ç”¨ä½¿ç”¨åœºæ™¯</p><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">        let g1 = DispatchGroup.init()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ç›´æ¥è¾“å…¥notify null</span></span><br><span class="line">        g1.notify(<span class="string">queue:</span> DispatchQueue.global()) &#123;</span><br><span class="line">            print(<span class="string">"notify null"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//A B å¹¶å‘ A B å®Œæˆåå¼€å¯Cä»»åŠ¡</span></span><br><span class="line"></span><br><span class="line">        g1.enter()</span><br><span class="line">        DispatchQueue.global().async &#123;</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0.</span>.<span class="number">.3</span>&#123;</span><br><span class="line">              print(<span class="string">"task A: \(Thread.current)"</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          g1.leave()</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        g1.enter()</span><br><span class="line">        DispatchQueue.global().async &#123;</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="number">0.</span>.<span class="number">.3</span> &#123;</span><br><span class="line">                print(<span class="string">"task B: \(Thread.current)"</span>)</span><br><span class="line">          &#125;</span><br><span class="line">            <span class="comment">//sleep(UInt32(3.5))</span></span><br><span class="line">          g1.leave()</span><br><span class="line">      &#125;</span><br><span class="line">        </span><br><span class="line">      g1.notify(<span class="string">queue:</span> DispatchQueue.global()) &#123;</span><br><span class="line">            print(<span class="string">"notify A&amp;B"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      g1.notify(<span class="string">queue:</span> DispatchQueue.global()) &#123;</span><br><span class="line">            print(<span class="string">"notify A&amp;B again"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      <span class="comment">//æ‰“å°ç»“æœ</span></span><br><span class="line">notify <span class="literal">null</span></span><br><span class="line">task <span class="string">A:</span> &lt;<span class="string">NSThread:</span> <span class="number">0x600002be85c0</span>&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line">task <span class="string">B:</span> &lt;<span class="string">NSThread:</span> <span class="number">0x600002bc5300</span>&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line">task <span class="string">A:</span> &lt;<span class="string">NSThread:</span> <span class="number">0x600002be85c0</span>&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line">task <span class="string">B:</span> &lt;<span class="string">NSThread:</span> <span class="number">0x600002bc5300</span>&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line">task <span class="string">A:</span> &lt;<span class="string">NSThread:</span> <span class="number">0x600002be85c0</span>&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line">task <span class="string">A:</span> &lt;<span class="string">NSThread:</span> <span class="number">0x600002be85c0</span>&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line">task <span class="string">B:</span> &lt;<span class="string">NSThread:</span> <span class="number">0x600002bc5300</span>&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line">task <span class="string">B:</span> &lt;<span class="string">NSThread:</span> <span class="number">0x600002bc5300</span>&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line">notify A&amp;B</span><br><span class="line">notify A&amp;B again</span><br></pre></td></tr></table></figure><p>ç”±ä»¥ä¸Šä»£ç ç»“æœå¯ä»¥å¾—çŸ¥ï¼Œnotityä¹‹å‰æ²¡æœ‰è°ƒç”¨enter()å’Œlevae()ä¼šç›´æ¥è¢«è°ƒç”¨ã€‚<br>å¦‚æœåœ¨notityä¹‹å‰è°ƒç”¨äº†enter()å’Œleave()ã€‚notifyä¼šåœ¨æœ€åä¸€ä¸ªleave()è°ƒç”¨åæ‰ä¼šå›è°ƒã€‚</p><p>wait()çš„ä½¿ç”¨</p><figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line"><span class="built_in">let</span> <span class="built_in">g1</span> = DispatchGroup.init()</span><br><span class="line">        </span><br><span class="line">  <span class="built_in">g1</span>.enter()</span><br><span class="line">  DispatchQueue.global().async &#123;</span><br><span class="line">      <span class="keyword">for</span> <span class="symbol">_</span> <span class="keyword">in</span> <span class="number">0</span>...<span class="number">3</span>&#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"task A: \(Thread.current)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">g1</span>.leave()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">g1</span>.enter()</span><br><span class="line">  DispatchQueue.global().async &#123;</span><br><span class="line">      <span class="keyword">for</span> <span class="symbol">_</span> <span class="keyword">in</span> <span class="number">0</span>...<span class="number">3</span> &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">"task B: \(Thread.current)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">      sleep(UInt32(<span class="number">3.5</span>))</span><br><span class="line">    <span class="built_in">g1</span>.leave()</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="built_in">let</span> result = <span class="built_in">g1</span>.wait(timeout: .now() + <span class="number">3</span>)</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">  switch result &#123;</span><br><span class="line">  case .success:</span><br><span class="line">      <span class="built_in">g1</span>.notify(queue: DispatchQueue.global()) &#123;</span><br><span class="line">          DispatchQueue.global().async &#123;</span><br><span class="line">              <span class="keyword">for</span> <span class="symbol">_</span> <span class="keyword">in</span> <span class="number">0</span>...<span class="number">3</span> &#123;</span><br><span class="line">                  <span class="built_in">print</span>(<span class="string">"task D: \(Thread.current)"</span>)</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">  case .timedOut:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"timedOut"</span>)</span><br><span class="line">      <span class="built_in">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  //æ‰“å°ç»“æœ</span><br><span class="line">  timedOut</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æºç "><a href="#æŸ¥çœ‹æºç " class="headerlink" title="æŸ¥çœ‹æºç "></a>æŸ¥çœ‹æºç </h3><p>Swiftä½¿ç”¨çš„GCDæ˜¯æ¡¥æ¥OCçš„æºç ã€‚æ‰€ä»¥åº•å±‚è¿˜æ˜¯libdispatchã€‚</p><p>æºç å¯ä»¥å»opensourceä¸‹è½½ï¼š<a href="https://opensource.apple.com/tarballs/libdispatch/" target="_blank" rel="noopener">https://opensource.apple.com/tarballs/libdispatch/</a></p><p>ä¹Ÿå¯ä»¥å»githubä¸ŠAppleå®˜æ–¹ä»“åº“å»ä¸‹è½½ï¼š<a href="https://github.com/apple/swift-corelibs-libdispatch" target="_blank" rel="noopener">https://github.com/apple/swift-corelibs-libdispatch</a></p><blockquote><p>è¦æ³¨æ„Appleçš„æºç æ˜¯ä¸€ç›´åœ¨è¿­ä»£å‡çº§çš„ã€‚å°è£…ä¹Ÿæ˜¯è¶Šæ¥è¶Šæ·±ï¼Œåœ¨opensourceä¸Šå¯ä»¥çœ‹åˆ°å¾ˆå¤šç‰ˆæœ¬çš„æºç ã€‚å†™è¿™ç¯‡æ–‡ç« æ—¶å€™æœ€æ–°ç‰ˆæœ¬ä¸º1173.40.5ç‰ˆæœ¬ã€‚æœ¬æ–‡åˆ†æåŸºäº931.60.2ç‰ˆæœ¬ã€‚ç½‘é€Ÿå¾ˆå¤šèµ„æ–™çš„æºç éƒ½æ˜¯å¾ˆè€çš„187.9ç‰ˆæœ¬ä¹‹å‰ã€‚å†…éƒ¨å®ç°å˜åŠ¨å¾ˆå¤§ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601114808.png" alt=""></p><p>ä¸‹è½½æºç åï¼Œå¯ä»¥åœ¨semaphore.cä¸­æ‰¾åˆ°DispatchGroupçš„å®ç°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601114842.png" alt=""></p><h4 id="create"><a href="#create" class="headerlink" title="create"></a>create</h4><p>å…ˆæ¥çœ‹çœ‹dispatch_group_createçš„å®ç°</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//libdispatch-913.60.2.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">dispatch_group_t</span></span><br><span class="line">dispatch_group_create(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _dispatch_group_create_with_count(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è€Œç½‘ä¸Šçš„èµ„æ–™ä¸€èˆ¬éƒ½æ¯”è¾ƒè€</span></span><br><span class="line"><span class="comment">//ä¸€èˆ¬æ˜¯ libdispatch-187.9.tar.gz æˆ–è€…ä¹‹å‰</span></span><br><span class="line"><span class="comment">//è¿™æ˜¯æ—§çš„ä»£ç  å¯ä»¥çœ‹åˆ°ä¼ å…¥çš„å€¼æ˜¯LONG_MAX</span></span><br><span class="line"><span class="keyword">dispatch_group_t</span></span><br><span class="line">dispatch_group_create(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">dispatch_group_t</span>)dispatch_semaphore_create(LONG_MAX);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>_dispatch_group_create_with_countçš„å®ç°</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">DISPATCH_ALWAYS_INLINE</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">dispatch_group_t</span></span><br><span class="line">_dispatch_group_create_with_count(<span class="keyword">long</span> count)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//dispatch_group_tå°±æ˜¯dispatchGroup</span></span><br><span class="line"><span class="comment">//dispatch_group_tæœ¬è´¨ä¸Šå°±æ˜¯dispatch_group_s è¯¦è§ä¸‹æ–¹</span></span><br><span class="line"><span class="keyword">dispatch_group_t</span> dg = (<span class="keyword">dispatch_group_t</span>)_dispatch_object_alloc(</span><br><span class="line">DISPATCH_VTABLE(group), <span class="keyword">sizeof</span>(struct dispatch_group_s));</span><br><span class="line"><span class="comment">//æŠŠcountçš„å€¼å­˜è¿›å»ç»“æ„ä½“</span></span><br><span class="line">_dispatch_semaphore_class_init(count, dg);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> å¦‚æœæœ‰å€¼ å°±æ‰§è¡Œos_atomic_store2o</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment">_dispatch_group_create_and_enter å°±æ˜¯ä¼ å…¥1è¿›æ¥</span></span><br><span class="line"><span class="comment">dispatch_group_t</span></span><br><span class="line"><span class="comment">    _dispatch_group_create_and_enter(void)&#123;</span></span><br><span class="line"><span class="comment">return _dispatch_group_create_with_count(1);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (count) &#123;</span><br><span class="line">os_atomic_store2o(dg, do_ref_cnt, <span class="number">1</span>, relaxed); <span class="comment">// &lt;rdar://problem/22318411&gt;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">#define os_atomic_store2o(p, f, v, m) \</span></span><br><span class="line"><span class="comment">æ³¨æ„ &amp;(p)-&gt;f</span></span><br><span class="line"><span class="comment">ç­‰äºæŠŠ1å­˜è¿›dg.do_ref_cnt</span></span><br><span class="line"><span class="comment">os_atomic_store(&amp;(p)-&gt;f, (v), m)</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> dg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥åˆ†æ</p><p>é€šè¿‡æœç´¢å‘ç°dispatch_group_tæœ¬è´¨ä¸Šå°±æ˜¯dispatch_group_s</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601114914.png" alt=""></p><p>dispatch_group_sæ˜¯ä¸€ä¸ªç»“æ„ä½“</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dispatch_group_s</span> &#123;</span></span><br><span class="line">DISPATCH_SEMAPHORE_HEADER(group, dg);</span><br><span class="line">    <span class="comment">//çœ‹åå­—çŸ¥é“å’Œwaitæ–¹æ³•æœ‰å…³</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">volatile</span> dg_waiters;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//dispatch_continuation_så¯ä»¥è‡ªè¡Œæœç´¢ æœ€åæ˜¯ä¸ªdispatch_object_s</span></span><br><span class="line"><span class="comment">//è¿™é‡Œå¯ä»¥ç†è§£ä¸ºå­˜å‚¨ä¸€ä¸ªé“¾è¡¨çš„ é“¾è¡¨å¤´å’Œå°¾ã€‚çœ‹å‚æ•°åçŸ¥é“å’Œnotifyæœ‰å…³</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dispatch_continuation_s</span> *<span class="title">volatile</span> <span class="title">dg_notify_head</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dispatch_continuation_s</span> *<span class="title">volatile</span> <span class="title">dg_notify_tail</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œcreatæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªdispatch_group_tï¼ˆä¹Ÿæ˜¯dispatch_group_sï¼‰å‡ºæ¥ï¼Œé»˜è®¤ä¼ è¿›æ¥çš„countæ˜¯0ï¼Œå¹¶ä¸”æŠŠcounté€šè¿‡dispatch_semaphore_class_init(count, dg)å­˜äº†èµ·æ¥ã€‚</p><p>dispatch_semaphore_class_init</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//_dispatch_semaphore_class_init(count, dg);</span></span><br><span class="line">static void</span><br><span class="line"><span class="constructor">_dispatch_semaphore_class_init(<span class="params">long</span> <span class="params">value</span>, <span class="params">dispatch_semaphore_class_t</span> <span class="params">dsemau</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//dsemauå°±æ˜¯dg æœ¬è´¨å°±æ˜¯æŠŠä¼ é€’è¿›æ¥çš„countå­˜èµ·æ¥</span></span><br><span class="line"><span class="keyword">struct</span> dispatch_semaphore_header_s *dsema = dsemau._dsema_hdr;</span><br><span class="line"></span><br><span class="line">dsema-&gt;do_next = DISPATCH_OBJECT_LISTLESS;</span><br><span class="line">dsema-&gt;do_targetq = <span class="constructor">_dispatch_get_root_queue(DISPATCH_QOS_DEFAULT, <span class="params">false</span>)</span>;</span><br><span class="line"><span class="comment">//valueå°±æ˜¯ä¼ è¿›æ¥çš„count</span></span><br><span class="line">dsema-&gt;dsema_value = value;</span><br><span class="line"><span class="constructor">_dispatch_sema4_init(&amp;<span class="params">dsema</span>-&gt;<span class="params">dsema_sema</span>, <span class="params">_DSEMA4_POLICY_FIFO</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ok,é€šè¿‡creatæ–¹æ³•æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªdispatch_group_så‡ºæ¥ï¼Œå¹¶ä¸”æŠŠ0å­˜äº†èµ·æ¥ã€‚çŸ¥é“dispatch_group_sä¸­æœ‰ä¸€ä¸ªç±»ä¼¼é“¾è¡¨çš„å¤´å’Œå°¾ï¼Œçœ‹å‚æ•°åçŸ¥é“å’Œnotifyæœ‰å…³ã€‚</p><h4 id="enter"><a href="#enter" class="headerlink" title="enter()"></a>enter()</h4><p>enter() æœ¬è´¨ä¸Šè°ƒç”¨dispatch_group_enter()</p><p>dispatch_group_enter</p><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">dispatch_group_enter(dispatch_group_t dg)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//os_atomic_inc_orig2oæ˜¯å®å®šä¹‰ï¼Œå¯ä»¥ä¸€ç›´ç‚¹è¿›å»çœ‹ã€‚æœ¬è´¨ä¸Šå°±æ˜¯æŠŠdgçš„dg_valueåš+1æ“ä½œã€‚</span></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">value</span> = os_atomic_inc_orig2o(dg, dg_value, acquire);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (slowpath((unsigned <span class="keyword">long</span>)<span class="keyword">value</span> &gt;= (unsigned <span class="keyword">long</span>)LONG_MAX)) &#123;</span><br><span class="line">DISPATCH_CLIENT_CRASH(<span class="keyword">value</span>,</span><br><span class="line"><span class="string">"Too many nested calls to dispatch_group_enter()"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">value</span> == <span class="number">0</span>) &#123;</span><br><span class="line">_dispatch_retain(dg); <span class="comment">// &lt;rdar://problem/22318411&gt;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»æºç ä¸Šçœ‹enteræ²¡åšå…¶ä½™çš„æ“ä½œï¼Œå°±æ˜¯æŠŠdgçš„dg_valueåš+1æ“ä½œã€‚å¦‚æœdg_valueå€¼è¿‡å¤§å°±ä¼šcrashã€‚</p><h4 id="leave"><a href="#leave" class="headerlink" title="leave()"></a>leave()</h4><p>é‚£ä¹ˆåŒç†æˆ‘ä»¬å¯ä»¥æƒ³åˆ°leave()åº”è¯¥æ˜¯åš-1æ“ä½œã€‚</p><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">dispatch_group_leave(dispatch_group_t dg)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//dg_value -1</span></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">value</span> = os_atomic_dec2o(dg, dg_value, release);</span><br><span class="line"><span class="keyword">if</span> (slowpath(<span class="keyword">value</span> == <span class="number">0</span>)) &#123;</span><br><span class="line">    <span class="comment">//å½“value==0 æ‰§è¡Œ_dispatch_group_wake</span></span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">void</span>)_dispatch_group_wake(dg, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸æˆå¯¹å‡ºç° crash</span></span><br><span class="line"><span class="keyword">if</span> (slowpath(<span class="keyword">value</span> &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">DISPATCH_CLIENT_CRASH(<span class="keyword">value</span>,</span><br><span class="line"><span class="string">"Unbalanced call to dispatch_group_leave()"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»æºç å¾—çŸ¥ï¼Œleaveçš„æ ¸å¿ƒé€»è¾‘æ˜¯åˆ¤æ–­value==0æ—¶å€™æ‰§è¡Œ<strong>_dispatch_group_wake</strong>ã€‚åŒæ—¶å½“levaeæ¬¡æ•°æ¯”enterå¤šæ—¶å€™ï¼Œvalue&lt;0ä¼šcrash</p><p>åŒæ—¶çœŸæ­£æ‰§è¡Œçš„é€»è¾‘åº”è¯¥åœ¨_dispatch_group_wakeä¸­</p><h4 id="notify"><a href="#notify" class="headerlink" title="notify()"></a>notify()</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">DISPATCH_ALWAYS_INLINE</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">_dispatch_group_notify(<span class="keyword">dispatch_group_t</span> dg, <span class="keyword">dispatch_queue_t</span> dq,</span><br><span class="line"><span class="keyword">dispatch_continuation_t</span> dsn)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//æŠŠç›®æ ‡é˜Ÿåˆ—ä¿å­˜åˆ°dc_dataä¸­</span></span><br><span class="line">dsn-&gt;dc_data = dq;</span><br><span class="line">dsn-&gt;do_next = <span class="literal">NULL</span>;</span><br><span class="line">_dispatch_retain(dq);</span><br><span class="line"><span class="keyword">if</span> (os_mpsc_push_update_tail(dg, dg_notify, dsn, do_next)) &#123;</span><br><span class="line">_dispatch_retain(dg);</span><br><span class="line">os_atomic_store2o(dg, dg_notify_head, dsn, ordered);</span><br><span class="line"><span class="comment">// seq_cst with atomic store to notify_head &lt;rdar://problem/11750916&gt;</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­dg.dg_valueæ˜¯å¦ä¸º0 </span></span><br><span class="line"><span class="keyword">if</span> (os_atomic_load2o(dg, dg_value, ordered) == <span class="number">0</span>) &#123;</span><br><span class="line">_dispatch_group_wake(dg, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¸å¿ƒé€»è¾‘è¿˜æ˜¯dg.davalueä¸º0çš„è¯ï¼Œå°±ç›´æ¥è°ƒç”¨_dispatch_group_wakeã€‚æ‰€ä»¥å¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆnotifyè°ƒç”¨ä¹‹å‰æ²¡æœ‰enterå’Œleaveä¸ºä»€ä¹ˆä¼šç›´æ¥è¢«å›è°ƒã€‚<strong>å› ä¸ºæ²¡æœ‰enterå’Œleaveï¼Œdg_valueä¸º0ï¼Œç›´æ¥è°ƒç”¨_dispatch_group_wake</strong></p><h4 id="dispatch-group-wake"><a href="#dispatch-group-wake" class="headerlink" title="_dispatch_group_wake()"></a>_dispatch_group_wake()</h4><p>å¯ä»¥è¯´DispatchGroupçš„æ ¸å¿ƒé€»è¾‘å°±åœ¨_dispatch_group_wakeæ–¹æ³•ä¸­</p><p>å…ˆæ¥çœ‹çœ‹æºç å®ç°</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">DISPATCH_NOINLINE</span><br><span class="line">static long</span><br><span class="line"><span class="constructor">_dispatch_group_wake(<span class="params">dispatch_group_t</span> <span class="params">dg</span>, <span class="params">bool</span> <span class="params">needs_release</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">dispatch_continuation_t next, head, tail = NULL;</span><br><span class="line">long rval;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cannot use os_mpsc_capture_snapshot() because we can have concurrent</span></span><br><span class="line"><span class="comment">// _dispatch_group_wake() calls</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//dispatch_group_s ä¸­dg_notify_head</span></span><br><span class="line">head = os<span class="constructor">_atomic_xchg2o(<span class="params">dg</span>, <span class="params">dg_notify_head</span>, NULL, <span class="params">relaxed</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (head) &#123;</span><br><span class="line"><span class="comment">// snapshot before anything is notified/woken &lt;rdar://problem/8554546&gt;</span></span><br><span class="line">tail = os<span class="constructor">_atomic_xchg2o(<span class="params">dg</span>, <span class="params">dg_notify_tail</span>, NULL, <span class="params">release</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line">rval = (long)os<span class="constructor">_atomic_xchg2o(<span class="params">dg</span>, <span class="params">dg_waiters</span>, 0, <span class="params">relaxed</span>)</span>;</span><br><span class="line"><span class="keyword">if</span> (rval) &#123;</span><br><span class="line"><span class="comment">// wake group waiters</span></span><br><span class="line"><span class="constructor">_dispatch_sema4_create(&amp;<span class="params">dg</span>-&gt;<span class="params">dg_sema</span>, <span class="params">_DSEMA4_POLICY_FIFO</span>)</span>;</span><br><span class="line"><span class="constructor">_dispatch_sema4_signal(&amp;<span class="params">dg</span>-&gt;<span class="params">dg_sema</span>, <span class="params">rval</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line">uint16_t refs = needs_release ? <span class="number">1</span> : <span class="number">0</span>; <span class="comment">// &lt;rdar://problem/22318411&gt;</span></span><br><span class="line"><span class="keyword">if</span> (head) &#123;</span><br><span class="line"><span class="comment">// async group notify blocks</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">next = os<span class="constructor">_mpsc_pop_snapshot_head(<span class="params">head</span>, <span class="params">tail</span>, <span class="params">do_next</span>)</span>;</span><br><span class="line">dispatch_queue_t dsn_queue = (dispatch_queue_t)head-&gt;dc_data;</span><br><span class="line"><span class="comment">//headå°±æ˜¯notifyçš„block åœ¨ç›®æ ‡é˜Ÿåˆ—dsn_queueä¸Šè¿è¡Œ</span></span><br><span class="line"><span class="constructor">_dispatch_continuation_async(<span class="params">dsn_queue</span>, <span class="params">head</span>)</span>;</span><br><span class="line"><span class="constructor">_dispatch_release(<span class="params">dsn_queue</span>)</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> ((head = next));</span><br><span class="line">refs++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (refs) <span class="constructor">_dispatch_release_n(<span class="params">dg</span>, <span class="params">refs</span>)</span>;</span><br><span class="line">return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯å¦è¿˜è®°å¾—å‰é¢æåˆ°çš„dispatch_group_sä¸­çš„é“¾è¡¨å¤´å’Œå°¾ï¼Ÿ</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">head = os<span class="constructor">_atomic_xchg2o(<span class="params">dg</span>, <span class="params">dg_notify_head</span>, NULL, <span class="params">relaxed</span>)</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå–å‡ºdispatch_group_sä¸­çš„é“¾è¡¨å¤´ï¼Œå¦‚æœæœ‰é“¾è¡¨å¤´å†å–å‡ºé“¾è¡¨å°¾ã€‚</p><p>æ ¸å¿ƒé€»è¾‘åœ¨è¿™ä¸ªdo whileå¾ªç¯ä¸­</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (head) &#123;</span><br><span class="line"><span class="comment">// async group notify blocks</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">next = os<span class="constructor">_mpsc_pop_snapshot_head(<span class="params">head</span>, <span class="params">tail</span>, <span class="params">do_next</span>)</span>;</span><br><span class="line">dispatch_queue_t dsn_queue = (dispatch_queue_t)head-&gt;dc_data;</span><br><span class="line"><span class="comment">//headå°±æ˜¯notifyçš„block åœ¨ç›®æ ‡é˜Ÿåˆ—dsn_queueä¸Šè¿è¡Œ</span></span><br><span class="line"><span class="constructor">_dispatch_continuation_async(<span class="params">dsn_queue</span>, <span class="params">head</span>)</span>;</span><br><span class="line"><span class="constructor">_dispatch_release(<span class="params">dsn_queue</span>)</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> ((head = next));</span><br><span class="line">refs++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>head-&gt;dc_data</code>æ‹¿åˆ°ç›®æ ‡é˜Ÿåˆ—ï¼Œç„¶åé€šè¿‡<code>_dispatch_continuation_async(dsn_queue, head)</code>å°†headè¿è¡Œåœ¨ç›®æ ‡é˜Ÿåˆ—ä¸Šã€‚</p><p>é‚£headæ˜¯ä»€ä¹ˆå°±ä¸€ç›®äº†ç„¶äº†ã€‚<code>è¿™ä¸ªé˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ˜¯notifyå›è°ƒçš„block</code></p><p>å†æ¥çœ‹çœ‹dispatch_group_sçš„å®šä¹‰</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dispatch_group_s</span> &#123;</span></span><br><span class="line">DISPATCH_SEMAPHORE_HEADER(group, dg);</span><br><span class="line">    <span class="comment">//çœ‹åå­—çŸ¥é“å’Œwaitæ–¹æ³•æœ‰å…³</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">volatile</span> dg_waiters;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//è¿™é‡Œå°±æ˜¯æŠŠæ‰€æœ‰notifyçš„å›è°ƒblockå­˜è¿›é“¾è¡¨é‡Œï¼Œç„¶åæ‹¿åˆ°å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dispatch_continuation_s</span> *<span class="title">volatile</span> <span class="title">dg_notify_head</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dispatch_continuation_s</span> *<span class="title">volatile</span> <span class="title">dg_notify_tail</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>DispatchGroup åœ¨åˆ›å»ºæ—¶å€™ä¼šå»ºç«‹ä¸€ä¸ªé“¾è¡¨ï¼Œæ¥å­˜å‚¨notifyçš„blockå›è°ƒã€‚</p><p>åˆ¤æ–­notifyæ‰§è¡Œçš„ä¾æ®å°±æ˜¯dg_valueæ˜¯å¦ä¸º0</p><p>å½“ä¸è°ƒç”¨enterå’Œleaveæ—¶å€™ï¼Œdg_value=0ï¼Œnotifyçš„å›è°ƒä¼šç«‹å³æ‰§è¡Œï¼Œå¹¶ä¸”æœ‰å¤šä¸ªnotifyä¼šæŒ‰ç…§é¡ºåºä¾æ¬¡è°ƒç”¨ã€‚</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> g1 = <span class="module-access"><span class="module"><span class="identifier">DispatchGroup</span>.</span></span>init<span class="literal">()</span></span><br><span class="line">        </span><br><span class="line">g1.notify(queue: <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global<span class="literal">()</span>) &#123;</span><br><span class="line">print(<span class="string">"notify null"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">g1.notify(queue: <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global<span class="literal">()</span>) &#123;</span><br><span class="line">print(<span class="string">"notify null2"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç›´æ¥è¾“å…¥notify null,notify null2</span></span><br></pre></td></tr></table></figure><p>å½“æœ‰enteræ—¶å€™dg_value+1ã€‚leaveæ—¶å€™-1ã€‚<br>å½“æœ€åä¸€ä¸ªleaveæ‰§è¡Œåï¼Œdg_value==0ã€‚å»å¾ªç¯é“¾è¡¨æ‰§è¡Œnotifyçš„å›è°ƒ</p><figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">    <span class="built_in">let</span> <span class="built_in">g1</span> = DispatchGroup.init()</span><br><span class="line">  </span><br><span class="line">        //A B å¹¶å‘ A B å®Œæˆåå¼€å¯Cä»»åŠ¡</span><br><span class="line"></span><br><span class="line">        <span class="built_in">g1</span>.enter()</span><br><span class="line">        DispatchQueue.global().async &#123;</span><br><span class="line">            <span class="keyword">for</span> <span class="symbol">_</span> <span class="keyword">in</span> <span class="number">0</span>...<span class="number">3</span>&#123;</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">"task A: \(Thread.current)"</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">g1</span>.leave()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">g1</span>.enter()</span><br><span class="line">        DispatchQueue.global().async &#123;</span><br><span class="line">            <span class="keyword">for</span> <span class="symbol">_</span> <span class="keyword">in</span> <span class="number">0</span>...<span class="number">3</span>&#123;</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">"task B: \(Thread.current)"</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">g1</span>.leave()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">g1</span>.notify(queue: DispatchQueue.global()) &#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"notify A&amp;B"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æºç ä¹Ÿå¾—çŸ¥ï¼Œenterå’Œleaveå¿…é¡»æˆå¯¹å‡ºç°ã€‚</p><p>å½“enterå¤šçš„æ—¶å€™ï¼Œdg_valueæ°¸è¿œå¤§äº0ï¼Œnotifyä¸ä¼šè¢«æ‰§è¡Œã€‚</p><p>å½“leaveå¤šçš„æ—¶å€™ï¼Œdg_valueå°äº0ï¼Œé€ æˆCrash</p><h4 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h4><p>Appleçš„APIå°è£…çš„å¾ˆå¥½ï¼Œå…¶ä¸­çš„ä¸€äº›è®¾è®¡æ¨¡å¼ä¹Ÿå€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚</p><p>GCDçš„æ‰§è¡Œæ•ˆç‡ç‰¹åˆ«é«˜ï¼Œåœ¨è¯»æºç ä¸­å‘ç°ifåˆ¤æ–­ç”¨äº†å¾ˆå¤š<code>slowpath</code> <code>fastpath</code></p><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">dispatch_group_leave(dispatch_group_t dg)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//dg_value -1</span></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">value</span> = os_atomic_dec2o(dg, dg_value, release);</span><br><span class="line"><span class="keyword">if</span> (slowpath(<span class="keyword">value</span> == <span class="number">0</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">void</span>)_dispatch_group_wake(dg, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸æˆå¯¹å‡ºç° crash</span></span><br><span class="line"><span class="keyword">if</span> (slowpath(<span class="keyword">value</span> &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">DISPATCH_CLIENT_CRASH(<span class="keyword">value</span>,</span><br><span class="line"><span class="string">"Unbalanced call to dispatch_group_leave()"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¼šå†å¦èµ·ä¸€ç¯‡åšå®¢æ¥ç ”ç©¶ã€‚</p><p>å…³äºDispatchGroup çš„<code>wait()</code>å®ç°å°±ä¸å†åˆ†æäº†ã€‚å¤§å®¶å¯ä»¥è‡ªè¡Œä¸‹è½½æºç æ¥ç ”ç©¶ä¸‹ã€‚</p><p>å¸¦æ³¨é‡Šçš„æºç è¯¦è§Github:</p><p><a href="https://github.com/liweican1992/libdispatch" target="_blank" rel="noopener">https://github.com/liweican1992/libdispatch</a></p><p><a href="https://github.com/liweican1992/swift-corelibs-foundation" target="_blank" rel="noopener">https://github.com/liweican1992/swift-corelibs-foundation</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä»æºç åˆ†æGCDä¸­çš„DispatchGroupæ˜¯æ€ä¹ˆè°ƒåº¦çš„ï¼Œnotifyçš„èƒŒåæ˜¯å¦‚ä½•å®ç°çš„ã€‚å¦‚æœä½ å¯¹Swiftä¸­GCDå¦‚ä½•ä½¿ç”¨ä¸å¤ªäº†è§£ã€‚å¯ä»¥å‚è€ƒ&lt;a href=&quot;http://leevcan.com/2020/05/22/%E4%BB%8E%E
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>è¯¦è§£Swiftå¤šçº¿ç¨‹</title>
    <link href="http://yoursite.com/2020/05/22/%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90Swift%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <id>http://yoursite.com/2020/05/22/%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90Swift%E5%A4%9A%E7%BA%BF%E7%A8%8B/</id>
    <published>2020-05-22T09:18:00.000Z</published>
    <updated>2025-07-18T02:26:36.034Z</updated>
    
    <content type="html"><![CDATA[<p>Swiftç»ˆäºåœ¨5.xç‰ˆæœ¬å˜å¾—ç¨³å®šï¼Œå…ˆæ¥çœ‹çœ‹Swift5.1ä¸­çš„GCDå¦‚ä½•ä½¿ç”¨</p><ul><li><h4 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h4></li></ul><h6 id="ä¸²è¡Œé˜Ÿåˆ—"><a href="#ä¸²è¡Œé˜Ÿåˆ—" class="headerlink" title="ä¸²è¡Œé˜Ÿåˆ—"></a>ä¸²è¡Œé˜Ÿåˆ—</h6><p>ä¸²è¡Œé˜Ÿåˆ—ä¸€èˆ¬åªåˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œé˜Ÿåˆ—å¦‚æœæœ‰ä»»åŠ¡æ‰§è¡Œæ˜¯ä¸å…è®¸æ’é˜Ÿã€‚<br>ä¸²è¡Œé˜Ÿåˆ—ä¸­æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ä¸å…è®¸è¢«å½“å‰é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡é˜»å¡ï¼ˆæ­»é”ï¼‰ï¼Œä½†æ˜¯èƒ½è¢«å…¶ä»–å¯¹åˆ—é˜»å¡</p><p>é»˜è®¤åˆ›å»ºçš„æ˜¯ä¸²è¡Œé˜Ÿåˆ—</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">let<span class="built_in"> queue </span>= DispatchQueue(label: <span class="string">"com.youdao.queueName"</span>)</span><br></pre></td></tr></table></figure><p>ä¸»çº¿ç¨‹å°±æ˜¯ä¸²è¡Œé˜Ÿåˆ—</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>main</span><br></pre></td></tr></table></figure><p>å¸¸è§çš„ä¸»çº¿ç¨‹æ­»é”</p><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="comment">//main Threed</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="number">1</span>)</span></span></span><br><span class="line">DispatchQueue<span class="selector-class">.main</span><span class="selector-class">.sync</span> &#123;</span><br><span class="line">     print(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="number">3</span>)</span></span></span><br></pre></td></tr></table></figure><a id="more"></a><h6 id="ï¼ˆå¹¶è¡Œé˜Ÿåˆ—ï¼‰-å¹¶å‘é˜Ÿåˆ—"><a href="#ï¼ˆå¹¶è¡Œé˜Ÿåˆ—ï¼‰-å¹¶å‘é˜Ÿåˆ—" class="headerlink" title="ï¼ˆå¹¶è¡Œé˜Ÿåˆ—ï¼‰  å¹¶å‘é˜Ÿåˆ—"></a><del>ï¼ˆå¹¶è¡Œé˜Ÿåˆ—ï¼‰</del>  å¹¶å‘é˜Ÿåˆ—</h6><p>å¹¶è¡Œ(parallel)ï¼šæŒ‡åœ¨åŒä¸€æ—¶åˆ»ï¼Œæœ‰å¤šæ¡æŒ‡ä»¤åœ¨å¤šä¸ªå¤„ç†å™¨ä¸ŠåŒæ—¶æ‰§è¡Œã€‚æ‰€ä»¥æ— è®ºä»å¾®è§‚è¿˜æ˜¯ä»å®è§‚æ¥çœ‹ï¼ŒäºŒè€…éƒ½æ˜¯ä¸€èµ·æ‰§è¡Œçš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121052.png" alt=""><br>å¹¶å‘(concurrency)ï¼šæŒ‡åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œï¼Œä½†å¤šä¸ªè¿›ç¨‹æŒ‡ä»¤è¢«å¿«é€Ÿçš„è½®æ¢æ‰§è¡Œï¼Œä½¿å¾—åœ¨å®è§‚ä¸Šå…·æœ‰å¤šä¸ªè¿›ç¨‹åŒæ—¶æ‰§è¡Œçš„æ•ˆæœï¼Œä½†åœ¨å¾®è§‚ä¸Šå¹¶ä¸æ˜¯åŒæ—¶æ‰§è¡Œçš„ï¼Œåªæ˜¯æŠŠæ—¶é—´åˆ†æˆè‹¥å¹²æ®µï¼Œä½¿å¤šä¸ªè¿›ç¨‹å¿«é€Ÿäº¤æ›¿çš„æ‰§è¡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121114.png" alt=""></p><p>Erlang ä¹‹çˆ¶ Joe Armstrong çš„è§£é‡Š</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121133.png" alt=""></p><p>åˆ›å»ºå¹¶å‘é˜Ÿåˆ—</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> taskD_queue = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>init(label: <span class="string">"com.youdao.concurrent"</span>, attributes: .concurrent)</span><br></pre></td></tr></table></figure><p>ç³»ç»Ÿå¹¶å‘é˜Ÿåˆ—</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> globalQueue = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global<span class="literal">()</span></span><br></pre></td></tr></table></figure><h6 id="æ›´å¤šå‚æ•°"><a href="#æ›´å¤šå‚æ•°" class="headerlink" title="æ›´å¤šå‚æ•°"></a>æ›´å¤šå‚æ•°</h6><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> convenience init(<span class="string">label:</span> String, <span class="string">qos:</span> DispatchQoS = .unspecified, <span class="string">attributes:</span> DispatchQueue.Attributes = [],</span><br><span class="line"><span class="string">autoreleaseFrequency:</span> DispatchQueue.AutoreleaseFrequency = .inherit, <span class="string">target:</span> DispatchQueue? = nil)</span><br></pre></td></tr></table></figure><p><strong>qos</strong></p><p>Quality of Service(æœåŠ¡è´¨é‡)<br>é˜Ÿåˆ—æ‰§è¡Œæœ‰ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°ä½</p><ul><li>userInteractiveï¼š ç”¨æˆ·äº¤äº’ä»»åŠ¡ï¼ˆä¾‹å¦‚åŠ¨ç”»ï¼Œäº‹ä»¶å¤„ç†æˆ–æ›´æ–°åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢ï¼‰çš„æœåŠ¡</li><li>userInitiatedï¼šç”¨æˆ·å‘èµ·çš„åŠ¨ä½œéœ€è¦ç«‹å³å¾—åˆ°ç»“æœ å¦‚æ‰“å¼€æ–‡æ¡£ï¼Œæ˜¾ç¤ºç”µå­é‚®ä»¶</li><li>defaultï¼šé»˜è®¤çš„</li><li>utility:ç”¨æˆ·ä¸ä¸»åŠ¨å…³æ³¨çš„ï¼Œä¸€äº›è€—æ—¶æ“ä½œã€‚ä¸‹è½½æˆ–è€…å¯¼å…¥æ•°æ®,utilityä»»åŠ¡ä¸€èˆ¬æœ‰ä¸€ä¸ªè¿›åº¦æ¡è®©ç”¨æˆ·èƒ½çœ‹åˆ°</li><li>backgroundï¼šæœ€ä½ä¼˜å…ˆçº§ åå°è¿è¡Œã€‚å»ºç«‹ç´¢å¼• æ¸…ç†æ–‡ä»¶</li></ul><p>é»˜è®¤å€¼ä¸º <strong>default</strong></p><p>è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„<strong>unspecified</strong></p><blockquote><p>å®ƒè¡¨ç¤ºå½“å‰æ²¡æœ‰QoSä¿¡æ¯ï¼Œç³»ç»Ÿåº”è¯¥æ ¹æ®ç¯å¢ƒè‡ªåŠ¨æ¨æ–­QoSä¿¡æ¯ã€‚å¦‚æœä½¿ç”¨é—å¼ƒçš„APIï¼Œçº¿ç¨‹æœ‰å¯èƒ½ä¼šè„±ç¦»QoSï¼Œè¿™ä¸ªæ—¶å€™ï¼Œçº¿ç¨‹å°±æ˜¯unspecified QoSç±»åˆ«çš„</p></blockquote><p>å› æ­¤ç³»ç»Ÿå¹¶å‘é˜Ÿåˆ—æœ‰6ä¸ª</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> globalQueue1 = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global(qos: .userInteractive)</span><br><span class="line"><span class="keyword">let</span> globalQueue2 = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global(qos: .userInitiated)</span><br><span class="line"><span class="keyword">let</span> globalQueue5 = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global<span class="literal">()</span> <span class="comment">//qos default </span></span><br><span class="line"><span class="keyword">let</span> globalQueue3 = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global(qos: .utility)</span><br><span class="line"><span class="keyword">let</span> globalQueue4 = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global(qos: .background)</span><br><span class="line"><span class="comment">//âŒ  ä¸å­˜åœ¨è¿™ç§</span></span><br><span class="line"><span class="keyword">let</span> globalQueue4 = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global(qos: .unspecified)</span><br></pre></td></tr></table></figure><blockquote><p>è¦æ³¨æ„ï¼Œåœ¨Low Power Modeä¸‹ï¼Œqosä¸ºbackgroundçš„é˜Ÿåˆ—å°†è¢«æš‚åœ</p></blockquote><p><strong>attributes</strong></p><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Set</span></span><br><span class="line"><span class="keyword">public</span> struct <span class="string">Attributes :</span> OptionSet</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> let <span class="string">concurrent:</span> DispatchQueue.Attributes</span><br><span class="line"></span><br><span class="line"><span class="meta">@available</span>(OSX <span class="number">10.12</span>, iOS <span class="number">10.0</span>, tvOS <span class="number">10.0</span>, watchOS <span class="number">3.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> let <span class="string">initiallyInactive:</span> DispatchQueue.Attributes</span><br></pre></td></tr></table></figure><ul><li>concurrentï¼šæ ‡è®°ä¸ºå¹¶å‘é˜Ÿåˆ—</li><li>initiallyInactiveï¼šæ ‡è¯†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éœ€è¦æ‰‹åŠ¨è§¦å‘ï¼Œç”±é˜Ÿåˆ—activate()æ–¹æ³•è§¦å‘ã€‚æœªæ ‡è®°initiallyInactiveçš„é˜Ÿåˆ—ä¼šè‡ªåŠ¨è§¦å‘ä»»åŠ¡</li></ul><p>ä¸æ ‡æ˜æ­¤å‚æ•°ï¼Œé»˜è®¤æ˜¯ä¸²è¡Œé˜Ÿåˆ—ã€‚</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸²è¡Œé˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">let</span> task_queue_ser = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>init(label: <span class="string">"com.youdao.queue"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¹¶å‘é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">let</span> task_queue_concurrent = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>init(label: <span class="string">"com.youdao.queue"</span>, attributes: .concurrent)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰‹åŠ¨è§¦å‘</span></span><br><span class="line"><span class="keyword">let</span> task_queue_initial = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>init(label: <span class="string">"com.youdao.queue"</span>, attributes: .initiallyInactive)</span><br><span class="line">task_queue_initial.active<span class="literal">()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰‹åŠ¨è§¦å‘çš„å¹¶å‘é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">let</span> task_queue_combine = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>init(label: <span class="string">"com.youdao.queue"</span>, attributes: <span class="literal">[.<span class="identifier">concurrent</span>, .<span class="identifier">initiallyInactive</span>]</span>)</span><br><span class="line">task_queue_combine.active<span class="literal">()</span></span><br></pre></td></tr></table></figure><p><strong>autoreleaseFrequency</strong></p><p>autoreleaseFrequencyæ˜¯æšä¸¾ï¼Œæ ‡æ˜autoreleasepoolçš„é‡Šæ”¾é¢‘ç‡</p><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">enum</span> AutoreleaseFrequency &#123;</span><br><span class="line">        <span class="comment">//ç»§æ‰¿ç›®æ ‡é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">case</span> inherit</span><br><span class="line">        <span class="comment">//è·Ÿéšæ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œå‘¨æœŸè¿›è¡Œè‡ªåŠ¨åˆ›å»ºå’Œé‡Šæ”¾</span></span><br><span class="line">        @available(OSX <span class="number">10.12</span>, iOS <span class="number">10.0</span>, tvOS <span class="number">10.0</span>, watchOS <span class="number">3.0</span>, *)</span><br><span class="line">        <span class="keyword">case</span> workItem</span><br><span class="line">        <span class="comment">//ä¸åˆ›å»ºautoreleasepool</span></span><br><span class="line">        @available(OSX <span class="number">10.12</span>, iOS <span class="number">10.0</span>, tvOS <span class="number">10.0</span>, watchOS <span class="number">3.0</span>, *)</span><br><span class="line">        <span class="keyword">case</span> never</span><br><span class="line">        </span><br><span class="line">        ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå·±åˆ›å»ºçš„é˜Ÿåˆ—ï¼Œé»˜è®¤å€¼æ˜¯ .inherit</p><p>ç³»ç»Ÿå®šä¹‰çš„å…¨å±€é˜Ÿåˆ—ï¼Œæ­¤å±æ€§æ˜¯ .never</p><p>å¦‚æœä»»åŠ¡ä¸­éœ€è¦å¤§é‡åˆ›å»ºå¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®ä¸º.neverï¼Œç„¶åæ‰‹åŠ¨åˆ›å»ºautoreleasepool</p><p><strong>target</strong></p><p>è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—çš„ç›®æ ‡é˜Ÿåˆ—ï¼Œè®²å½“å‰é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ”¾åˆ°ç›®æ ‡é˜Ÿåˆ—ä¸­å–æ‰§è¡Œã€‚ç›®æ ‡é˜Ÿåˆ—æœ€ç»ˆçº¦æŸäº†é˜Ÿåˆ—ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚</p><p>æ‰€æœ‰æ‰‹åŠ¨åˆ›å»ºçš„é˜Ÿåˆ—ï¼Œtargetæœ€ç»ˆéƒ½æŒ‡å‘äº†ç³»ç»Ÿè‡ªå¸¦çš„é˜Ÿåˆ—ã€‚ä¸»é˜Ÿåˆ—æˆ–è€…å…¨å±€å¹¶å‘é˜Ÿåˆ—ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆä¸ç›´æ¥åŠ åˆ°ç³»ç»Ÿé˜Ÿåˆ—ï¼Œè€Œæ˜¯è¦è‡ªå®šä¹‰é˜Ÿåˆ—å‘¢ï¼Ÿè¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥å°†ä»»åŠ¡åˆ†ç»„ç®¡ç†ã€‚å¦‚å•ç‹¬é˜»å¡æŸä¸ªé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯é˜»å¡ç³»ç»Ÿé˜Ÿåˆ—ä¸­çš„å…¨éƒ¨ä»»åŠ¡ã€‚å¦‚æœé˜»å¡äº†ç³»ç»Ÿé˜Ÿåˆ—ï¼Œæ‰€æœ‰æŒ‡å‘å®ƒçš„åŸé˜Ÿåˆ—ä¹Ÿå°±è¢«é˜»å¡ã€‚</p></blockquote><p>è®¾ç½®targetå¯ä»¥åœ¨DispatchQueueåˆå§‹åŒ–æ—¶å€™æŒ‡å®šã€‚</p><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">let task_queue = DispatchQueue.init(<span class="string">label:</span> <span class="string">"abc"</span>, <span class="string">qos:</span> .<span class="keyword">default</span>, <span class="string">attributes:</span> [.concurrent], <span class="string">autoreleaseFrequency:</span> .workItem, <span class="string">target:</span> DispatchQueue.global())</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŒ‡å®šattributesä¸º.initiallyInactiveã€‚æ‰‹åŠ¨è§¦å‘å‰ä½¿ç”¨setTargetæ›´æ”¹æŒ‡å®šçš„target</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> task_queue = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>init(label: <span class="string">"abc"</span>, qos: .default, attributes: <span class="literal">[.<span class="identifier">initiallyInactive</span>, .<span class="identifier">concurrent</span>]</span>, autoreleaseFrequency: .workItem, target: <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>global<span class="literal">()</span>)</span><br><span class="line">        </span><br><span class="line">task_queue.set<span class="constructor">Target(<span class="params">queue</span>: DispatchQueue.<span class="params">global</span>(<span class="params">qos</span>: .<span class="params">background</span>)</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ€è€ƒä¸‹ï¼Œä¸‹æ–¹ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆã€‚</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> task_queue = <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>init(label: <span class="string">"abc"</span>, qos: .default, attributes: <span class="literal">[.<span class="identifier">initiallyInactive</span>, .<span class="identifier">concurrent</span>]</span>, autoreleaseFrequency: .workItem, target: <span class="module-access"><span class="module"><span class="identifier">DispatchQueue</span>.</span></span>main)</span><br><span class="line">        </span><br><span class="line">task_queue.async &#123;</span><br><span class="line">    for k <span class="keyword">in</span> <span class="number">0.</span>.&lt;<span class="number">10</span> &#123;</span><br><span class="line">        print( <span class="string">"A"</span> + <span class="constructor">String(<span class="params">k</span>)</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task_queue.async &#123;</span><br><span class="line">    for k <span class="keyword">in</span> <span class="number">0.</span>.&lt;<span class="number">10</span> &#123;</span><br><span class="line">        print( <span class="string">"B"</span> + <span class="constructor">String(<span class="params">k</span>)</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line">task_queue.activate<span class="literal">()</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Swiftç»ˆäºåœ¨5.xç‰ˆæœ¬å˜å¾—ç¨³å®šï¼Œå…ˆæ¥çœ‹çœ‹Swift5.1ä¸­çš„GCDå¦‚ä½•ä½¿ç”¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;h4 id=&quot;é˜Ÿåˆ—&quot;&gt;&lt;a href=&quot;#é˜Ÿåˆ—&quot; class=&quot;headerlink&quot; title=&quot;é˜Ÿåˆ—&quot;&gt;&lt;/a&gt;é˜Ÿåˆ—&lt;/h4&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h6 id=&quot;ä¸²è¡Œé˜Ÿåˆ—&quot;&gt;&lt;a href=&quot;#ä¸²è¡Œé˜Ÿåˆ—&quot; class=&quot;headerlink&quot; title=&quot;ä¸²è¡Œé˜Ÿåˆ—&quot;&gt;&lt;/a&gt;ä¸²è¡Œé˜Ÿåˆ—&lt;/h6&gt;&lt;p&gt;ä¸²è¡Œé˜Ÿåˆ—ä¸€èˆ¬åªåˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œé˜Ÿåˆ—å¦‚æœæœ‰ä»»åŠ¡æ‰§è¡Œæ˜¯ä¸å…è®¸æ’é˜Ÿã€‚&lt;br&gt;ä¸²è¡Œé˜Ÿåˆ—ä¸­æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ä¸å…è®¸è¢«å½“å‰é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡é˜»å¡ï¼ˆæ­»é”ï¼‰ï¼Œä½†æ˜¯èƒ½è¢«å…¶ä»–å¯¹åˆ—é˜»å¡&lt;/p&gt;
&lt;p&gt;é»˜è®¤åˆ›å»ºçš„æ˜¯ä¸²è¡Œé˜Ÿåˆ—&lt;/p&gt;
&lt;figure class=&quot;highlight routeros&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;let&lt;span class=&quot;built_in&quot;&gt; queue &lt;/span&gt;= DispatchQueue(label: &lt;span class=&quot;string&quot;&gt;&quot;com.youdao.queueName&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;ä¸»çº¿ç¨‹å°±æ˜¯ä¸²è¡Œé˜Ÿåˆ—&lt;/p&gt;
&lt;figure class=&quot;highlight reasonml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;module-access&quot;&gt;&lt;span class=&quot;module&quot;&gt;&lt;span class=&quot;identifier&quot;&gt;DispatchQueue&lt;/span&gt;.&lt;/span&gt;&lt;/span&gt;main&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;å¸¸è§çš„ä¸»çº¿ç¨‹æ­»é”&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//main Threed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DispatchQueue&lt;span class=&quot;selector-class&quot;&gt;.main&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.sync&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     print(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
      <category term="å¤šçº¿ç¨‹" scheme="http://yoursite.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>è½¬ç§»ç®€ä¹¦åˆ°Github</title>
    <link href="http://yoursite.com/2020/05/15/%E8%BD%AC%E7%A7%BB%E7%AE%80%E4%B9%A6%E5%88%B0Github/"/>
    <id>http://yoursite.com/2020/05/15/%E8%BD%AC%E7%A7%BB%E7%AE%80%E4%B9%A6%E5%88%B0Github/</id>
    <published>2020-05-15T10:40:00.000Z</published>
    <updated>2025-07-07T06:09:16.144Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©ç®€ä¹¦è´¦å·è«åå…¶å¦™çš„è¢«å°äº†ï¼ŒåŠ ä¸Šä¹‹å‰å°äº†å¥½å‡ ç¯‡æŠ€æœ¯æ–‡ç« ã€‚ç»ˆäºä½¿æˆ‘ä¸‹å®šå†³å¿ƒå¹²æ‰ç®€ä¹¦ã€‚</p><p>ç”¨ç®€ä¹¦å·²ç»æœ‰5å¹´äº†ï¼Œå†™äº†20å¤šç¯‡åšå®¢ï¼Œæ”¶è·äº†100+çš„ç²‰ä¸ã€‚</p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601142307.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601142320.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601142351.png" alt=""></p><p>ç”šè‡³è¿˜æ”¶åˆ°äº†å‡ å—é’±çš„æ‰“èµ<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200625003458.png" alt=""></p><p>ç°åœ¨è§„åˆ™è¶Šæ¥è¶Šä¸¥æ ¼ï¼Œä¹‹å‰å†™çš„å¾ˆå¤šæ–‡ç« éƒ½è¢«è½¬æˆåªæœ‰è‡ªå·±å¯è§äº†ã€‚<br>è¿™æ¬¡è¢«å°åº”è¯¥æ˜¯æ–‡ç« ä¸­æ·»åŠ äº†å‚è€ƒé“¾æ¥ã€‚</p><p>ä»¥åæ–‡ç« éƒ½ä¼šæ›´æ–°åœ¨githubåšå®¢ä¸Šï¼Œæˆ‘ä¹Ÿä¼šæŠŠç®€ä¹¦çš„æ—§æ–‡ç« è½¬ç§»è¿‡æ¥ï¼Œåˆšå¥½æ¸…ç†ä¸€æ³¢è´¨é‡è¾ƒå·®çš„æ–‡ç« ã€‚</p><p>åšå®¢åœ°å€ä¸ºï¼š<a href="http://leevcan.com/" target="_blank" rel="noopener">http://leevcan.com/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©ç®€ä¹¦è´¦å·è«åå…¶å¦™çš„è¢«å°äº†ï¼ŒåŠ ä¸Šä¹‹å‰å°äº†å¥½å‡ ç¯‡æŠ€æœ¯æ–‡ç« ã€‚ç»ˆäºä½¿æˆ‘ä¸‹å®šå†³å¿ƒå¹²æ‰ç®€ä¹¦ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ç®€ä¹¦å·²ç»æœ‰5å¹´äº†ï¼Œå†™äº†20å¤šç¯‡åšå®¢ï¼Œæ”¶è·äº†100+çš„ç²‰ä¸ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="æ‚è°ˆ" scheme="http://yoursite.com/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>Facebook iOS SDK é€ æˆå¤§é¢ç§¯å´©æºƒ</title>
    <link href="http://yoursite.com/2020/05/08/Facebook-iOS-SDK-%E9%80%A0%E6%88%90%E5%A4%A7%E9%9D%A2%E7%A7%AF%E5%B4%A9%E6%BA%83/"/>
    <id>http://yoursite.com/2020/05/08/Facebook-iOS-SDK-%E9%80%A0%E6%88%90%E5%A4%A7%E9%9D%A2%E7%A7%AF%E5%B4%A9%E6%BA%83/</id>
    <published>2020-05-08T06:28:00.000Z</published>
    <updated>2025-07-07T06:09:16.138Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>update:2020.07.10 FaceBook SDK åˆåŒå’å•å´©æºƒäº†ã€‚è¿™æ¬¡è²Œä¼¼æ¯”ä¸Šæ¬¡è¿˜ä¸¥é‡ã€‚é€šè¿‡è¿™ä¸¤æ¬¡å¤§èŒƒå›´å´©æºƒï¼Œå……åˆ†æš´éœ²äº†Facebookå†…éƒ¨æµç¨‹å‡ºç°äº†å¾ˆå¤§çš„é—®é¢˜ã€‚è¿™æ¬¡é—®é¢˜çš„åŸå› åˆæ˜¯SDKè¿œç¨‹ä¸‹æ–¹é…ç½®æ–‡ä»¶é€ æˆçš„ã€‚</p></blockquote><p>è¯¦è§:</p><p><a href="https://github.com/facebook/facebook-ios-sdk/issues/1427" target="_blank" rel="noopener">https://github.com/facebook/facebook-ios-sdk/issues/1427</a><br><a href="https://developers.facebook.com/support/bugs/329763701368293/" target="_blank" rel="noopener">https://developers.facebook.com/support/bugs/329763701368293/</a></p><hr><p>ä¸€å¤§æ—©å°±æ¥åˆ°è­¦å‘Šï¼ŒAppå´©æºƒç‡ç›´çº¿ä¸Šå‡ã€‚èµ¶ç´§å®šä½é”™è¯¯ï¼Œå‘ç°æ˜¯å´©åœ¨äº†Facebook SDKä¸Šé¢ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601142944.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143021.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143043.png" alt=""></p><p>å› ä¸ºæˆ‘ä»¬æ˜¯æµ·å¤–é¡¹ç›®ã€‚å—å½±å“æœ€å¤§ï¼Œæ‰€ä»¥æœ€å…ˆæ¥åˆ°è­¦å‘Šã€‚<br>çœ‹äº†ä¸‹ï¼Œåº”è¯¥æ˜¯Facebook SDKåˆå§‹åŒ–æ—¶å€™å°±crashäº†ï¼ŒåŒæ—¶ä¹Ÿæœ‰ç”¨æˆ·åé¦ˆAppä¸€å¯åŠ¨å°±é—ªé€€ã€‚</p><a id="more"></a><p>ä½†æ˜¯ä»Šå¤©å†æµ‹è¯•ï¼ˆ2020.05.08 åŒ—äº¬æ—¶é—´ï¼‰ï¼Œæ— æ³•å¤ç°é—®é¢˜ï¼Œçœ‹æ¥å·²ç»è¢«ä¿®å¤äº†ã€‚<br>å»Githubä¸Šå›´è§‚äº†ä¸€ä¸‹ï¼Œå½±å“èŒƒå›´å¯è°“æ˜¯å·¨å¤§</p><blockquote><p>è¯¦è§issue:<br><a href="https://github.com/facebook/facebook-ios-sdk/issues/1373" target="_blank" rel="noopener">https://github.com/facebook/facebook-ios-sdk/issues/1373</a><br><a href="https://github.com/facebook/facebook-ios-sdk/issues/1374" target="_blank" rel="noopener">https://github.com/facebook/facebook-ios-sdk/issues/1374</a></p></blockquote><p>å®˜æ–¹ä¹Ÿæ‰¿è®¤æ˜¯SDKçš„é—®é¢˜ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143102.png" alt=""></p><p>æœ‰äººçŒœæµ‹æ˜¯å°†Boolå€¼æ”¾å…¥äº†å­—å…¸ä¸­<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143112.png" alt=""></p><p>é—®é¢˜å·²ç»è§£å†³ï¼Œä½†æ˜¯æ•™è®­è¿˜æ˜¯æ¯”è¾ƒæ·±åˆ»çš„ã€‚ä»»ä½•æ”¹åŠ¨ä¸Šçº¿å‰ï¼Œä¸€å®šè¦è¿›è¡Œç°åº¦æµ‹è¯•ã€‚</p><p>åªæ˜¯å¯æƒœäº†æˆ‘ä»¬Appçš„99.9%çš„ç¨³å®šæ€§ :(<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143129.png" alt=""><br>å‚è€ƒé“¾æ¥ ï¼š</p><p><a href="https://www.theverge.com/2020/5/7/21250689/facebook-sdk-bug-ios-app-crash-apple-spotify-venmo-tiktok-tinder" target="_blank" rel="noopener">Why a small Facebook bug wreaked havoc on some of the most popular iOS apps</a><br><a href="https://www.thepaper.cn/newsDetail_forward_7301372" target="_blank" rel="noopener">å°æ‰çš„Facebookï¼Œæç‚¸äº†å‡ åä¸‡ä¸ªiOSåº”ç”¨ç¨‹åº</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;update:2020.07.10 FaceBook SDK åˆåŒå’å•å´©æºƒäº†ã€‚è¿™æ¬¡è²Œä¼¼æ¯”ä¸Šæ¬¡è¿˜ä¸¥é‡ã€‚é€šè¿‡è¿™ä¸¤æ¬¡å¤§èŒƒå›´å´©æºƒï¼Œå……åˆ†æš´éœ²äº†Facebookå†…éƒ¨æµç¨‹å‡ºç°äº†å¾ˆå¤§çš„é—®é¢˜ã€‚è¿™æ¬¡é—®é¢˜çš„åŸå› åˆæ˜¯SDKè¿œç¨‹ä¸‹æ–¹é…ç½®æ–‡ä»¶é€ æˆçš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¯¦è§:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/facebook/facebook-ios-sdk/issues/1427&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/facebook/facebook-ios-sdk/issues/1427&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://developers.facebook.com/support/bugs/329763701368293/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://developers.facebook.com/support/bugs/329763701368293/&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸€å¤§æ—©å°±æ¥åˆ°è­¦å‘Šï¼ŒAppå´©æºƒç‡ç›´çº¿ä¸Šå‡ã€‚èµ¶ç´§å®šä½é”™è¯¯ï¼Œå‘ç°æ˜¯å´©åœ¨äº†Facebook SDKä¸Šé¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601142944.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143021.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143043.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬æ˜¯æµ·å¤–é¡¹ç›®ã€‚å—å½±å“æœ€å¤§ï¼Œæ‰€ä»¥æœ€å…ˆæ¥åˆ°è­¦å‘Šã€‚&lt;br&gt;çœ‹äº†ä¸‹ï¼Œåº”è¯¥æ˜¯Facebook SDKåˆå§‹åŒ–æ—¶å€™å°±crashäº†ï¼ŒåŒæ—¶ä¹Ÿæœ‰ç”¨æˆ·åé¦ˆAppä¸€å¯åŠ¨å°±é—ªé€€ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>iOSä½¿ç”¨Public Link è¿›è¡Œå¤–éƒ¨æµ‹è¯•</title>
    <link href="http://yoursite.com/2020/03/13/iOS%E4%BD%BF%E7%94%A8Public-Link-%E8%BF%9B%E8%A1%8C%E5%A4%96%E9%83%A8%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2020/03/13/iOS%E4%BD%BF%E7%94%A8Public-Link-%E8%BF%9B%E8%A1%8C%E5%A4%96%E9%83%A8%E6%B5%8B%E8%AF%95/</id>
    <published>2020-03-13T06:33:00.000Z</published>
    <updated>2025-07-07T06:09:16.142Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>public link æ˜¯Apple 2018å¹´æ¨å‡ºçš„æ–°åŠŸèƒ½ï¼Œå¯ä»¥å¾ˆä½æˆæœ¬çš„è¿›è¡Œå¤–éƒ¨ç°åº¦æµ‹è¯•ï¼Œå¹¶ä¸”å¯ä»¥é›¶æˆæœ¬çš„æµ‹è¯•å†…è´­åŠŸèƒ½</p></blockquote><p>  æœ€è¿‘è´Ÿè´£çš„é¡¹ç›®è¿›è¡Œäº†é‡å¤§æ”¹ç‰ˆï¼Œå‡†å¤‡ç”³è¯·Appleæ¨èã€‚æƒ³å…ˆå‘ä¸ªBetaç‰ˆæœ¬ç»™Appleçš„ç¼–è¾‘äººå‘˜çœ‹ä¸€ä¸‹ï¼Œä¹Ÿå°èŒƒå›´çš„è¿›è¡Œä¸‹ç°åº¦æµ‹è¯•ã€‚æœ€æ–¹ä¾¿çš„åŠæ³•å°±æ˜¯é€šè¿‡Testflightè¿›è¡Œæµ‹è¯•ã€‚</p><p>  è¿˜è®°å¾—2017å¹´æ—¶å€™ç”³è¯·æ¨èï¼Œå‘å¤–éƒ¨æµ‹è¯•è¿˜éœ€è¦æ‰‹åŠ¨çš„æŠŠAppleå·¥ä½œäººå‘˜çš„é‚®ç®±æ·»åŠ è¿›å»ã€‚Appleåœ¨2018å¹´æ¨å‡ºçš„public linkå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><blockquote><p>å…¬å…±é“¾æ¥å¯è®©æ‚¨ä¸å¼€å‘å›¢é˜Ÿå¤–éƒ¨çš„äººå‘˜å…±äº«æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€ç”µå­é‚®ä»¶æˆ–å…¶ä»–è”ç³»ä¿¡æ¯ã€‚æ‚¨å¯ä»¥åœ¨ç¤¾äº¤åª’ä½“ï¼Œæ¶ˆæ¯ä¼ é€’å¹³å°ï¼Œç”µå­é‚®ä»¶æ´»åŠ¨ç­‰ä¸Šå…±äº«å…¬å…±é“¾æ¥ï¼Œä»¥æ‰©å¤§Betaæµ‹è¯•çš„å¯è§æ€§ã€‚å¦‚æœæ‚¨æ²¡æœ‰ä¸€ç»„æˆç†Ÿçš„å¤–éƒ¨æµ‹è¯•äººå‘˜ï¼Œåˆ™ä½¿ç”¨å…¬å…±é“¾æ¥å¯èƒ½æ˜¯å¢åŠ åº”ç”¨ç¨‹åºè¦†ç›–é¢å¹¶æ‰©å¤§æµ‹è¯•å—ä¼—çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p></blockquote><a id="more"></a><p>å…·ä½“çš„æ­¥éª¤å…¶å®éƒ½æ˜¯å®˜ç½‘å¯æŸ¥ï¼Œè¿™é‡Œç®€å•è¯´ä¸€ä¸‹</p><ul><li><h4 id="åˆ›å»ºpublic-link"><a href="#åˆ›å»ºpublic-link" class="headerlink" title="åˆ›å»ºpublic link"></a>åˆ›å»ºpublic link</h4></li></ul><p>æ‰“åŒ…ä¸Šä¼ åˆ°App Storeåï¼Œç­‰å¤„ç†å®Œæˆã€‚å»Testflighté¡µé¢ã€‚åˆ›å»ºä¸€ä¸ªæ–°ç¾¤ç»„</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143338.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143428.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143440.png" alt=""></p><p>å¡«å†™å®Œå®¡æ ¸ä¿¡æ¯åï¼Œå°±å¯ä»¥æäº¤å®¡æ ¸äº†ã€‚å’Œå¹³æ—¶å‘ç‰ˆçš„å®¡æ ¸æ—¶é—´å·®ä¸å¤šã€‚</p><p>å®¡æ ¸é€šè¿‡åå°±å¯ä»¥å¯ç”¨public link<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143457.png" alt=""></p><p>å¯ç”¨åå¯ä»¥è®¾ç½®æœ€å¤§æµ‹è¯•äººæ•°ï¼Œä¸Šé™ä¸º10000äºº<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143513.png" alt=""></p><ul><li><h4 id="åˆ†å‘public-link"><a href="#åˆ†å‘public-link" class="headerlink" title="åˆ†å‘public link"></a>åˆ†å‘public link</h4>æ‹¿åˆ°public linkåï¼Œå°±å¯ä»¥å‘æ”¾ç»™ç”¨æˆ·äº†</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143609.png" alt=""></p><p>ç”¨æˆ·ç‚¹å‡»å¼€å§‹æµ‹è¯•ï¼Œå°±ä¼šå»å¾€Testflightã€‚å¦‚æœæ²¡è£…ä¼šå»Testflightä¸‹è½½é¡µé¢ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143634.png" alt=""></p><p>ç”¨æˆ·æ¥å—åå°±å¯ä»¥æ­£å¸¸å®‰è£…äº†ã€‚åŒæ—¶åœ¨Testflightåå°ï¼Œèƒ½çœ‹åˆ°å½“å‰æ¥å—é‚€è¯·äººå‘˜çš„Apple ID</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143656.png" alt=""></p><ul><li><h4 id="å†…è´­æµ‹è¯•"><a href="#å†…è´­æµ‹è¯•" class="headerlink" title="å†…è´­æµ‹è¯•"></a>å†…è´­æµ‹è¯•</h4></li></ul><p>å¦‚æœä½ çš„Appæœ‰å†…è´­é¡¹ç›®ï¼Œæˆ–è€…éƒ¨åˆ†åŠŸèƒ½éœ€è¦å†…è´­æ‰èƒ½ä½¿ç”¨ã€‚åˆ†å‘é“¾æ¥æ—¶å€™è¦è°¨æ…ã€‚<br>æˆ‘ä»¬åœ¨å†…éƒ¨Testflightæµ‹è¯•æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨æ²™ç›’è´¦æˆ·è¿›è¡Œå†…è´­è´­ä¹°ï¼Œå½“ä½ ä½¿ç”¨public linkè¿›è¡Œå¤–éƒ¨æµ‹è¯•æ—¶å€™ã€‚è¿™ä¸ªæ—¶å€™å†…è´­ç¯å¢ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å†…è´­ç¯å¢ƒã€‚</p><blockquote><p>public linkç¯å¢ƒä¸‹ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªå·±çœŸå®çš„Apple IDè¿›è¡Œå†…è´­è´­ä¹°ï¼Œä¸”ä¸ä¼šè¿›è¡Œæ‰£è´¹ã€‚è®¢é˜…é¡¹ç›®åŒæ ·ä¸ä¼šè¿›è¡Œç»­è®¢</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601143722.png" alt=""></p><blockquote><p>å‚è€ƒèµ„æ–™:<br><a href="https://developer.apple.com/videos/play/wwdc2018/301/" target="_blank" rel="noopener">Whatâ€™s New in App Store Connect</a><br><a href="https://developer.apple.com/testflight/" target="_blank" rel="noopener">ä½¿ç”¨TestFlightç®€åŒ–Betaæµ‹è¯•</a><br><a href="https://help.apple.com/app-store-connect/#/dev859139543" target="_blank" rel="noopener">é‚€è¯·å¤–éƒ¨æµ‹è¯•å‘˜</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;public link æ˜¯Apple 2018å¹´æ¨å‡ºçš„æ–°åŠŸèƒ½ï¼Œå¯ä»¥å¾ˆä½æˆæœ¬çš„è¿›è¡Œå¤–éƒ¨ç°åº¦æµ‹è¯•ï¼Œå¹¶ä¸”å¯ä»¥é›¶æˆæœ¬çš„æµ‹è¯•å†…è´­åŠŸèƒ½&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;  æœ€è¿‘è´Ÿè´£çš„é¡¹ç›®è¿›è¡Œäº†é‡å¤§æ”¹ç‰ˆï¼Œå‡†å¤‡ç”³è¯·Appleæ¨èã€‚æƒ³å…ˆå‘ä¸ªBetaç‰ˆæœ¬ç»™Appleçš„ç¼–è¾‘äººå‘˜çœ‹ä¸€ä¸‹ï¼Œä¹Ÿå°èŒƒå›´çš„è¿›è¡Œä¸‹ç°åº¦æµ‹è¯•ã€‚æœ€æ–¹ä¾¿çš„åŠæ³•å°±æ˜¯é€šè¿‡Testflightè¿›è¡Œæµ‹è¯•ã€‚&lt;/p&gt;
&lt;p&gt;  è¿˜è®°å¾—2017å¹´æ—¶å€™ç”³è¯·æ¨èï¼Œå‘å¤–éƒ¨æµ‹è¯•è¿˜éœ€è¦æ‰‹åŠ¨çš„æŠŠAppleå·¥ä½œäººå‘˜çš„é‚®ç®±æ·»åŠ è¿›å»ã€‚Appleåœ¨2018å¹´æ¨å‡ºçš„public linkå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…¬å…±é“¾æ¥å¯è®©æ‚¨ä¸å¼€å‘å›¢é˜Ÿå¤–éƒ¨çš„äººå‘˜å…±äº«æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€ç”µå­é‚®ä»¶æˆ–å…¶ä»–è”ç³»ä¿¡æ¯ã€‚æ‚¨å¯ä»¥åœ¨ç¤¾äº¤åª’ä½“ï¼Œæ¶ˆæ¯ä¼ é€’å¹³å°ï¼Œç”µå­é‚®ä»¶æ´»åŠ¨ç­‰ä¸Šå…±äº«å…¬å…±é“¾æ¥ï¼Œä»¥æ‰©å¤§Betaæµ‹è¯•çš„å¯è§æ€§ã€‚å¦‚æœæ‚¨æ²¡æœ‰ä¸€ç»„æˆç†Ÿçš„å¤–éƒ¨æµ‹è¯•äººå‘˜ï¼Œåˆ™ä½¿ç”¨å…¬å…±é“¾æ¥å¯èƒ½æ˜¯å¢åŠ åº”ç”¨ç¨‹åºè¦†ç›–é¢å¹¶æ‰©å¤§æµ‹è¯•å—ä¼—çš„æœ‰æ•ˆæ–¹æ³•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>[IAP]iOSå¦‚ä½•ä½¿ç”¨ä¿ƒé”€ä»£ç </title>
    <link href="http://yoursite.com/2019/08/21/IAP-iOS%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E4%BF%83%E9%94%80%E4%BB%A3%E7%A0%81/"/>
    <id>http://yoursite.com/2019/08/21/IAP-iOS%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E4%BF%83%E9%94%80%E4%BB%A3%E7%A0%81/</id>
    <published>2019-08-21T06:41:00.000Z</published>
    <updated>2025-07-07T06:09:16.139Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘é¡¹ç›®ä¸Šçº¿äº†Vipè®¢é˜…åŠŸèƒ½ï¼ŒåŒ…å«è¿ç»­åŒ…æœˆå’Œè¿ç»­åŒ…å¹´ã€‚ä¸Šçº¿åå¸‚åœºå’Œè¿è¥åŒäº‹é—®èƒ½ä¸èƒ½ç»™ä¸€äº›èµ„æ·±ç”¨æˆ·é€å‡ ä¸ªæœˆçš„ä¼šå‘˜ï¼Œæˆ–è€…ææ´»åŠ¨é€ä¼šå‘˜ã€‚å› ä¸ºæ˜¯æµ·å¤–é¡¹ç›®ï¼Œå†…è´­ä¸éœ€è¦ç”¨æˆ·ç³»ç»Ÿï¼ˆæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ç”¨æˆ·ç³»ç»Ÿï¼‰å®Œå…¨ä¾èµ–Appleè´­ä¹°å‡­è¯ã€‚æ‰€ä»¥ä¸èƒ½ä½¿ç”¨å›½å†…Appé‚£ç§æœåŠ¡ç«¯ç”Ÿæˆå…‘æ¢ç çš„åšæ³•ã€‚</p></blockquote><p>å› ä¸ºå®Œå…¨ä¾èµ–Appleï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ä»Appleè¿™è¾¹ä¸‹æ‰‹ã€‚è‡ªç„¶è€Œç„¶æƒ³åˆ°äº†Appleçš„ä¿ƒé”€ä»£ç ã€‚<br>å…ˆçœ‹çœ‹ä»€ä¹ˆæ˜¯ä¿ƒé”€ä»£ç  <a href="https://help.apple.com/app-store-connect/#/dev50869de4a" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£æˆ³è¿™é‡Œ</a></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601144252.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¿ƒé”€ä»£ç æ˜¯å¯ä»¥å…‘æ¢å†…è´­é¡¹ç›®çš„ï¼Œå¹¶ä¸”è®¢è´­ä¸€ä¸ªè‡ªåŠ¨ç»­æœŸçš„è®¢é˜…å¹¶ä¸ä¼šè‡ªåŠ¨ç»­è´¹ã€‚</p><a id="more"></a><ul><li><h3 id="ç”³è¯·"><a href="#ç”³è¯·" class="headerlink" title="ç”³è¯·"></a>ç”³è¯·</h3>åœ¨App Store Connectåå°æ‰¾åˆ°äº†ä¿ƒé”€ä»£ç ï¼Œç‚¹å‡»ä½ æ‰€éœ€è¦å…‘æ¢çš„å†…è´­é¡¹ç›®ï¼Œæ–°å¢å³å¯<br>å…·ä½“çš„è¿˜æ˜¯çœ‹ <a href="https://help.apple.com/app-store-connect/#/dev1e322b132" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></li></ul><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601144324.png" alt=""></p><p>æ³¨æ„ä¸‹ç”³è¯·å‡ºæ¥çš„ä»£ç æœ‰æ—¶é—´é™åˆ¶ï¼Œ28å¤©ä¹‹å†…ä¸ç”¨å°±ä¼šè¿‡æœŸã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601144348.png" alt=""></p><p>ç”³è¯·ä»¥åä»å†å²è®°å½•ä¸­å°±å¯ä»¥çœ‹åˆ°ä»£ç ï¼ŒæŠŠè¿™ä¸ªç¥ç§˜ä»£ç å‘ç»™ç”¨æˆ·å³å¯ã€‚<br>å½“ç„¶ï¼Œä¸€èˆ¬ç”¨æˆ·éƒ½ä¼šä¸€è„¸æ‡µé€¼ï¼Œä¸çŸ¥é“å¦‚ä½•å…‘æ¢</p><ul><li><h3 id="å…‘æ¢"><a href="#å…‘æ¢" class="headerlink" title="å…‘æ¢"></a>å…‘æ¢</h3><p>é¦–å…ˆæ‰“å¼€æ‰‹æœºä¸Šçš„App Storeï¼Œé€‰ä¸­Appé‚£ä¸€æ ï¼Œæ‹–åˆ°åº•ï¼Œç‚¹å‡»å…‘æ¢<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601144419.png" alt=""></p><p>ç„¶åè¾“å…¥å¯†ç ä»€ä¹ˆçš„ä¸€ç›´ç»§ç»­</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601144446.png" alt=""></p><p>é€‰ä¸­æ‰‹åŠ¨è¾“å…¥ï¼Œè¾“å…¥ä¹‹å‰ç”³è¯·çš„ä¿ƒé”€ç </p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601144515.png" alt=""></p><p>ç”¨æˆ·å¦‚æœä¹‹å‰ä¸‹è½½è¿‡ï¼Œå°±å¯ä»¥ç›´æ¥æ‰“å¼€ï¼Œæœªä¸‹è½½è¿™é‡Œå°±æ˜¯ä¸‹è½½æŒ‰é’®ã€‚<br>æ‰“å¼€Appåå‘ç°ä¼šå‘˜å·²ç»ç”Ÿæ•ˆï¼Œçœ‹æ—¥å¿—ç¡®å®æ”¶åˆ°äº†è´­ä¹°æˆåŠŸçš„å›è°ƒã€‚å¹¶ä¸”ä¸ŠæŠ¥çš„è´­ä¹°ä»·æ ¼æ˜¯0</p><blockquote><p>è¿™ä¸ªæ–¹æ³•åŒæ ·å¯ä»¥æµ‹è¯•çº¿ä¸Šçš„è´­ä¹°æµç¨‹ï¼Œä¸Šçº¿åæƒ³å›æµ‹ä¸‹åˆèˆä¸å¾—èŠ±é’±æˆ–è€…æŠ¥é”€éº»çƒ¦ï¼Œéƒ½å¯ä»¥ç”¨è¿™ç§æ–¹æ³•æµ‹è¯•</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘é¡¹ç›®ä¸Šçº¿äº†Vipè®¢é˜…åŠŸèƒ½ï¼ŒåŒ…å«è¿ç»­åŒ…æœˆå’Œè¿ç»­åŒ…å¹´ã€‚ä¸Šçº¿åå¸‚åœºå’Œè¿è¥åŒäº‹é—®èƒ½ä¸èƒ½ç»™ä¸€äº›èµ„æ·±ç”¨æˆ·é€å‡ ä¸ªæœˆçš„ä¼šå‘˜ï¼Œæˆ–è€…ææ´»åŠ¨é€ä¼šå‘˜ã€‚å› ä¸ºæ˜¯æµ·å¤–é¡¹ç›®ï¼Œå†…è´­ä¸éœ€è¦ç”¨æˆ·ç³»ç»Ÿï¼ˆæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ç”¨æˆ·ç³»ç»Ÿï¼‰å®Œå…¨ä¾èµ–Appleè´­ä¹°å‡­è¯ã€‚æ‰€ä»¥ä¸èƒ½ä½¿ç”¨å›½å†…Appé‚£ç§æœåŠ¡ç«¯ç”Ÿæˆå…‘æ¢ç çš„åšæ³•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å› ä¸ºå®Œå…¨ä¾èµ–Appleï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ä»Appleè¿™è¾¹ä¸‹æ‰‹ã€‚è‡ªç„¶è€Œç„¶æƒ³åˆ°äº†Appleçš„ä¿ƒé”€ä»£ç ã€‚&lt;br&gt;å…ˆçœ‹çœ‹ä»€ä¹ˆæ˜¯ä¿ƒé”€ä»£ç  &lt;a href=&quot;https://help.apple.com/app-store-connect/#/dev50869de4a&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å®˜æ–¹æ–‡æ¡£æˆ³è¿™é‡Œ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601144252.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¿ƒé”€ä»£ç æ˜¯å¯ä»¥å…‘æ¢å†…è´­é¡¹ç›®çš„ï¼Œå¹¶ä¸”è®¢è´­ä¸€ä¸ªè‡ªåŠ¨ç»­æœŸçš„è®¢é˜…å¹¶ä¸ä¼šè‡ªåŠ¨ç»­è´¹ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Widgetå¼€å‘æŒ‡å—</title>
    <link href="http://yoursite.com/2018/11/12/Widget%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"/>
    <id>http://yoursite.com/2018/11/12/Widget%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/</id>
    <published>2018-11-12T12:05:00.000Z</published>
    <updated>2025-07-07T06:09:16.140Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç›®å‰è´Ÿè´£çš„Appæ–°å¢äº†WidgetåŠŸèƒ½ï¼Œä¹‹ååœ¨ç»„å†…åˆ†äº«ä¸­åˆ†äº«äº†ä¸‹Widgetçš„å¼€å‘ç»éªŒã€‚åŸºäºä¹‹å‰çš„PPTæç‚¼å‡ºäº†è¿™ç¯‡æ–‡ç« ã€‚æœ¬ç¯‡æ–‡ç« åªè®²åŸºäºWidgetå…³äºiOS10+ ä¹‹åçš„çŸ¥è¯†ç‚¹ã€‚</p></blockquote><p>Widgetæ˜¯iOS8ä»¥åAppleæ¨å‡ºçš„ä¸€é¡¹åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨iOS10åè¿›è¡Œäº†å¤§å¹…çš„ä¼˜åŒ–ã€‚</p><p>åœ¨ä¸»å±å¹•å’Œé”å®šå±å¹•ä¸Šå‘å³æ»‘åŠ¨æ¥è®¿é—®Widget,ä¹Ÿå¯ä»¥åœ¨å¯¹åº”çš„Appå›¾æ ‡ä¸Šé¢ä½¿ç”¨3D TouchæŒ‰å‹è®¿é—®ç›¸åº”çš„Widgetã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121241.png" alt=""></p><a id="more"></a><h1 id="Widgetè®¾è®¡è§„èŒƒå’Œè¦æ±‚"><a href="#Widgetè®¾è®¡è§„èŒƒå’Œè¦æ±‚" class="headerlink" title="Widgetè®¾è®¡è§„èŒƒå’Œè¦æ±‚"></a>Widgetè®¾è®¡è§„èŒƒå’Œè¦æ±‚</h1><p>Widgetæ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œå’Œä¸»Appç‹¬ç«‹ï¼Œä½†æ˜¯æ”¯æŒæ•°æ®å…±äº«ã€‚åœ¨è®¾è®¡å’Œå¼€å‘Widgetæ—¶å€™è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹è®¾è®¡è§„èŒƒï¼š</p><ul><li><p><strong>è®¾è®¡ä¸€ä¸ªå‹å¥½çš„äº¤äº’ä½“éªŒ</strong></p><p>Widgetç”¨æ¥æ‰§è¡Œéå¸¸ç®€å•çš„ä»»åŠ¡ï¼Œå°½å¯èƒ½æä¾›ç‚¹å‡»ä¸€æ¬¡å°±èƒ½å®Œæˆçš„ä»»åŠ¡ï¼ŒWidgetä¸æ”¯æŒçª—å£æ»šåŠ¨ï¼Œä¸æ”¯æŒé”®ç›˜è¾“å…¥ï¼ˆå…¶å®æ˜¯å¯ä»¥åšåˆ°é”®ç›˜è¾“å…¥çš„ å…·ä½“åŠæ³•è§åé¢ï¼‰<br>è¯¦è§<a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/Today.html" target="_blank" rel="noopener">ã€ŠApp Extension Programming Guideã€‹</a></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121350.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121409.png" alt=""></p><ul><li><p><strong>è¦å¿«é€Ÿæ˜¾ç¤ºå†…å®¹</strong></p><p>  å†…å®¹è¦å°½é‡ä»æœ¬åœ°åŠ è½½ï¼Œä¾èµ–ç½‘ç»œçš„å†…å®¹è¦åœ¨æœ¬åœ°åšç¼“å­˜ï¼Œä»¥å…é•¿æ—¶é—´ç­‰å¾…ã€‚ç¡®ä¿æ¯æ¬¡å‡ºç°éƒ½æœ‰å†…å®¹</p></li><li><p><strong>æä¾›å……è¶³çš„è¾¹è·å’Œå¡«å……</strong></p><p>  é¿å…å°†å†…å®¹æ‰©å±•åˆ°Widegtè¾¹ç¼˜ã€‚<strong>æ¯è¡Œæœ€å¤šæ˜¾ç¤º4ä¸ªæŒ‰é’®æˆ–å›¾æ ‡</strong></p></li><li><p><strong>é€‚åº”å±å¹•</strong></p><p>  iOS10ä»¥åï¼ŒWidgetæ”¯æŒæŠ˜å å’Œå±•å¼€ã€‚<strong>æŠ˜å çŠ¶æ€ä¸‹é»˜è®¤é«˜åº¦ä¸º110ä¸”ä¸å¯æ›´æ”¹ã€‚å±•å¼€é«˜åº¦ä¸è¶…è¿‡ä¸€ä¸ªå±å¹•çš„é«˜åº¦</strong>ã€‚ï¼ˆå®˜æ–¹æ–‡æ¡£è¯´æœ€ä½é«˜åº¦ä¸º2.5ä¸ªé»˜è®¤è¡Œé«˜ 44<em>3.5=110ï¼‰å®˜æ–¹æ¨èä½¿ç”¨AutoLayoutå¸ƒå±€ã€‚<br>  *</em>æ¨ªå±æ—¶å€™å®½åº¦è¿˜æ˜¯é»˜è®¤å±å¹•å®½åº¦ã€‚ä¸ä¼šæ‹‰ä¼¸**<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121436.png" alt=""></p></li><li><p><strong>ä¸è¦è‡ªå®šä¹‰èƒŒæ™¯è‰²</strong></p><p>  ç³»ç»Ÿè‡ªå¸¦æ¨¡ç³Šçš„èƒŒæ™¯è‰²ï¼Œå°½é‡ä¸è¦æ”¹(å½“ç„¶åªæ˜¯å»ºè®®å’¯ï¼‰ã€‚ä¸è¦ç”¨ç…§ç‰‡åšèƒŒæ™¯ï¼Œä¼šå’Œå£çº¸å†²çªã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121508.png" alt=""></p></li><li><p><strong>æ³¨æ„å­—ä½“é¢œè‰²ã€å–ä¸€ä¸ªå¥½åå­—ã€ä¸€ä¸ªAppå¯ä»¥æœ‰å¤šä¸ªWidget</strong></p><p>  å­—ä½“é¢œè‰²å°½é‡æ˜¯æ·±è‰²æˆ–è€…æ·±ç°è‰²ï¼ˆç„¶è€Œç”¨ç™½è‰²çš„æœ€å¤šï¼‰ã€‚å¦‚æœä¸€ä¸ªAppå­˜åœ¨å¤šä¸ªWidgetï¼Œè¦å‘½åæ¸…æ™°ã€‚Widgetçš„åå­—é‡Œé¢ï¼Œ<strong>è‹±æ–‡å­—æ¯ç³»ç»Ÿä¼šè‡ªåŠ¨è½¬æ¢æˆå¤§å†™</strong>ã€‚</p><p>  <strong>Logoä¼šè‡ªåŠ¨ä½¿ç”¨ä¸»Appçš„icon</strong></p></li><li><p><strong>é€‚å½“çš„æ—¶å€™è®©ç”¨æˆ·è·³è½¬åˆ°ä¸»Appæ¥åšæ›´å¤šçš„äº‹</strong></p><p>  Widgetå°½é‡åªç»™ç”¨æˆ·æä¾›ç®€å•çš„åŠŸèƒ½ï¼ˆè§„èŒƒè€Œå·²ã€‚ã€‚ï¼‰ï¼Œä¸è¦åœ¨Widgetä¸­å‡ºç°â€œæ‰“å¼€Appâ€ç­‰æŒ‰é’®ã€‚ç‚¹å‡»Widget iconåä¼šè‡ªåŠ¨åŠèµ·ä¸»Appã€‚å’Œä¸»Appäº¤äº’ä½¿ç”¨URLSchemeæ–¹æ³•ã€‚åé¢ä¼šè®²åˆ°ã€‚</p></li><li><p><strong>å¾ˆçŸ­çš„ç”Ÿå‘½å‘¨æœŸã€è¦æ³¨æ„å†…å­˜é—®é¢˜</strong></p><p>ç¦»å¼€å±å¹•2s+å°±ä¼šè¢«é”€æ¯ï¼Œåé¢ä¼šè®²åˆ°</p></li></ul><h1 id="å»ºç«‹Widget-Target"><a href="#å»ºç«‹Widget-Target" class="headerlink" title="å»ºç«‹Widget Target"></a>å»ºç«‹Widget Target</h1><p>é€‰æ‹©ä¸»å·¥ç¨‹ï¼Œåœ¨Projectè®¾ç½®ç•Œé¢ä¸‹æ–¹ç‚¹å‡»åŠ å·ï¼Œæ–°å»ºToday Extension</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121536.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121558.png" alt=""><br>ç³»ç»Ÿä¼šè‡ªåŠ¨ç”ŸæˆTodayViewControllerå’ŒstoryBoardã€‚ä¸è¦å¿˜è®°åœ¨Targetè®¾ç½®é‡Œé¢è®¾ç½®åŸºæœ¬ä¿¡æ¯ï¼Œç‰ˆæœ¬å·å’Œä¸»Appä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¸Šä¼ iTunes Connectä¼šæœ‰è­¦å‘Šé‚®ä»¶</p><p><strong>ä¹Ÿè¦æ³¨æ„é€‰æ‹©Deployment Targetã€‚Xcode10é»˜è®¤æ˜¯iOS12</strong><br><img src="https://upload-images.jianshu.io/upload_images/525360-3793f8a5b159e998.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><h1 id="å’ŒWidgetå…±äº«ä»£ç "><a href="#å’ŒWidgetå…±äº«ä»£ç " class="headerlink" title="å’ŒWidgetå…±äº«ä»£ç "></a>å’ŒWidgetå…±äº«ä»£ç </h1><ul><li><p>æ”¯æŒpodå¯¼å…¥ä¸‰æ–¹åº“ï¼Œåœ¨podfileä¸­æ–°å¢Widgetçš„target<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121627.png" alt="">Xcode10 åï¼Œå¦‚æœåœ¨Build Phasesä¸­è¿è¡ŒScriptã€‚æ‰§è¡Œpodå¯èƒ½æŠ¥é”™ã€‚è§£å†³åŠæ³•è§<br><a href="https://www.jianshu.com/p/ebdcfc86886b" target="_blank" rel="noopener">ã€Š#iOSçŸ¥è¯†å°é›†# Xcode10 pod install æŠ¥é”™ã€‹</a></p></li><li><p>ä¸»å·¥ç¨‹ä»£ç å…±äº«<br>åœ¨éœ€è¦å…±äº«çš„ç±»çš„.mæ–‡ä»¶ä¸­çš„Target Membershipä¸­å‹¾é€‰Widgetæ‰€åœ¨çš„Target<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121710.png" alt=""></p></li></ul><h1 id="Widgetä»£ç å®ç°"><a href="#Widgetä»£ç å®ç°" class="headerlink" title="Widgetä»£ç å®ç°"></a>Widgetä»£ç å®ç°</h1><p><strong>NCWidgetProvidingåè®®</strong><br>Widgetå·¥ç¨‹å»ºç«‹åä¼šè‡ªåŠ¨ç”ŸæˆTodayViewControllerã€‚<br>ä¼šéµå¾ªNCWidgetProvidingåè®®<br>iOS10ä»¥åè¿™ä¸ªåè®®åªæœ‰ä¸¤ä¸ªæ–¹æ³•</p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">widgetPerformUpdateWithCompletionHandler</span><span class="selector-pseudo">:(void</span> (^)(NCUpdateResult result))<span class="selector-tag">completionHandler</span>;</span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">widgetActiveDisplayModeDidChange</span><span class="selector-pseudo">:(NCWidgetDisplayMode)activeDisplayMode</span> <span class="selector-tag">withMaximumSize</span><span class="selector-pseudo">:(CGSize)maxSize</span> <span class="selector-tag">NS_AVAILABLE_IOS</span>(<span class="number">10</span>_0);</span><br></pre></td></tr></table></figure><p>å…¶ä¸­widgetPerformUpdateWithCompletionHandler é»˜è®¤è¿”å›NCUpdateResultNewData</p><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">- (<span class="type">void</span>)widgetPerformUpdateWithCompletionHandler:(<span class="type">void</span> (^)(NCUpdateResult))completionHandler &#123;</span><br><span class="line">    // <span class="keyword">Perform</span> <span class="keyword">any</span> setup necessary <span class="keyword">in</span> <span class="keyword">order</span> <span class="keyword">to</span> <span class="keyword">update</span> the <span class="keyword">view</span>.</span><br><span class="line">    </span><br><span class="line">    // <span class="keyword">If</span> an error <span class="keyword">is</span> encountered, use NCUpdateResultFailed</span><br><span class="line">    // <span class="keyword">If</span> ther<span class="string">e's no update required, use NCUpdateResultNoData</span></span><br><span class="line"><span class="string">    // If there'</span>s an <span class="keyword">update</span>, use NCUpdateResultNewData</span><br><span class="line"></span><br><span class="line">    completionHandler(NCUpdateResultNewData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¯ä»¥å¿½ç•¥æ‰ï¼Œç›´æ¥è¿”å›NCUpdateResultNewDataå°±å¥½äº†<br>iOS10ä»¥åæ”¯æŒæŠ˜å å’Œå±•å¼€åŠŸèƒ½ï¼ŒæŠ˜å çŠ¶æ€ä¸‹é»˜è®¤é«˜åº¦ä¸º110ä¸”ä¸å¯æ›´æ”¹ã€‚å±•å¼€é«˜åº¦ä¸è¶…è¿‡ä¸€ä¸ªå±å¹•çš„é«˜åº¦ã€‚ï¼ˆå®˜æ–¹æ–‡æ¡£è¯´æœ€ä½é«˜åº¦ä¸º2.5ä¸ªé»˜è®¤è¡Œé«˜ 44*3.5=110ï¼‰</p><p>åœ¨ViewDidLoadedæ–¹æ³•ä¸­è®¾ç½®æ˜¯å¦å¼€å¯æŠ˜å åŠŸèƒ½</p><figure class="highlight gml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//NCWidgetDisplayModeCompact æ”¶èµ·æ¨¡å¼</span></span><br><span class="line"><span class="comment">//NCWidgetDisplayModeExpanded  å±•å¼€æ¨¡å¼</span></span><br><span class="line">     </span><br><span class="line"><span class="literal">self</span>.extensionContext.widgetLargestAvailableDisplayMode = NCWidgetDisplayModeExpanded;</span><br></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)widgetActiveDisplayModeDidChange:(NCWidgetDisplayMode)activeDisplayMode withMaximumSize:(<span class="built_in">CGSize</span>)maxSize &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (activeDisplayMode == NCWidgetDisplayModeCompact) &#123;</span><br><span class="line">        <span class="keyword">self</span>.preferredContentSize = <span class="built_in">CGSizeMake</span>(maxSize.width, <span class="number">110</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.preferredContentSize = <span class="built_in">CGSizeMake</span>(maxSize.width, <span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨çº¯ä»£ç </strong></p><p>ç¤ºä¾‹å·¥ç¨‹ä¼šé»˜è®¤ä½¿ç”¨StoryBoardï¼Œå¦‚æœæƒ³ä½¿ç”¨çº¯ä»£ç ã€‚è¿›è¡Œä»¥ä¸‹æ­¥éª¤</p><ol><li>åˆ é™¤MainInterface.storyboardæ–‡ä»¶å’ŒNSExtensionMainStoryboardé”®å€¼å¯¹<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121837.png" alt=""></li><li>æ·»åŠ NSExtensionPrincipalClassä¸ºkey ,valueä¸ºTodayViewController<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121932.png" alt=""></li></ol><p><strong>å›¾ç‰‡ç®¡ç†</strong><br>Widgetå¯ä»¥ä½¿ç”¨Asset Catalogç®¡ç†å›¾ç‰‡ï¼Œå‘½åä¸ºAssetsï¼Œå’Œä¸»å·¥ç¨‹ä½¿ç”¨æ–¹å¼ä¸€è‡´</p><p><strong>ä»£ç è°ƒè¯•</strong><br>åœ¨Widgetå·¥ç¨‹æ›´æ–°ä»£ç åï¼Œå¯ä»¥è¿è¡Œä¸»å·¥ç¨‹ï¼Œç„¶åæ·»åŠ Widgetã€‚å°±å¯ä»¥çœ‹åˆ°æœ€æ–°çš„æ•ˆæœå±•ç¤ºã€‚<br>å¦‚æœæƒ³æ–­ç‚¹è°ƒè¯•ï¼Œè¦é€‰æ‹©Widget Target<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601141147.png" alt=""><br><strong>å’Œä¸»å·¥ç¨‹å…±äº«æ•°æ®</strong></p><blockquote><p>Widgetå’Œä¸»å·¥ç¨‹æ˜¯å®Œå…¨ç‹¬ç«‹çš„ä¸¤ä¸ªå·¥ç¨‹,ä¸¤ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚æ‰€ä»¥æ•°æ®å…±äº«æ˜¯é€šè¿‡App Groupsè¿›è¡Œçš„ã€‚</p></blockquote><p>App Groupséœ€è¦å»å¼€å‘è€…ä¸­å¿ƒå»åˆ›å»ºã€‚IDå¿…é¡»ä»¥groupå¼€å¤´ã€‚åé¢ä¸€èˆ¬è·Ÿå…¬å¸åç§°ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601141205.png" alt=""><br>å»ºç«‹å®Œæˆåå›åˆ°ä¸»å·¥ç¨‹ï¼Œæ‰“å¼€App Groupså¼€å…³ï¼Œå°±èƒ½åˆ·æ–°å‡ºåˆšåˆšåˆ›å»ºçš„Groups,æ‰“é’©è¿œä¸­</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601141214.png" alt=""><br>ç„¶åæŠŠWidget Target ä¹Ÿæ‰“å¼€App Groupsï¼Œé€‰ä¸­åŒä¸€ä¸ªGroups</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601141231.png" alt=""><br>App Groupså¯ä»¥é€šè¿‡NSUserDefaultså’ŒNSFileManagerå…±äº«æ•°æ®</p><ul><li>NSUserDefaults</li></ul><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸»å·¥ç¨‹ä¸­å­˜</span></span><br><span class="line">NSUserDefaults *shared = [[NSUserDefaults alloc] <span class="string">initWithSuiteName:</span>@<span class="string">"group.YouDao.xxxx"</span>];</span><br><span class="line">[shared <span class="string">setObject:</span>_targetLanguage.abb <span class="string">forKey:</span>@<span class="string">"UD_TargetLanguage_Widget_key"</span>];</span><br><span class="line">[shared synchronize];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Widget ä¸­å–</span></span><br><span class="line">[[NSUserDefaults alloc] <span class="string">initWithSuiteName:</span>@<span class="string">"group.YouDao.xxxx"</span>] <span class="string">objectForKey:</span>@<span class="string">"UD_TargetLanguage_Widget_key"</span>];</span><br></pre></td></tr></table></figure><ul><li>NSFileManager</li></ul><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å­˜</span></span><br><span class="line"><span class="built_in">NSString</span> *groupID = <span class="string">@"group.YouDao.xxxx"</span>;</span><br><span class="line"><span class="built_in">NSError</span> *err = <span class="literal">nil</span>;</span><br><span class="line"><span class="built_in">NSURL</span> *fileUrl = [[<span class="built_in">NSFileManager</span> defaultManager] containerURLForSecurityApplicationGroupIdentifier:groupID];</span><br><span class="line">fileUrl = [fileUrl URLByAppendingPathComponent:<span class="string">@"Library/Caches/test"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *value = <span class="string">@"test"</span>;</span><br><span class="line"><span class="built_in">BOOL</span> result = [value writeToURL:fileUrl atomically:<span class="literal">YES</span> encoding:<span class="built_in">NSUTF8StringEncoding</span> error:&amp;err];</span><br><span class="line"><span class="keyword">if</span>(result)&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å†™å…¥æˆåŠŸ"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å–</span></span><br><span class="line"><span class="built_in">NSString</span> *groupID = <span class="string">@"group.YouDao.xxxx"</span>;</span><br><span class="line"><span class="built_in">NSError</span> *err = <span class="literal">nil</span>;</span><br><span class="line"><span class="built_in">NSURL</span> *containerURL = [[<span class="built_in">NSFileManager</span> defaultManager] containerURLForSecurityApplicationGroupIdentifier:groupID];</span><br><span class="line">containerURL = [containerURL URLByAppendingPathComponent:<span class="string">@"Library/Caches/test"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *value = [<span class="built_in">NSString</span> stringWithContentsOfURL:containerURL encoding:<span class="built_in">NSUTF8StringEncoding</span> error:&amp;err];</span><br></pre></td></tr></table></figure><blockquote><p>App Gropuæ˜¯è·¨Appçš„ï¼Œåªè¦åœ¨åŒä¸€ä¸ªå¼€å‘ä¸­è´¦å·ã€‚ä¸åŒçš„Appä½¿ç”¨åŒä¸€ä¸ªGropu IDéƒ½æ˜¯å¯ä»¥å…±äº«æ•°æ®çš„ã€‚åœ¨Sharedç›®å½•ä¸‹è¿˜æœ‰AppGroupç›®å½•ã€‚é‡Œé¢æœ‰å„ä¸ªGroup IDçš„æ–‡ä»¶å¤¹ã€‚å…¶ä¸­é€šè¿‡NSUserDefaultå…±äº«çš„æ•°æ®åœ¨Library/Prefrencesä¸‹ã€‚æ˜¯ä¸€ä¸ªplistæ–‡ä»¶ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601141243.png" alt=""></p><h1 id="WidgetåŠèµ·ä¸»å·¥ç¨‹"><a href="#WidgetåŠèµ·ä¸»å·¥ç¨‹" class="headerlink" title="WidgetåŠèµ·ä¸»å·¥ç¨‹"></a>WidgetåŠèµ·ä¸»å·¥ç¨‹</h1><p>WidgetåŠèµ·ä¸»Appé€šè¿‡URLSchemes</p><ol><li>ä¸ºä¸»Appè®¾ç½®URLSchemes<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601141310.png" alt=""><br>ï¿¼ï¿¼2.Widgetæ·»åŠ äº¤äº’<figure class="highlight scheme"><table><tr><td class="code"><pre><span class="line">[<span class="name">self.extensionContext</span> openURL:[<span class="name">NSURL</span> URLWithString:@<span class="string">"YDUDictionary://action=CameraTranslate"</span>] completionHandler:^(<span class="name">BOOL</span> success) &#123;</span><br><span class="line">                NSLog(<span class="name">@</span><span class="string">"open url result:%d"</span>,success)<span class="comment">;</span></span><br><span class="line">            &#125;]<span class="comment">;</span></span><br></pre></td></tr></table></figure></li><li>ä¸»Appä¸­å¤„ç†Scheme.åœ¨AppDelegateä¸­å®ç°application:openURL:options:<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)app openURL:(<span class="built_in">NSURL</span> *)url options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">UIApplicationOpenURLOptionsKey</span>,<span class="keyword">id</span>&gt; *)options &#123;</span><br><span class="line">      <span class="built_in">NSString</span> *urlStr = [url.absoluteString stringByRemovingPercentEncoding];</span><br><span class="line">        <span class="keyword">if</span> ([urlStr hasPrefix:<span class="string">@"YDUDictionary://action="</span>]) &#123;</span><br><span class="line">            <span class="built_in">NSString</span> *parameter = [urlStr stringByReplacingOccurrencesOfString:<span class="string">@"YDUDictionary://action="</span> withString:<span class="string">@""</span>];</span><br><span class="line">                <span class="keyword">if</span> ([parameter isEqualToString:<span class="string">@"CameraTranslate"</span>]) &#123;</span><br><span class="line">                <span class="comment">//Do Somthinhg</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="ä¸»Appä¸­æ§åˆ¶Widgetæ˜¯å¦æ˜¾ç¤º"><a href="#ä¸»Appä¸­æ§åˆ¶Widgetæ˜¯å¦æ˜¾ç¤º" class="headerlink" title="ä¸»Appä¸­æ§åˆ¶Widgetæ˜¯å¦æ˜¾ç¤º"></a>ä¸»Appä¸­æ§åˆ¶Widgetæ˜¯å¦æ˜¾ç¤º</h1><p>åœ¨Widgetç¼–è¾‘é¡µé¢å¯ä»¥è¿›è¡ŒWidgetæ’åºå¾ˆåˆ å‡ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601141322.png" alt="">å½“æ·»åŠ Widgetä»¥åï¼Œä¸»å·¥ç¨‹è¿˜å¯ä»¥æ§åˆ¶Widgetæ˜¯å¦æ˜¾ç¤ºã€‚</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸ºä»€ä¹ˆè¦å¼•å…¥NotificationCenterå‘¢ï¼Ÿå¯ä»¥æ€è€ƒä¸‹</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;NotificationCenter/NotificationCenter.h&gt;</span></span></span><br><span class="line"><span class="comment">//youdao.com.WidgetTest.Widgetæ˜¯Widgetçš„Bundle ID</span></span><br><span class="line">[[NCWidgetController widgetController] setHasContent:<span class="literal">YES</span> forWidgetWithBundleIdentifier:<span class="string">@"youdao.com.WidgetTest.Widget"</span>];</span><br></pre></td></tr></table></figure><h1 id="åˆ·æ–°æœºåˆ¶"><a href="#åˆ·æ–°æœºåˆ¶" class="headerlink" title="åˆ·æ–°æœºåˆ¶"></a>åˆ·æ–°æœºåˆ¶</h1><p>Widgetæœ‰è‡ªå·±è¿›ç¨‹ï¼Œæœ‰ç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸå’Œå†…å­˜é™åˆ¶ã€‚é€šè¿‡æµ‹è¯•å¾—å‡º</p><blockquote><p>Widgetç¦»å¼€å±å¹•2sä»¥ä¸Šï¼Œå°±ä¼šè¢«é”€æ¯å›æ”¶æ‰ã€‚æ¯æ¬¡ç¦»å¼€å‰ç³»ç»Ÿä¼šåšå¿«ç…§å¤„ç†ã€‚ä¸‹æ¬¡è¿›æ¥å…ˆåŠ è½½å¿«ç…§ã€‚<br>ç¦»å¼€è¶…è¿‡2sä»¥ä¸Šï¼Œä¸‹æ¬¡è¿›å…¥å°±ä¼šè°ƒç”¨ViewDidLoad,ç„¶åæ˜¯viewWillAppear<br>ç¦»å¼€ä¸è¶…è¿‡2s ä¸‹æ¬¡è¿›å…¥ä¼šè°ƒç”¨viewWillAppear</p></blockquote><p>æ‰€ä»¥ä¸ºäº†äº¤äº’ä½“éªŒï¼Œæœ€å¥½æ˜¯è®°å½•ç”¨æˆ·ä¸Šæ¬¡çš„ä½¿ç”¨çŠ¶æ€ï¼Œä¸‹æ¬¡åŠ è½½æ—¶å€™è¿›è¡Œè¿˜åŸæ“ä½œã€‚</p><p>å½“å†…å­˜ä¸è¶³æ—¶å€™ï¼Œç³»ç»Ÿä¼šä¼˜å…ˆkillæ‰Widgetã€‚æ‰€ä»¥è¦æ³¨æ„å†…å­˜é—®é¢˜ï¼Œä¸è¦è¿›è¡Œéœ€è¦å¤§é‡å†…å­˜çš„æ“ä½œã€‚<br>ç½‘ç»œè¯·æ±‚å¦‚æœéœ€è¦é¢‘ç¹åˆ·æ–°ã€‚å¯ä»¥åœ¨viewWillAppearæ–¹æ³•ä¸­å¯ç”¨ä¸€ä¸ªTimer,åœ¨Timerä¸­è¯·æ±‚æ¥å£æ•°æ®ã€‚åœ¨viewWillDisAppearä¸­å–æ¶ˆå®šæ—¶å™¨ã€‚</p><h1 id="å¦‚ä½•åœ¨Widgetä¸­ä½¿ç”¨é”®ç›˜"><a href="#å¦‚ä½•åœ¨Widgetä¸­ä½¿ç”¨é”®ç›˜" class="headerlink" title="å¦‚ä½•åœ¨Widgetä¸­ä½¿ç”¨é”®ç›˜"></a>å¦‚ä½•åœ¨Widgetä¸­ä½¿ç”¨é”®ç›˜</h1><blockquote><p>Appleå®˜æ–¹æ–‡æ¡£è¯´Widgetæ˜¯ä¸æ”¯æŒé”®ç›˜è¾“å…¥çš„ã€‚å¦‚æœåœ¨TodayViewControllerä¸­æ–°å»ºä¸€ä¸ªè¾“å…¥æ¡†ã€‚ç‚¹å‡»æ˜¯æ²¡æœ‰ååº”çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨å¦å¤–ä¸€ç§åŠæ³•ç»•è¿‡å»ã€‚æ•ˆæœå¦‚ä¸‹å›¾ã€‚</p></blockquote><p><strong>åšæ³•å°±æ˜¯åšä¸€ä¸ªå‡çš„è¾“å…¥æ¡†ï¼Œè®©ç”¨æˆ·ç‚¹å‡»ã€‚ç‚¹å‡»åpresentä¸€ä¸ªViewControllerï¼Œåœ¨è¿™ä¸ªControlleræ–°å»ºUITextViewæˆ–è€…UITextFieldå°±å¯ä»¥è·å–ç„¦ç‚¹ï¼Œå‡ºç°é”®ç›˜å•¦</strong></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601141336.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç›®å‰è´Ÿè´£çš„Appæ–°å¢äº†WidgetåŠŸèƒ½ï¼Œä¹‹ååœ¨ç»„å†…åˆ†äº«ä¸­åˆ†äº«äº†ä¸‹Widgetçš„å¼€å‘ç»éªŒã€‚åŸºäºä¹‹å‰çš„PPTæç‚¼å‡ºäº†è¿™ç¯‡æ–‡ç« ã€‚æœ¬ç¯‡æ–‡ç« åªè®²åŸºäºWidgetå…³äºiOS10+ ä¹‹åçš„çŸ¥è¯†ç‚¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Widgetæ˜¯iOS8ä»¥åAppleæ¨å‡ºçš„ä¸€é¡¹åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨iOS10åè¿›è¡Œäº†å¤§å¹…çš„ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸»å±å¹•å’Œé”å®šå±å¹•ä¸Šå‘å³æ»‘åŠ¨æ¥è®¿é—®Widget,ä¹Ÿå¯ä»¥åœ¨å¯¹åº”çš„Appå›¾æ ‡ä¸Šé¢ä½¿ç”¨3D TouchæŒ‰å‹è®¿é—®ç›¸åº”çš„Widgetã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601121241.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Widget" scheme="http://yoursite.com/tags/Widget/"/>
    
  </entry>
  
  <entry>
    <title>NSAssertè¯¦è§£åŠCè¯­è¨€assertçš„ä¸€äº›å‘</title>
    <link href="http://yoursite.com/2018/10/13/C%E8%AF%AD%E8%A8%80assert%E5%9C%A8Xcode%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/"/>
    <id>http://yoursite.com/2018/10/13/C%E8%AF%AD%E8%A8%80assert%E5%9C%A8Xcode%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/</id>
    <published>2018-10-13T02:53:00.000Z</published>
    <updated>2025-07-07T06:09:16.138Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201013152501.png" alt=""><br>assertå¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œåœ¨å¼€å‘é˜¶æ®µç”¨æ–­è¨€å‡½æ•°å¯ä»¥å¾ˆå¥½çš„è¿›è¡Œè°ƒè¯•ã€‚</p><p>ä¸€èˆ¬OCä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<code>NSAssert</code>ã€‚åœ¨Xcode4.2ä»¥åï¼ŒXcodeä¼šåœ¨releaseç¯å¢ƒä¸‹è‡ªåŠ¨æŠŠ<code>NSAssert</code>å¿½ç•¥æ‰ï¼Œç¡®ä¿releaseç¯å¢ƒä¸ä¼šå‡ºé”™ã€‚</p><h2 id="assertçš„å‘"><a href="#assertçš„å‘" class="headerlink" title="assertçš„å‘"></a>assertçš„å‘</h2><p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œçº¿ä¸ŠCrashå®šä½åœ¨äº†ä¸€ä¸ªpodåº“ä¸­çš„<code>assert</code>æ–¹æ³•ï¼Œåœ¨OCé‡Œé¢è°ƒç”¨assertæ˜¯ç”¨çš„Cè¯­è¨€çš„assertã€‚ç»“æœåœ¨<code>release</code>ç¯å¢ƒä¸‹ä¹Ÿç”Ÿæ•ˆäº†ï¼Œç›´æ¥é€ æˆäº†Crashã€‚</p><p>æŸ¥æ‰¾äº†ä¸€äº›èµ„æ–™ï¼Œæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆã€‚</p><p>é€šè¿‡æŸ¥è¯¢æºç å‘ç°ï¼Œåœ¨Cè¯­è¨€ä¸­æ˜¯å¦‚ä½•å¿½ç•¥çš„<code>assert</code>çš„</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> assert</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> __assert</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> NDEBUG</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>assert(e)((void)0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __GNUC__</span></span><br></pre></td></tr></table></figure><p>æºç åœ°å€è¯¦è§ï¼š<a href="https://opensource.apple.com/source/Libc/Libc-583/include/assert.h.auto.html" target="_blank" rel="noopener">https://opensource.apple.com/source/Libc/Libc-583/include/assert.h.auto.html</a></p><p><code>NDEBUG</code>æ˜¯Cè¯­è¨€ä¸­çš„ä¸€ä¸ªæ ‡å‡†å®ï¼Œå…¶è¯­ä¹‰é€‚ç”¨äºC89ï¼ŒC99ï¼ŒC ++ 98ï¼ŒC ++ 2003ï¼ŒC ++ 2011ï¼ŒC ++ 2014æ ‡å‡†ã€‚<br>è¯¦è§ï¼š<a href="https://stackoverflow.com/questions/2290509/debug-vs-ndebug" target="_blank" rel="noopener">https://stackoverflow.com/questions/2290509/debug-vs-ndebug</a></p><p>æ ¹æ®æºç å¯çŸ¥ï¼Œå¦‚æœå®šä¹‰äº†<code>NDEBUG</code>ï¼Œé‚£ä¹ˆ<code>assert</code>å°±è¿”å›<code>void</code>ï¼Œå°±ä¸ä¼šå†ç”Ÿæ•ˆã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨ä¸»å·¥ç¨‹ä¸­ï¼Œé€‰æ‹©<code>Bulid Settings</code>é€‰æ‹©<code>Preprocessor Marcos</code>åœ¨<code>Release</code>ä¸­æ·»åŠ <code>NDEBUG=1</code>å³å¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201019102527.png" alt=""></p><blockquote><p><strong>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªä¿®æ”¹ä¸»å·¥ç¨‹å¹¶ä¸ä¼šå¯¹podåº“ç”Ÿæ•ˆï¼Œæ‰€ä»¥è¿˜éœ€è¦å¯¹podåº“è¿›è¡Œå¤„ç†ï¼</strong></p></blockquote><p>åœ¨podåº“ä¸­ä¸€ä¸ªä¸€ä¸ªä¿®æ”¹å¤ªéº»çƒ¦ï¼Œå¹¶ä¸”æ¯æ¬¡<code>pod install</code>åå°±ä¼šå¤±æ•ˆï¼Œæˆ‘ä»¬éœ€è¦ä»<code>podfile</code>æ–‡ä»¶å…¥æ‰‹ã€‚</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">post_install <span class="keyword">do</span> <span class="params">|installer|</span></span><br><span class="line">   installer.pods_project.targets.each <span class="keyword">do</span> <span class="params">|target|</span></span><br><span class="line">     target.build_configurations.each <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">       config.build_settings[<span class="string">'IPHONEOS_DEPLOYMENT_TARGET'</span>] = <span class="string">'10.0'</span></span><br><span class="line">       <span class="keyword">if</span> config.name == <span class="string">'Release'</span></span><br><span class="line">         config.build_settings[<span class="string">'GCC_PREPROCESSOR_DEFINITIONS'</span>] <span class="params">||</span>= [<span class="string">'$(inherited)'</span>, <span class="string">'NDEBUG=1'</span>]</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>åˆ¤æ–­æ˜¯å¦æ˜¯<code>Release</code>ç¯å¢ƒï¼Œå¦‚æœæ˜¯å°±åœ¨<code>build_settings</code>ä¸­çš„<code>GCC_PREPROCESSOR_DEFINITIONS</code>æ·»åŠ <code>$(inherited)</code>å’Œ <code>NDEBUG=1</code>ã€‚</p><p><code>$(inherited)</code>æ˜¯ç»§æ‰¿<code>Pods</code>å·¥ç¨‹çš„è®¾ç½®</p><p>æ·»åŠ å®Œåæ‰§è¡Œ<code>pod install</code>ï¼Œå°±å¯ä»¥å‘ç°æ¯ä¸ªpodåº“çš„<code>Preprocessor Marcos</code>ä¸­ï¼Œåœ¨<code>Release</code>ä¸‹éƒ½æ·»åŠ äº†<code>NDEBUG=1</code><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201019103641.png" alt=""></p><h2 id="NSAssertä»‹ç»"><a href="#NSAssertä»‹ç»" class="headerlink" title="NSAssertä»‹ç»"></a>NSAssertä»‹ç»</h2><p>è¯´å®Œassert,å†æ¥è¯´è¯´æˆ‘ä»¬å¸¸ç”¨çš„<code>NSAssert</code></p><p><code>NSAssert</code>ç»†åˆ†ä¸º</p><ul><li><code>NSAssert/NSCAsseet</code></li><li><code>NSParameterAssert / NSCParameterAssert</code></li></ul><p>ä»–ä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ol><li><p>NSAssert å’Œ NSParameterAssert åªé€‚ç”¨äºOCç¯å¢ƒä¸­ã€‚NSCAsseet å’Œ NSCParameterAssert é€‚ç”¨äºCè¯­è¨€ç¯å¢ƒä¸­</p></li><li><p>å½“ NSAssert æˆ– NSParameterAssert çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œæ–­è¨€å¤„ç†å™¨ä¼šè°ƒç”¨<br><code>-handleFailureInMethod:object:file:lineNumber:description:</code>æ–¹æ³•ã€‚<br>å½“ NSCAssert æˆ– NSCParameterAssert çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œæ–­è¨€å¤„ç†å™¨ä¼šè°ƒç”¨ <code>-handleFailureInFunction:file:lineNumber:description:</code> æ–¹æ³•ã€‚</p></li></ol><p>NSAssertå’ŒNSAssertéƒ½æœ‰ä¸€äº›å˜ä½“ï¼Œä¾‹å¦‚<code>NSAssert1</code>ã€<code>NSAssert2</code>ã€<code>NSCAssert1</code>ã€<code>NSCAssert2</code>ç­‰ç­‰ã€‚ä»–ä»¬çš„åŒºåˆ«æ˜¯ä¼šè¾“å‡ºä¸åŒçš„å‚æ•°ã€‚<br>å…·ä½“ä¿¡æ¯è¯¦è§å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developer.apple.com/documentation/foundation/nsassert1" target="_blank" rel="noopener">https://developer.apple.com/documentation/foundation/nsassert1</a></p><p>ä»Xcode4.2ä»¥åï¼Œä¼šè‡ªåŠ¨åœ¨releaseç¯å¢ƒä¸‹å¿½ç•¥<code>NSAssert</code>ç­‰æ–­è¨€å‡½æ•°ã€‚å®ƒæ˜¯é€šè¿‡å®šä¹‰ <code>NS_BLOCK_ASSERTIONS</code> å®å®ç°çš„ï¼Œç¡®ä¿ä¸ä¼šå¯¹releaseç¯å¢ƒæœ‰å½±å“ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ä¸­çœ‹åˆ°ä»–ä»¬å®šä¹‰çš„assert,å…³é—­æ¡ä»¶ä¹Ÿæ˜¯åŸºäº<code>NS_BLOCK_ASSERTIONS</code></p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#ifndef</span> <span class="selector-tag">_GTMDevAssert</span></span><br><span class="line"><span class="comment">// we directly invoke the NSAssert handler so we can pass on the varargs</span></span><br><span class="line"><span class="comment">// (NSAssert doesn't have a macro we can use that takes varargs)</span></span><br><span class="line"><span class="selector-id">#if</span> !<span class="selector-tag">defined</span>(NS_BLOCK_ASSERTIONS)</span><br><span class="line">  <span class="selector-id">#define</span> <span class="selector-tag">_GTMDevAssert</span>(condition, ...)                                       \</span><br><span class="line">    <span class="selector-tag">do</span> &#123;                                                                      \</span><br><span class="line">      <span class="selector-tag">if</span> (!(condition)) &#123;                                                     \</span><br><span class="line">        <span class="selector-attr">[[NSAssertionHandler currentHandler]</span>                                  \</span><br><span class="line">            <span class="selector-tag">handleFailureInFunction</span><span class="selector-pseudo">:(NSString</span> *)                              \</span><br><span class="line">                                        <span class="selector-attr">[NSString stringWithUTF8String:__PRETTY_FUNCTION__]</span> \</span><br><span class="line">                               <span class="selector-tag">file</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-attr">[NSString stringWithUTF8String:__FILE__]</span>  \</span><br><span class="line">                         <span class="selector-tag">lineNumber</span><span class="selector-pseudo">:__LINE__</span>                                  \</span><br><span class="line">                        <span class="selector-tag">description</span><span class="selector-pseudo">:__VA_ARGS__</span>];                             \</span><br><span class="line">      &#125;                                                                       \</span><br><span class="line">    &#125; <span class="selector-tag">while</span>(<span class="number">0</span>)</span><br><span class="line"><span class="selector-id">#else</span> <span class="comment">// !defined(NS_BLOCK_ASSERTIONS)</span></span><br><span class="line">  <span class="selector-id">#define</span> <span class="selector-tag">_GTMDevAssert</span>(condition, ...) <span class="selector-tag">do</span> &#123; &#125; <span class="selector-tag">while</span> (<span class="number">0</span>)</span><br><span class="line"><span class="selector-id">#endif</span> <span class="comment">// !defined(NS_BLOCK_ASSERTIONS)</span></span><br></pre></td></tr></table></figure><p><code>NSAssert</code>å’Œ<code>NSCAssert</code>åº•å±‚éƒ½æ˜¯é€šè¿‡<code>NSAssertionHandler</code>æ¥å®ç°çš„ï¼Œåªæœ‰2ä¸ªå®ç°æ–¹æ³•</p><ul><li><code>-handleFailureInMethod:object:file:lineNumber:description:</code>  NSAssert/NAParamterAssertè°ƒç”¨</li><li><code>-handleFailureInFunction:file:lineNumber:description:</code> NSCAssert/NACParamterAssertè°ƒç”¨</li></ul><p>Xcodeçš„å¼€å…³åœ¨<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201201014436.png" alt=""></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰NSAssert</p><p>ç»§æ‰¿NSAssertionHandlerï¼Œé‡å†™<code>handleFailureInFunction:file:lineNumber:description</code>å’Œ<code>handleFailureInMethod:object:file:lineNumber:description:</code><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201201014548.png" alt=""></p><p>åœ¨AppDelegateä¸­æ³¨å†Œ</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="comment">// Override point for customization after application launch.</span></span><br><span class="line">    <span class="built_in">NSAssertionHandler</span> *handler = [[UDTestAssertHandler alloc] init];</span><br><span class="line">    [[[<span class="built_in">NSThread</span> currentThread] threadDictionary] setValue:handler</span><br><span class="line">                                                   forKey:<span class="built_in">NSAssertionHandlerKey</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="NSAssertçš„å‘"><a href="#NSAssertçš„å‘" class="headerlink" title="NSAssertçš„å‘"></a>NSAssertçš„å‘</h2><p>NSAssertåœ¨OCä¸­ï¼Œä¼šå­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)buttonAction:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    TestMode *mode = [TestMode new];</span><br><span class="line">    <span class="keyword">self</span>.mode = mode;</span><br><span class="line"><span class="comment">//    @weakify(self);</span></span><br><span class="line">    mode.textBlock = ^&#123;</span><br><span class="line"><span class="comment">//        @strongify(self);</span></span><br><span class="line">        <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">NSParameterAssert</span>(k == <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"123"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">    mode.textBlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ªç¯å¼•ç”¨çš„æ ¹æºåœ¨äºNSAssertå®šä¹‰ä¸­ä½¿ç”¨äº†self</p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#if</span> !<span class="selector-tag">defined</span>(_NSAssertBody)</span><br><span class="line"><span class="selector-id">#define</span> <span class="selector-tag">NSAssert</span>(condition, desc, ...)\</span><br><span class="line">    <span class="selector-tag">do</span> &#123;\</span><br><span class="line"><span class="selector-tag">__PRAGMA_PUSH_NO_EXTRA_ARG_WARNINGS</span> \</span><br><span class="line"><span class="selector-tag">if</span> (__builtin_expect(!(condition), <span class="number">0</span>)) &#123;\</span><br><span class="line">    <span class="selector-attr">[[NSAssertionHandler currentHandler]</span> <span class="selector-tag">handleFailureInMethod</span><span class="selector-pseudo">:_cmd</span> \</span><br><span class="line"><span class="selector-tag">object</span><span class="selector-pseudo">:self</span> <span class="selector-tag">file</span>:@(__FILE_NAME__) \</span><br><span class="line">    <span class="selector-tag">lineNumber</span><span class="selector-pseudo">:__LINE__</span> <span class="selector-tag">description</span><span class="selector-pseudo">:(desc)</span>, #<span class="selector-id">#__VA_ARGS__</span>]; \</span><br><span class="line">&#125;\</span><br><span class="line">        <span class="selector-tag">__PRAGMA_POP_NO_EXTRA_ARG_WARNINGS</span> \</span><br><span class="line">    &#125; <span class="selector-tag">while</span>(<span class="number">0</span>)</span><br><span class="line"><span class="selector-id">#endif</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è¯•ç”¨@weakself å’Œ @strongselfæ¥è§£å†³ã€‚ä¸è¿‡åœ¨releaseç¯å¢ƒä¸‹ï¼Œassertå¹¶ä¸ä¼šè°ƒç”¨ã€‚æ‰€ä»¥æ¨èè¯•ç”¨<code>NSCAssert</code>å’Œ <code>NSParameterAssert</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20201013152501.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;assertå¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œåœ¨å¼€å‘é˜¶æ®µç”¨æ–­è¨€å‡½æ•°å¯ä»¥å¾ˆå¥½çš„è¿›è¡Œè°ƒè¯•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>UIActivityViewController åœ¨iOS11ä¸Šçš„å‘</title>
    <link href="http://yoursite.com/2017/11/28/UIActivityViewController-%E5%9C%A8iOS11%E4%B8%8A%E7%9A%84%E5%9D%91/"/>
    <id>http://yoursite.com/2017/11/28/UIActivityViewController-%E5%9C%A8iOS11%E4%B8%8A%E7%9A%84%E5%9D%91/</id>
    <published>2017-11-28T06:48:00.000Z</published>
    <updated>2025-07-07T06:09:16.140Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘åœ¨åšé’ˆå¯¹å›½å¤–ç”¨æˆ·çš„Appï¼Œè€ƒè™‘åˆ°å›½å¤–éƒ½æ˜¯Facebookå’ŒTwitterç­‰ç¤¾äº¤å¹³å°ï¼Œæ‰€ä»¥è€ƒè™‘ä½¿ç”¨iOSç³»ç»Ÿä¸­çš„åŸç”Ÿåˆ†äº«ã€‚ä½†æ˜¯åœ¨iOS11ä¸Šé¢é‡åˆ°ä¸€äº›å‘ï¼Œé‚è®°å½•ä¸€ä¸‹ã€‚</p></blockquote><p>åœ¨iOS11ä»¥ä¸‹çš„ç‰ˆæœ¬ä¸­ï¼Œç³»ç»Ÿé»˜è®¤é›†æˆäº†ç¤¾äº¤è´¦å·çš„åŠŸèƒ½ã€‚ä½†æ˜¯åœ¨iOS11ä¸­å†…ç½®çš„ç¤¾äº¤è´¦å·è¢«ç§»é™¤äº†ã€‚å¹¶ä¸”åœ¨iOS11ä¸­åºŸå¼ƒäº†ä¸€äº›æ–¹æ³•ã€‚</p><figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">SOCIAL_EXTERN NSString *<span class="keyword">const</span> SLServiceTypeTwitter NS_DEPRECATED(<span class="number">10</span>_8, <span class="number">10</span>_13, <span class="number">6</span>_0, <span class="number">11</span>_0);</span><br><span class="line">SOCIAL_EXTERN NSString *<span class="keyword">const</span> SLServiceTypeFacebook NS_DEPRECATED(<span class="number">10</span>_8, <span class="number">10</span>_13, <span class="number">6</span>_0, <span class="number">11</span>_0);</span><br><span class="line">SOCIAL_EXTERN NSString *<span class="keyword">const</span> SLServiceTypeSinaWeibo NS_DEPRECATED(<span class="number">10</span>_8, <span class="number">10</span>_13, <span class="number">6</span>_0, <span class="number">11</span>_0);</span><br><span class="line">SOCIAL_EXTERN NSString *<span class="keyword">const</span> SLServiceTypeTencentWeibo NS_DEPRECATED(<span class="number">10</span>_8, <span class="number">10</span>_13, <span class="number">6</span>_0, <span class="number">11</span>_0);</span><br><span class="line">SOCIAL_EXTERN NSString *<span class="keyword">const</span> SLServiceTypeLinkedIn NS_DEPRECATED(<span class="number">10</span>_8, <span class="number">10</span>_13, <span class="number">6</span>_0, <span class="number">11</span>_0);</span><br></pre></td></tr></table></figure><a id="more"></a><p>ä½¿ç”¨ç³»ç»Ÿåˆ†äº«å¯ä»¥ä½¿ç”¨<code>UIActivityViewController</code>å’Œ<code>SLComposeViewController</code>ã€‚ä½†æ˜¯åœ¨iOS11ä¸­<code>SLComposeViewController</code>å·²ç»æ— æ³•ä½¿ç”¨ã€‚</p><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">BOOL <span class="built_in">available</span> = [SLComposeViewController isAvailableForServiceType:SLServiceTypeSinaWeibo];</span><br><span class="line">  <span class="comment">//iOS11ç³»ç»Ÿä¸­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•åº”è¯¥æ‰€æœ‰å¹³å°éƒ½æ˜¯NO</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">available</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åªèƒ½ä½¿ç”¨<code>UIActivityViewController</code>ã€‚ä½¿ç”¨ç³»ç»Ÿçš„åˆ†äº«SDKå¥½å¤„è¿˜æ˜¯å¾ˆå¤šçš„ã€‚ä¸ç”¨å†å„ä¸ªå¹³å°ä¸Šç”³è¯·è´¦å·ï¼Œç”³è¯·Keyï¼Œè®¾ç½®ç™½åå•ç­‰ç­‰ï¼Œåªéœ€å‡ è¡Œä»£ç å°±èƒ½ä¼˜é›…çš„å®ç°åˆ†äº«åŠŸèƒ½ã€‚</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *textToShare = <span class="string">@"test titile"</span>;</span><br><span class="line"><span class="built_in">UIImage</span>* imageShare = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"logo"</span>];</span><br><span class="line"><span class="built_in">NSURL</span> *urlShare = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"https://www.youdao.com"</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *activityItems = @[textToShare, imageShare, urlShare];</span><br><span class="line"><span class="built_in">UIActivityViewController</span> *actVC = [[<span class="built_in">UIActivityViewController</span> alloc] initWithActivityItems:activityItems applicationActivities:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">//excludedActivityTypes æ˜¯æ’é™¤é‚£äº›åˆ†äº«åŠŸèƒ½ï¼Œæ•°ç»„é‡Œé¢çš„éƒ½ä¸æ˜¾ç¤º</span></span><br><span class="line">actVC.excludedActivityTypes = @[<span class="built_in">UIActivityTypeMessage</span>,<span class="built_in">UIActivityTypePrint</span>,<span class="built_in">UIActivityTypeSaveToCameraRoll</span>,<span class="built_in">UIActivityTypeAddToReadingList</span>,<span class="built_in">UIActivityTypePostToFlickr</span>,<span class="built_in">UIActivityTypePostToVimeo</span>,<span class="built_in">UIActivityTypeAirDrop</span>];</span><br><span class="line"><span class="comment">//åŒºåˆ†iPad å’Œ iPhone</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">UI_USER_INTERFACE_IDIOM</span>() == <span class="built_in">UIUserInterfaceIdiomPad</span>) &#123;</span><br><span class="line">    actVC.popoverPresentationController.sourceView = <span class="keyword">self</span>.view;</span><br><span class="line">      [<span class="keyword">self</span> presentViewController:actVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      [<span class="keyword">self</span> presentViewController:actVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  actVC.completionWithItemsHandler = ^(<span class="built_in">UIActivityType</span>  _Nullable activityType, <span class="built_in">BOOL</span> completed, <span class="built_in">NSArray</span> * _Nullable returnedItems, <span class="built_in">NSError</span> * _Nullable activityError) &#123;</span><br><span class="line">      <span class="built_in">NSLog</span>(<span class="string">@"===%@"</span>,returnedItems);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>excludedActivityTypesæ˜¯å‰”é™¤é‚£äº›åˆ†äº«åŠŸèƒ½ï¼Œæšä¸¾å¦‚ä¸‹</p><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypePostToFacebook</span>     <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">6</span>_0) __TVOS_PROHIBITED;    <span class="comment">//å‘é€åˆ°Facebook</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypePostToTwitter</span>      <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">6</span>_0) __TVOS_PROHIBITED;    <span class="comment">//å‘é€åˆ°Twitter</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypePostToWeibo</span>        <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">6</span>_0) __TVOS_PROHIBITED;    <span class="comment">//å‘é€åˆ°æ–°æµªå¾®åš</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypeMessage</span>            <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">6</span>_0) __TVOS_PROHIBITED;    <span class="comment">//çŸ­ä¿¡</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypeMail</span>               <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">6</span>_0) __TVOS_PROHIBITED;    <span class="comment">//é‚®ä»¶</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypePrint</span>              <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">6</span>_0) __TVOS_PROHIBITED;    <span class="comment">//æ‰“å°</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypeCopyToPasteboard</span>   <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">6</span>_0) __TVOS_PROHIBITED;    <span class="comment">//æ‹·è´</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypeAssignToContact</span>    <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">6</span>_0) __TVOS_PROHIBITED;    <span class="comment">//æŒ‡å®šç»™è”ç³»äºº</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypeSaveToCameraRoll</span>   <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">6</span>_0) __TVOS_PROHIBITED;    <span class="comment">//ä¿å­˜è‡³ç›¸æœºèƒ¶å·</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypeAddToReadingList</span>   <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0) __TVOS_PROHIBITED;    <span class="comment">//æ·»åŠ è‡³é˜…è¯»åˆ—è¡¨</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypePostToFlickr</span>       <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0) __TVOS_PROHIBITED;    <span class="comment">//å‘é€åˆ°Flickr(é›…è™æ——ä¸‹å›¾ç‰‡åˆ†äº«ç½‘ç«™)</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypePostToVimeo</span>        <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0) __TVOS_PROHIBITED;    <span class="comment">//å‘é€åˆ°Vimeo</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypePostToTencentWeibo</span> <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0) __TVOS_PROHIBITED;    <span class="comment">//å‘é€åˆ°è…¾è®¯å¾®åš</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypeAirDrop</span>            <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0) __TVOS_PROHIBITED;    <span class="comment">//AirDrop</span></span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> <span class="built_in">UIActivityTypeOpenInIBooks</span>       <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0) __TVOS_PROHIBITED;    <span class="comment">//åœ¨iBooksä¸­æ‰“å¼€</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ˜¯iOS11ä»¥ä¸‹çš„ç³»ç»Ÿï¼Œä¸Šé¢çš„åˆ†äº«åŠŸèƒ½åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯åœ¨iOS11ä¸Šé¢å‡ºç°äº†Twitterå’ŒFacebookéƒ½ä¸èƒ½åˆ†äº«çš„é—®é¢˜ï¼ˆå¾®ä¿¡ã€å¾®åšç­‰æ­£å¸¸ï¼‰ã€‚</p></blockquote><p>åœ¨iOS11ä¸Šé¢åˆ†äº«è¿™ä¸¤ä¸ªå¹³å°ç‚¹å‡»logoä»¥åæ²¡æœ‰ä»»ä½•ååº”ã€‚ä¸‹é¢å¼€å§‹æ’æŸ¥é—®é¢˜ã€‚</p><ul><li><h5 id="çŒœæƒ³ä¸€ï¼šç³»ç»Ÿç§»é™¤æ‰å†…ç½®ç¤¾äº¤å¹³å°åï¼ŒTwitterå’ŒFacebookçš„Appæ²¡æœ‰æ›´æ–°"><a href="#çŒœæƒ³ä¸€ï¼šç³»ç»Ÿç§»é™¤æ‰å†…ç½®ç¤¾äº¤å¹³å°åï¼ŒTwitterå’ŒFacebookçš„Appæ²¡æœ‰æ›´æ–°" class="headerlink" title="çŒœæƒ³ä¸€ï¼šç³»ç»Ÿç§»é™¤æ‰å†…ç½®ç¤¾äº¤å¹³å°åï¼ŒTwitterå’ŒFacebookçš„Appæ²¡æœ‰æ›´æ–°"></a>çŒœæƒ³ä¸€ï¼šç³»ç»Ÿç§»é™¤æ‰å†…ç½®ç¤¾äº¤å¹³å°åï¼ŒTwitterå’ŒFacebookçš„Appæ²¡æœ‰æ›´æ–°</h5><p>å‡çº§æ‰‹æœºä¸­è¿™ä¸¤ä¸ªAppï¼Œ<strong>æ›´æ–°åæ— æ•ˆ</strong>ã€‚ä½†æ˜¯æ‰¾åˆ°äº†ä¸€äº›èµ„æ–™<br><a href="https://twittercommunity.com/t/bug-in-ios-11/91490/9" target="_blank" rel="noopener">Twitter - Developers:Bug in iOS 11?</a><br>Twitter å®˜æ–¹è¯´å·²ç»é’ˆå¯¹iOS11è¿›è¡Œäº†æ›´æ–°é€‚é…</p></li><li><h5 id="çŒœæƒ³äºŒï¼šå›½å†…ç‰¹ä¾›ç‰ˆï¼Ÿæ¥å£å°æ‰äº†"><a href="#çŒœæƒ³äºŒï¼šå›½å†…ç‰¹ä¾›ç‰ˆï¼Ÿæ¥å£å°æ‰äº†" class="headerlink" title="çŒœæƒ³äºŒï¼šå›½å†…ç‰¹ä¾›ç‰ˆï¼Ÿæ¥å£å°æ‰äº†"></a>çŒœæƒ³äºŒï¼šå›½å†…ç‰¹ä¾›ç‰ˆï¼Ÿæ¥å£å°æ‰äº†</h5><p>iOS10ä¸Šé¢ä¸€åˆ‡æ­£å¸¸ï¼Œä½†æ˜¯è€ƒè™‘åˆ°iOS11ç³»ç»Ÿçš„æ”¹å˜ï¼Œæ‰€ä»¥åˆ æ‰ä¸­å›½App Storeä¸‹è½½çš„Appï¼Œç™»å½•ç¾å›½App Store è´¦å·ä¸‹è½½è¿™ä¸¤ä¸ªAppã€‚æ‰“å¼€åä¾æ—§ã€‚<strong>æ— æ•ˆ</strong></p><blockquote><p>æ­¤æ—¶å‘ç°ç³»ç»Ÿç›¸å†Œä¸­çš„åˆ†äº«ï¼Œç‚¹å‡»Facebookå’ŒTwitterä¹Ÿæ— ååº”ã€‚æ‰€ä»¥åº”è¯¥å’ŒAppæ— å…³</p></blockquote></li><li><h5 id="çŒœæƒ³ä¸‰ï¼šGreat-Wall"><a href="#çŒœæƒ³ä¸‰ï¼šGreat-Wall" class="headerlink" title="çŒœæƒ³ä¸‰ï¼šGreat Wall"></a>çŒœæƒ³ä¸‰ï¼šGreat Wall</h5><p>é¦™æ¸¯çš„æœ‹å‹è¯•è¯•ä»–çš„æ‰‹æœºã€‚<strong>ä¾æ—§æ— è§£</strong></p></li><li><h5 id="çŒœæƒ³å››ï¼šiOS11ç³»ç»Ÿç‰ˆæœ¬bugï¼Œæ²¡æ›´æ–°"><a href="#çŒœæƒ³å››ï¼šiOS11ç³»ç»Ÿç‰ˆæœ¬bugï¼Œæ²¡æ›´æ–°" class="headerlink" title="çŒœæƒ³å››ï¼šiOS11ç³»ç»Ÿç‰ˆæœ¬bugï¼Œæ²¡æ›´æ–°"></a>çŒœæƒ³å››ï¼šiOS11ç³»ç»Ÿç‰ˆæœ¬bugï¼Œæ²¡æ›´æ–°</h5><p>éƒ½æ›´æ–°åˆ°æœ€æ–°çš„iOS11.1.2(æ­£å¼ç‰ˆ)ã€‚<strong>é—®é¢˜ä¾æ—§</strong></p></li><li><h5 id="çŒœæƒ³äº”ï¼šæ‰‹æœºçš„åŸå› ï¼Œå› ä¸ºæ˜¯å›½è¡Œ"><a href="#çŒœæƒ³äº”ï¼šæ‰‹æœºçš„åŸå› ï¼Œå› ä¸ºæ˜¯å›½è¡Œ" class="headerlink" title="çŒœæƒ³äº”ï¼šæ‰‹æœºçš„åŸå› ï¼Œå› ä¸ºæ˜¯å›½è¡Œ"></a>çŒœæƒ³äº”ï¼šæ‰‹æœºçš„åŸå› ï¼Œå› ä¸ºæ˜¯å›½è¡Œ</h5><p>ä»¥ä¸Šå‡ ç§æƒ…å†µä½¿ç”¨äº†ä¸åŒçš„æœºå‹æµ‹è¯•ï¼Œä½†æ˜¯éƒ½æ˜¯å›½è¡Œæ‰‹æœºã€‚ä½†æ˜¯ç°åœ¨éƒ½æ˜¯å…¨ç½‘é€šå¹¶ä¸”å›½å¤–å–çš„æ‰‹æœºä¹Ÿéƒ½æ˜¯å¤§é™†äº§çš„ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å°±æ²¡è€ƒè™‘è¿™ä¸ªã€‚ä»¥ä¸ŠçŒœæƒ³éƒ½å¦å†³ä»¥åå¼€å§‹æƒ³åˆ°è¿™ä¸ªåŸå› ã€‚<br>æ‰¾äº†ä¸€åœˆï¼Œæœ€åæµ‹è¯•å‘ç°</p><blockquote><p>å°åº¦ä¹°çš„iPhone 5Såœ¨iOS11ä¸Šåˆ†äº«Facebookå’ŒTwitter æˆåŠŸ<br>æ—¥æœ¬ä¹°çš„iPhone 8 Plus åœ¨iOS11ä¸Šé¢åˆ†äº«æˆåŠŸ<br>å¹¶ä¸”iOS11çš„ç³»ç»Ÿæœ‰11.1.2å’Œ11.1.0çš„</p></blockquote></li></ul><blockquote><p>æ‰€ä»¥æœ€åç»“è®ºæ˜¯åœ¨iOS11ä¸Šé¢ç§»é™¤æ‰äº†ç³»ç»Ÿå†…ç½®åˆ†äº«åï¼Œå›½è¡Œæ‰‹æœºå¯¹Facebook å’ŒTwitter çš„åŸç”Ÿåˆ†äº«éƒ½å¤±æ•ˆäº†ã€‚ä½†æ˜¯é™¤äº†å›½è¡Œä»¥å¤–çš„æ‰‹æœºåº”è¯¥éƒ½æ²¡é—®é¢˜ã€‚</p></blockquote><h5 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h5><p>åªæœ‰è‡ªå·±æ¥å…¥Facebookå’ŒTwitterçš„SDKï¼Œå»å®˜ç½‘æ³¨å†Œkeyä¸å†ä½¿ç”¨ç³»ç»Ÿçš„ã€‚<br>ä½†æ˜¯è€ƒè™‘åˆ°æˆ‘ä»¬çš„ç”¨æˆ·ç¾¤éƒ½æ˜¯å¤–å›½äººï¼Œå›½è¡Œæ‰‹æœºå æœ‰ç‡å¾ˆä½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿½ç•¥äº†è¿™ä¸ªBug(å¦‚æœæ˜¯Bugçš„è¯)ï¼Œæ¯•ç«Ÿå›½å†…å¸¸ç”¨çš„å¾®ä¿¡ã€å¾®åšã€QQä¸€åˆ‡æ­£å¸¸ã€‚</p><p>è¿™ä¸ªé—®é¢˜æˆ‘ä¼šæŒç»­è¿½è¸ªï¼Œçœ‹çœ‹åæœŸç³»ç»Ÿæ›´æ–°ä¼šä¸ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦å¤–æˆ‘ä¹Ÿåœ¨Twitterå®˜ç½‘ä¸Šæé—®äº†ã€‚ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰å›åº”ã€‚</p><p><a href="https://twittercommunity.com/t/in-ios11-use-uiactivityviewcontroller-to-share-have-no-reaction/97486" target="_blank" rel="noopener">In iOS11,Use UIActivityViewController to share have no reaction</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘åœ¨åšé’ˆå¯¹å›½å¤–ç”¨æˆ·çš„Appï¼Œè€ƒè™‘åˆ°å›½å¤–éƒ½æ˜¯Facebookå’ŒTwitterç­‰ç¤¾äº¤å¹³å°ï¼Œæ‰€ä»¥è€ƒè™‘ä½¿ç”¨iOSç³»ç»Ÿä¸­çš„åŸç”Ÿåˆ†äº«ã€‚ä½†æ˜¯åœ¨iOS11ä¸Šé¢é‡åˆ°ä¸€äº›å‘ï¼Œé‚è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨iOS11ä»¥ä¸‹çš„ç‰ˆæœ¬ä¸­ï¼Œç³»ç»Ÿé»˜è®¤é›†æˆäº†ç¤¾äº¤è´¦å·çš„åŠŸèƒ½ã€‚ä½†æ˜¯åœ¨iOS11ä¸­å†…ç½®çš„ç¤¾äº¤è´¦å·è¢«ç§»é™¤äº†ã€‚å¹¶ä¸”åœ¨iOS11ä¸­åºŸå¼ƒäº†ä¸€äº›æ–¹æ³•ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight angelscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SOCIAL_EXTERN NSString *&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; SLServiceTypeTwitter NS_DEPRECATED(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_8, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_13, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;_0, &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;_0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SOCIAL_EXTERN NSString *&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; SLServiceTypeFacebook NS_DEPRECATED(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_8, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_13, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;_0, &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;_0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SOCIAL_EXTERN NSString *&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; SLServiceTypeSinaWeibo NS_DEPRECATED(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_8, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_13, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;_0, &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;_0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SOCIAL_EXTERN NSString *&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; SLServiceTypeTencentWeibo NS_DEPRECATED(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_8, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_13, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;_0, &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;_0);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SOCIAL_EXTERN NSString *&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; SLServiceTypeLinkedIn NS_DEPRECATED(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_8, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_13, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;_0, &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;_0);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Xcodeä½¿ç”¨æŠ€å·§ï¼šä»£ç å—çš„ä½¿ç”¨</title>
    <link href="http://yoursite.com/2017/05/30/Xcode%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%EF%BC%9A%E4%BB%A3%E7%A0%81%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://yoursite.com/2017/05/30/Xcode%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%EF%BC%9A%E4%BB%A3%E7%A0%81%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2017-05-30T08:57:00.000Z</published>
    <updated>2025-07-07T06:09:16.140Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»£ç å—æ˜¯Xcodeä¸­å¾ˆä¾¿åˆ©çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰ä¸åŒçš„ä»£ç å—ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€äº›éœ€è¦é‡å¤å†™çš„ä»£ç ï¼Œä½¿ç”¨ä»£ç å—å¯ä»¥å¤§å¤§çš„æé«˜æ•ˆç‡ã€‚</p></blockquote><p><strong>ä»£ç å—ä»‹ç»</strong></p><p> ä»£ç å—è¿™ä¸ªåŠŸèƒ½å¤§å®¶å…¶å®éƒ½ç”¨è¿‡ï¼Œå½“ä½ åœ¨å†™ä¸€äº›ä»£ç æ—¶å€™ï¼Œä»£ç æç¤ºåŠŸèƒ½å°±ä¼šæ˜¾ç¤ºå‡ºä¸€äº›ç³»ç»Ÿå®šä¹‰å¥½çš„ä»£ç å—ã€‚å¦‚å›¾å°±æ˜¯ç³»ç»Ÿå®šä¹‰å¥½çš„if elseçš„ä»£ç å—ã€‚<br>    <img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714165733.png" alt=""><br>    ä»£ç å—åœ¨å³ä¾§è¾¹æ çš„ä¸‹æ–¹ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå®šä¹‰çš„ä»£ç å—ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä½ è‡ªå·±çš„ä»£ç å—ã€‚<br>    <img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714165820.png" alt=""></p><pre><code>ä¸‹å›¾å°±æ˜¯ç³»ç»Ÿå®šä¹‰å¥½çš„dispathc_once_tçš„ä»£ç å—ã€‚</code></pre><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714165857.png" alt=""></p><p><strong>å®šä¹‰è‡ªå·±çš„ä»£ç å—</strong></p><p>å®šä¹‰è‡ªå·±çš„ä»£ç å—æœ‰å¾ˆå¤šå¥½å¤„ï¼Œä½ å¯ä»¥éšå¿ƒæ‰€æ¬²çš„æ ¹æ®è‡ªå·±çš„é¡¹ç›®å’Œå–œå¥½å®šä¹‰è‡ªå·±çš„ä»£ç å—ã€‚<br>æ¯”å¦‚ä¸€äº›@propertyå±æ€§ï¼Œä¸€äº›ä¸‰æ–¹çš„ç»Ÿè®¡åŠŸèƒ½ç­‰ç­‰ã€‚ä¸‹é¢æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªä»£ç å—ï¼Œæ¥å¿«é€Ÿå®š    ä¹‰@property ä¿®é¥°ç¬¦ä¸ºnonatomicå’Œstrong</p><p>é¦–å…ˆåœ¨ä»»æ„ä¸€ä¸ªç±»ä¸‹é¢å£°æ˜å¦‚ä¸‹çš„å±æ€§ type å’Œ name ä¸ºæç¤ºè¯­<br>    <figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">@<span class="keyword">property</span><span class="title"> </span>(nonatomic,strong) <span class="keyword">type</span> name;</span><br></pre></td></tr></table></figure><br><strong>ç„¶åæŠŠtype å’Œ name ä¸Šåˆ†åˆ«æ”¹ä¸º&lt;#type#&gt; å’Œ &lt;#name#&gt;</strong></p><pre><code>ä½ ä¼šå‘ç° type å’Œname éƒ½å˜æˆäº†é«˜äº®çŠ¶æ€ï¼Œä½ å¯ä»¥æŒ‰Tabé”®æ¥åˆ‡æ¢ã€‚</code></pre><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714170047.png" alt=""><br>  æ˜¯ä¸æ˜¯å‘ç°å˜æˆå’Œç³»ç»Ÿçš„ä¸€æ ·äº†ï¼Ÿä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨é«˜äº®åœ°æ–¹å†™å…¥ä½ éœ€è¦çš„ä»£ç ï¼Œç„¶åæŒ‰Tabé”®æ¥å›åˆ‡æ¢ã€‚<br>  <img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714170116.png" alt=""><br>   ç„¶åå…¨é€‰ä½ åˆšåˆšå†™çš„é‚£è¡Œä»£ç ï¼Œæ‹–æ‹½åˆ°ä»£ç å—ç•Œé¢æ‰€åœ¨çš„åŒºåŸŸã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714170138.png" alt=""><br>ç„¶åä¼šå¼¹å‡ºä¸€ä¸ªç•Œé¢ï¼Œåœ¨è¿™é‡Œå¡«å†™ä½ çš„ä»£ç å—çš„ä¿¡æ¯ã€‚<br>Titleå°±æ˜¯åœ¨ä»£ç å—ç®¡ç†åŒºåŸŸæ˜¾ç¤ºçš„åç§°ã€‚é‡è¦çš„ä¸‹é¢çš„Completion Shortcutï¼Œè¿™å°±æ˜¯ä½ çš„ä»£ç å—çš„å¿«æ·é”®ï¼Œ<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714170203.png" alt=""><br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714170223.png" alt=""></p><p>ç„¶åç‚¹å‡»Doneã€‚ä½ çš„ä»£ç å—å°±ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸­äº†ã€‚å»ä»£ç åŒºè¯•ä¸€ä¸‹<br>è¾“å…¥@ps å°±ä¼šå‡ºç°ä½ çš„ä»£ç å—æç¤ºï¼ŒæŒ‰å›è½¦ååˆšåˆšå®šä¹‰çš„ä»£ç å°±å‡ºç°äº†~<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714170247.png" alt=""></p><p>ä»£ç å—çš„å¥½å¤„æ˜¯ä¸è¨€è€Œå–»çš„ï¼Œç»å¯¹æ˜¯æé«˜æ•ˆç‡çš„åˆ©å™¨ã€‚æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰çš„é¡¹ç›®è¦æ¥å…¥å¥½å¤šç¬¬ä¸‰æ–¹çš„ç»Ÿè®¡åŠŸèƒ½ï¼Œç„¶è€Œæ¯ä¸ªç•Œé¢æŒ¨ä¸ªå¤åˆ¶æŒ¨ä¸ªæ”¹å¾ˆæµªè´¹æ—¶é—´ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨runtimeç›´æ¥åœ¨Viewcontroller çš„loadæ–¹æ³•å†™ï¼Œä½†æ˜¯å°±ä¸èƒ½è‡ªå®šä¹‰ä¸€äº›ä¸œè¥¿äº†ï¼‰ã€‚ä½¿ç”¨ä»£ç å—åå°±ä¼šå¾ˆæ–¹ä¾¿çš„å®Œæˆè¿™äº›å·¥ä½œå•¦ã€‚<br><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714170305.png" alt=""></p><p>å†ä¸¾ä¸ªæ —å­ã€‚Xcode8ä»¥åç¦ç”¨äº†ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œä¹‹å‰ä½¿ç”¨çš„å¤šè¡Œæ³¨é‡Šæ’ä»¶(å°±æ˜¯å–µç¥å†™çš„é‚£ä¸ª)ä¹Ÿè¢«åºŸå¼ƒäº†ã€‚è™½ç„¶Xcode8æä¾›äº†ç³»ç»Ÿçš„ï¼Œä½†æ˜¯ä¸å¤ªå¥½ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç å—æ¥è‡ªå®šä¹‰å¤šè¡Œæ³¨é‡Šã€‚<br>ï¼ˆå¿«æ·é”®å®šä¹‰ä¸º â€œ///â€œ å¹¶ä¸ä¼šæŒ‰å›è½¦å°±ä¼šå‡ºæ¥ï¼Œè€Œæ˜¯éœ€è¦æŒ‰escæ‰èƒ½æç¤ºï¼Œæ‰€ä»¥æˆ‘ç”¨äº†â€œcccâ€ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200714170324.png" alt=""></p><p><strong>ä»£ç å—çš„å­˜æ”¾è·¯å¾„ä¸º ~/Library/Developer/Xcode/UserData/CodeSnippets</strong></p><p>å¤§å®¶å¯ä»¥ä»ç½‘ä¸Šä¸‹è½½ä¸€äº›å¤§ç¥å†™å¥½çš„ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å†™å®Œä»¥åå¤‡ä»½ï¼Œé˜²æ­¢ä¸¢å¤±ã€‚<br>ä¸Šä¸ªåœ°å€å§ï¼Œæˆ‘è‡ªå·±å®šä¹‰çš„ä¸€äº›ï¼Œæ²¡æ€ä¹ˆç®¡ç†ï¼Œæœ‰ç‚¹ä¹±</p><p><a href="https://github.com/liweican1992/XcodeCodeSnippets.git" target="_blank" rel="noopener">https://github.com/liweican1992/XcodeCodeSnippets.git</a></p><p>PSï¼šå…³äºç»Ÿè®¡åŸ‹ç‚¹ï¼Œæˆ‘è‡ªå·±æ ¹æ®Runtimeå†™äº†ä¸€äº›ç»Ÿè®¡åŠŸèƒ½ï¼Œå›å¤´è¡¥ä¸Šã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä»£ç å—æ˜¯Xcodeä¸­å¾ˆä¾¿åˆ©çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰ä¸åŒçš„ä»£ç å—ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€äº›éœ€è¦é‡å¤å†™çš„ä»£ç ï¼Œä½¿ç”¨ä»£ç å—å¯ä»¥å¤§å¤§çš„æé«˜æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç å—ä»‹ç»&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; ä»£ç å—è¿™ä¸ªåŠŸèƒ½å¤§
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Appleå®¡æ ¸é‚£ç‚¹äº‹ï¼šè¢«æ‹’åå¦‚ä½•ç”³è¯‰</title>
    <link href="http://yoursite.com/2017/05/07/Apple%E5%AE%A1%E6%A0%B8%E9%82%A3%E7%82%B9%E4%BA%8B%EF%BC%9A%E8%A2%AB%E6%8B%92%E5%90%8E%E5%A6%82%E4%BD%95%E7%94%B3%E8%AF%89/"/>
    <id>http://yoursite.com/2017/05/07/Apple%E5%AE%A1%E6%A0%B8%E9%82%A3%E7%82%B9%E4%BA%8B%EF%BC%9A%E8%A2%AB%E6%8B%92%E5%90%8E%E5%A6%82%E4%BD%95%E7%94%B3%E8%AF%89/</id>
    <published>2017-05-07T08:02:00.000Z</published>
    <updated>2025-07-07T06:09:16.138Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>éšç€Appleå®¡æ ¸æ—¶é—´çš„å¤§å¤§åŠ å¿«ï¼Œç¡®å®é€ ç¦äº†æˆ‘ä»¬è¿™äº›è‹¦é€¼çš„å¼€å‘è€…ã€‚ä»Šå¤©ä¸»è¦èŠä¸€äº›å®¡æ ¸è¢«æ‹’ä»¥åå¦‚æœä¸­é—´å­˜åœ¨è¯¯ä¼šä»€ä¹ˆçš„ï¼Œå¦‚ä½•å‘è‹¹æœç”³è¯‰ã€‚<br>  å…³äºç”³è¯‰ï¼Œæˆ‘ä¹‹å‰çš„åšå®¢å°±æåŠè¿‡ï¼Œè¯¦è§ï¼š <a href="http://www.cnblogs.com/cc412/p/5006029.html" target="_blank" rel="noopener">å…³äºå®¡æ ¸è¢«æ‹’ç”³è¯‰é‚£ç‚¹äº‹</a><br>  ä½†æ˜¯è€ƒè™‘åˆ°æ—¶é—´è¿™ä¹ˆä¹…äº†ï¼Œæœ‰ä¸€äº›è§„åˆ™å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå°±å†é‡æ–°å¼€ä¸€ç¯‡ã€‚</p></blockquote><p>  è‹¹æœçš„å®¡æ ¸æ€»æ˜¯å……æ»¡äº†éšæœºæ€§ï¼Œä¹‹å‰ç”¨çš„å¥½å¥½çš„ä¸€ä¸ªåŠŸèƒ½å°±ä¼šå¿½ç„¶å‘Šè¯‰ä½ ä¸ç¬¦åˆä»–ä»¬çš„æ ‡å‡†äº†ã€‚è¿™æ¬¡æäº¤å®¡æ ¸æ€»å…±è¢«æ‹’ç»äº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ˜¯å› ä¸ºç‰ˆæœ¬å·ï¼Œç¬¬äºŒæ¬¡å› ä¸ºæœåŠ¡å™¨æœºæˆ¿æŒ‚äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601160409.png" alt=""></p><a id="more"></a><blockquote><p>Design Preamble<br>Your app includes an update button or alerts the user to update the app. To avoid user confusion, app version updates must utilize the iOS built-in update mechanism.<br>Specifically, the é—œæ–¼æˆ‘å€‘ button contains reference to the version number. Although the é—œæ–¼æˆ‘å€‘ button does not contain update functionality, it will be appropriate to remove this responsive feature.<br>Please see attached screenshots for details.<br>Next Steps<br>To resolve this issue, please remove the update feature from your app. To distribute a new version of your app, upload the new app binary version into the same iTunes Connect record you created for the appâ€™s previous version. Updated versions keep the same Apple ID, iTunes Connect ID (SKU), and bundle ID as the original version, and are available free to customers who purchased a previous version.<br>Resources<br>To create new versions of your app, please review the Create a new version section in iTunes Connect Developer Help.</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601160421.png" alt=""></p><p>å¤§æ„å°±æ˜¯æˆ‘ä»¬åœ¨å…³äºæˆ‘ä»¬åé¢åŠ äº†ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œä¼šè®©ç”¨æˆ·ä»¥ä¸ºç‚¹å‡»è¿™é‡Œå¯ä»¥æ£€æµ‹ç‰ˆæœ¬ï¼Œå› ä¸ºè‹¹æœç¦æ­¢ä¸»åŠ¨çš„ç‰ˆæœ¬æ£€æµ‹åŠŸèƒ½ï¼ˆè¯¦è§ï¼š<a href="http://www.jianshu.com/p/3b5dc03099b5" target="_blank" rel="noopener">å…³äºiOS App ç‰ˆæœ¬æ§åˆ¶ä»¥åŠå¼ºåˆ¶æ›´æ–°</a>å’Œ<a href="http://www.cnblogs.com/cc412/p/4371148.html" target="_blank" rel="noopener">è‹¹æœæ–°æ”¿ï¼Œç¦æ­¢å¼€å‘è€…åœ¨Appä¸­åŠ å…¥æ£€æŸ¥æ›´æ–°åŠŸèƒ½</a>ï¼‰ï¼Œæ‰€ä»¥ç»™æ‹’äº†ã€‚</p><p>æœ€ååœ¨ä¸‹æ–¹å¢åŠ ä¸€ä¸ªä¸èƒ½ç‚¹å‡»çš„å½“å‰ç‰ˆæœ¬åŠŸèƒ½è§£å†³æ­¤é—®é¢˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601160439.png" alt=""></p><p>ç»§ç»­æäº¤ï¼Œè¿™æ¬¡ä¸€å¤©å°±å®¡æ ¸äº†ï¼Œå¯èƒ½ç°åœ¨è‹¹æœåœ¨è¢«æ‹’ä»¥åå†æ¬¡æäº¤èµ°çš„é€šé“ä¸ä¸€æ ·ã€‚ç„¶è€Œè‹¹æœæ™šä¸Šå®¡æ ¸æ—¶å€™åˆšå¥½æˆ‘ä»¬æœåŠ¡å™¨æœºæˆ¿ç½‘ç»œæ³¢åŠ¨ï¼Œç»™çš„æµ‹è¯•è´¦å·ä¸€ç›´ç™»ä¸ä¸Šå»ï¼Œå†æ¬¡è¢«æ‹’ç»ã€‚</p><blockquote><p>Guideline 2.1 - Performance<br>We discovered one or more bugs in your app when reviewed on iPhone running iOS 10.3.1 on Wi-Fi connected to an IPv6 network.<br>Specifically, we were not able to log into the application with the demo credentials provided.<br>-The application remained at the login menu as we attempted to log in.<br>The steps to reproduce are:</p><ol><li>Lauch application</li><li>Navigate to login screen</li><li>Enter demo credentials/ credentials</li><li>Tap log in<br>Please see attached screenshots for details.<br>Next Steps<br>To resolve this issue, please run your app on a device while connected to an IPv6 network (all apps must support IPv6) to identify any issues, then revise and resubmit your app for review.<br>If we misunderstood the intended behavior of your app, please reply to this message in Resolution Center to provide information on how these features were intended to work.<br>For new apps, uninstall all previous versions of your app from a device, then install and follow the steps to reproduce the issue. For updates, install the new version as an update to the previous version, then follow the steps to reproduce the issue.<br>Resources<br>For information about supporting IPv6 Networks, please review Supporting IPv6 DNS64/NAT64 Networks and About Networking.</li></ol></blockquote><p>è‹¹æœç»™å‡ºçš„æ„è§æ˜¯åšIPV6çš„é€‚é…ï¼Œä»–ä»¬æ€€ç–‘æ˜¯IPV6çš„åŸå› é€ æˆæ— æ³•è®¿é—®ï¼Œè€Œä¹‹å‰æˆ‘ä»¬IPV6æ²¡å‡ºç°è¿‡é—®é¢˜ï¼Œå¹¶ä¸”æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼Œæ˜¨å¤©æ™šä¸Šç¡®å®å‡ºç°äº†è­¦æŠ¥ã€‚é‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯è¦å’Œè‹¹æœè§£é‡Šäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601160500.png" alt=""></p><p>åœ¨è¢«æ‹’ç»ä¸‹æ–¹æœ‰ä¸€ä¸ªå›å¤æ¡†ï¼Œä½ åœ¨è¿™é‡Œå¯ä»¥å‘è‹¹æœè§£é‡Šè¯¯ä¼šä»¥åŠä¸€äº›æ“ä½œæ­¥éª¤ã€‚ä½¿ç”¨ä¸­æ–‡å°±å¯ä»¥ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œä¸è¦ä½¿ç”¨ä¸Šæ–¹çš„<strong>å‘Appå®¡æŸ¥å§”å‘˜ä¼šæäº¤ä¸Šè¯‰</strong></p><blockquote><p>è‹¹æœå®¡æ ¸æœ‰ä¸¤ä¸ªéƒ¨é—¨ï¼Œä¸€ä¸ªæ˜¯Resolution Centerå¦å¤–ä¸€ä¸ªæ˜¯App Review Boardã€‚App Review Boardå°±æ˜¯å®¡æ ¸å§”å‘˜ä¼šï¼Œä»–ä»¬çš„çº§åˆ«é«˜äºResolution Centerã€‚å½“ä½ å¯¹Resolution Centerç»™å‡ºçš„åŸå› å’Œè§£å†³æ–¹æ¡ˆä¸æ»¡æ„çš„è¯ï¼Œå¯ä»¥å‘æ›´é«˜ä¸€çº§çš„App Review Boardæå‡ºä¸Šè¯‰ã€‚<br>ä½†æ˜¯è¯·æ³¨æ„<strong><em>å¦‚æœä½ å·²ç»å›å¤è¿‡äº†Resolution Centerï¼ˆä¹Ÿå°±æ˜¯ä¸‹æ–¹çš„è¾“å…¥æ¡†å“ªé‡Œï¼‰è€Œä»–ä»¬è¿˜æ²¡æœ‰ç»™ä½ å›åº”æ—¶å€™ï¼Œä¸è¦å†ç‚¹å‡»ä¸Šæ–¹çš„å‘â€œAppå®¡æŸ¥å§”å‘˜ä¼šæäº¤ä¸Šè¯‰â€</em></strong></p></blockquote><p>å› ä¸ºä½ ä¼šåƒæˆ‘ä¸€æ ·æ”¶åˆ°ä¸€å°é‚®ä»¶</p><blockquote><p>Hello xxx,<br>Thank you for contacting the App Review Board.<br>We see that youâ€™re currently communicating with the App Store Review team through the Resolution Center, so weâ€™re closing your appeal. If you would like to continue the appeal process, please reply to this message to let us know.<br>Best regards.<br> App Store Review Board</p></blockquote><p>æ‰€ä»¥ä»–ä»¬æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„éƒ¨é—¨ï¼Œ<strong>å¹¶ä¸”ä¸ªäººä¸å»ºè®®ä½ å»ä¸Šè¯‰ï¼Œè‹¹æœçš„å®¡æ ¸äººå‘˜ç´ è´¨è¿˜æ˜¯æŒºé«˜çš„ï¼Œåªè¦ä½ é˜æ˜ä½ çš„ç†ç”±å¹¶ä¸”æ˜¯åˆç†çš„</strong>ï¼Œä¸€èˆ¬éƒ½ä¼šç»™ä½ é€šè¿‡ã€‚è€Œä¸Šè¯‰ä¼šç•™ä¸‹ç±»ä¼¼æ¡ˆåº•çš„ä¸œè¥¿ï¼Œå¯¹ä½ çš„åç»­å®¡æ ¸â€œå¯èƒ½â€ä¼šé€ æˆä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ã€‚</p><p>  å¥½å§ï¼Œæ‰¯äº†è¿™ä¹ˆå¤šã€‚åç»­å°±æ˜¯æˆ‘æŠŠæœºæˆ¿é—®é¢˜é˜è¿°äº†ä¸€ä¸‹ï¼Œç¬¬äºŒå¤©å®¡æ ¸å°±é€šè¿‡äº†ã€‚å¹¶ä¸”äººå®¶ä¼šå†æ¬¡ç»™ä½ å¾ˆæœ‰ç¤¼è²Œçš„å›å¤ã€‚ä¸€ç‰‡å’Œè°~</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601160515.png" alt=""></p><p>æ‰€ä»¥è‹¹æœçš„ç”³è¯‰æœºåˆ¶è¿˜æ˜¯å¾ˆæœ‰ç”¨å¤„çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨ç”³è¯‰æ—¶å€™ä¸€å®šè¦æ³¨æ„è¯­è¨€ï¼Œåˆ«äººä¹Ÿæ˜¯å±¥è¡Œè‡ªå·±çš„èŒè´£ã€‚è¿˜æœ‰å°±æ˜¯è¦æ³¨æ„ä»–ä»¬ä¸åŒéƒ¨é—¨çš„åˆ’åˆ†ã€‚<br>ä»¥ä¸Šã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;éšç€Appleå®¡æ ¸æ—¶é—´çš„å¤§å¤§åŠ å¿«ï¼Œç¡®å®é€ ç¦äº†æˆ‘ä»¬è¿™äº›è‹¦é€¼çš„å¼€å‘è€…ã€‚ä»Šå¤©ä¸»è¦èŠä¸€äº›å®¡æ ¸è¢«æ‹’ä»¥åå¦‚æœä¸­é—´å­˜åœ¨è¯¯ä¼šä»€ä¹ˆçš„ï¼Œå¦‚ä½•å‘è‹¹æœç”³è¯‰ã€‚&lt;br&gt;  å…³äºç”³è¯‰ï¼Œæˆ‘ä¹‹å‰çš„åšå®¢å°±æåŠè¿‡ï¼Œè¯¦è§ï¼š &lt;a href=&quot;http://www.cnblogs.com/cc412/p/5006029.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å…³äºå®¡æ ¸è¢«æ‹’ç”³è¯‰é‚£ç‚¹äº‹&lt;/a&gt;&lt;br&gt;  ä½†æ˜¯è€ƒè™‘åˆ°æ—¶é—´è¿™ä¹ˆä¹…äº†ï¼Œæœ‰ä¸€äº›è§„åˆ™å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå°±å†é‡æ–°å¼€ä¸€ç¯‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;  è‹¹æœçš„å®¡æ ¸æ€»æ˜¯å……æ»¡äº†éšæœºæ€§ï¼Œä¹‹å‰ç”¨çš„å¥½å¥½çš„ä¸€ä¸ªåŠŸèƒ½å°±ä¼šå¿½ç„¶å‘Šè¯‰ä½ ä¸ç¬¦åˆä»–ä»¬çš„æ ‡å‡†äº†ã€‚è¿™æ¬¡æäº¤å®¡æ ¸æ€»å…±è¢«æ‹’ç»äº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ˜¯å› ä¸ºç‰ˆæœ¬å·ï¼Œç¬¬äºŒæ¬¡å› ä¸ºæœåŠ¡å™¨æœºæˆ¿æŒ‚äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601160409.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>iOS APNsç¯‡ï¼šæŒ½æ•‘æ¨é€äº‹æ•…â€”â€”å¦‚ä½•â€œæ’¤å›â€å·²å‘é€çš„æ¨é€é€šçŸ¥</title>
    <link href="http://yoursite.com/2017/03/01/iOS-APNs%E7%AF%87%EF%BC%9A%E6%8C%BD%E6%95%91%E6%8E%A8%E9%80%81%E4%BA%8B%E6%95%85%E2%80%94%E2%80%94%E5%A6%82%E4%BD%95%E2%80%9C%E6%92%A4%E5%9B%9E%E2%80%9D%E5%B7%B2%E5%8F%91%E9%80%81%E7%9A%84%E6%8E%A8%E9%80%81%E9%80%9A%E7%9F%A5/"/>
    <id>http://yoursite.com/2017/03/01/iOS-APNs%E7%AF%87%EF%BC%9A%E6%8C%BD%E6%95%91%E6%8E%A8%E9%80%81%E4%BA%8B%E6%95%85%E2%80%94%E2%80%94%E5%A6%82%E4%BD%95%E2%80%9C%E6%92%A4%E5%9B%9E%E2%80%9D%E5%B7%B2%E5%8F%91%E9%80%81%E7%9A%84%E6%8E%A8%E9%80%81%E9%80%9A%E7%9F%A5/</id>
    <published>2017-03-01T08:29:00.000Z</published>
    <updated>2025-07-07T06:09:16.141Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç®€ä¹¦æ—§æ–‡</p></blockquote><blockquote><p>æ¨é€æœåŠ¡åœ¨æ—¥å¸¸è¿è¥ä¸­è‡³å…³é‡è¦ï¼Œå°±ç®—æ˜¯å¤§å‚ä¹Ÿç»å¸¸å‘ç”Ÿæ¨é€äº‹æ•…ã€‚ç›¸ä¿¡å¾ˆå¤šäººéƒ½æ”¶åˆ°è¿‡åä¸ºâ€œtestâ€çš„æ¨é€ä¿¡æ¯ã€‚æœ¬ç¯‡å°†ä»‹ç»å¦‚ä½•åœ¨æ¨é€äº‹æ•…å‘ç”Ÿæ—¶â€œæ’¤å›â€å·²å‘é€çš„æ¨é€é€šçŸ¥ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601163016.png" alt=""></p><p>ç»†å¿ƒçš„ç”¨æˆ·ä¼šå‘ç°å½“å¾®ä¿¡æ¶ˆæ¯è¢«æ’¤å›æˆ–è€…è§†é¢‘è¯·æ±‚è¢«å–æ¶ˆæ—¶ï¼Œç›¸åº”çš„æ¨é€ä¿¡æ¯ä¹Ÿä¼šæ¶ˆå¤±ä¸è§ã€‚å“ªæ€•æ˜¯å¾®ä¿¡æ²¡æœ‰åœ¨åå°è¿è¡Œã€‚</p><p>æœ¬äººå¾ˆæ˜¯å¥½å¥‡ï¼Œç½‘ä¸Šåˆæ²¡æœ‰æŸ¥åˆ°æœ‰ç”¨çš„èµ„æ–™ï¼Œä»Šå¤©èŠ±äº†ç‚¹æ—¶é—´å®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p><a id="more"></a><p>é‚£ä¹ˆå¦‚ä½•å®ç°å‘¢ï¼Œè¯·å¾€ä¸‹çœ‹ã€‚</p><ul><li><h3 id="çŒœæƒ³å…¶åŸç†"><a href="#çŒœæƒ³å…¶åŸç†" class="headerlink" title="çŒœæƒ³å…¶åŸç†"></a>çŒœæƒ³å…¶åŸç†</h3></li></ul><p>â€œæ’¤å›â€è¿™é‡Œæ˜¯æ‰“äº†å¼•å·çš„ï¼Œæˆ‘ç¿»çœ‹äº†ä¸‹APNsèµ„æ–™å¹¶æ²¡æœ‰æ‰¾åˆ°æ’¤å›çš„æ¥å£ã€‚<br>å…³äºè¯¦ç»†çš„APNsä»‹ç»å¯ä»¥å‚è€ƒè¿™é‡Œï¼š<a href="http://www.jianshu.com/p/ace1b422bad4" target="_blank" rel="noopener">å›½å†… 90%ä»¥ä¸Šçš„ iOS å¼€å‘è€…ï¼Œå¯¹ APNs çš„è®¤è¯†éƒ½æ˜¯é”™çš„</a>ã€‚</p><p>å¾®ä¿¡çš„æ¶ˆæ¯æé†’åº”è¯¥èµ°çš„ä¹Ÿæ˜¯è‹¹æœçš„APNsé€šé“ï¼Œå½“å¾®ä¿¡åœ¨åå°killæ‰æ—¶å€™æ¨é€æ¶ˆæ¯è¿‡æ¥åå†æ’¤å›ï¼Œä¾æ—§å¯ä»¥â€œæ’¤å›â€è¿™ä¸ªé€šçŸ¥ã€‚ä½†è¿™æ—¶å€™Appæ ¹æœ¬å°±æ²¡æœ‰åœ¨åå°è¿è¡Œï¼Œ<strong>é‚£ä¹ˆåº”è¯¥è¿˜æ˜¯èµ°APNsé€šé“æ¥å‘ä¸€æ¡æ–°æ¨é€å»é™¤æ‰ä¹‹å‰é‚£æ¡ã€‚</strong><br>ç”¨æ–°æ¨é€æ¥å»é™¤æ—§çš„æ¨é€ï¼Œå¹¶ä¸”æ–°æ¨é€ä¸æ˜¾ç¤ºã€‚é‚£ä¹ˆæ–¹æ¡ˆåº”è¯¥å°±æ˜¯<strong>é™é»˜æ¨é€ï¼ˆSilent Remote Notificationsï¼‰</strong>äº†</p><ul><li><h3 id="é™é»˜æ¨é€"><a href="#é™é»˜æ¨é€" class="headerlink" title="é™é»˜æ¨é€"></a>é™é»˜æ¨é€</h3></li></ul><p>é™é»˜æ¨é€ï¼ˆSilent Remote Notificationsï¼‰æ˜¯iOS7ä»¥åçš„æ–°ç‰¹æ€§ã€‚ç‰¹è‰²å°±æ˜¯å¯ä»¥ä¸æ‰“æ‰°ç”¨æˆ·ï¼Œæ— å£°éŸ³æ— è§’æ ‡æ‚„æ— å£°æ¯çš„å”¤é†’Appæ¥è¿›è¡Œä¸€äº›æ›´æ–°æ“ä½œã€‚</p><p>è‹¹æœå®˜æ–¹æ–‡æ¡£å¦‚ä¸‹</p><blockquote><p>Configuring a Silent Notification</p></blockquote><blockquote><p>The aps dictionary can also contain the content-available property. The content-available property with a value of 1 lets the remote notification act as a silent notification. When a silent notification arrives, iOS wakes up your app in the background so that you can get new data from your server or do background information processing. Users arenâ€™t told about the new or changed information that results from a silent notification, but they can find out about it the next time they open your app.</p></blockquote><blockquote><p>For a silent notification, take care to ensure there is no alert, sound, or badge payload in the aps dictionary. If you donâ€™t follow this guidance, the incorrectly-configured notification might be throttled and not delivered to the app in the background, and instead of being silent is displayed to the user.</p></blockquote><p>é™é»˜æ¨é€æœ‰ä¸€å®šçš„æ¨é€æ ¼å¼è¦æ±‚ã€‚é¦–å…ˆä¸èƒ½æœ‰alertä¿¡æ¯ï¼Œå¦‚æœæœ‰çš„è¯å°±å˜æˆæ™®é€šæ¨é€äº†ã€‚å…¶æ¬¡APNså‚æ•°é‡Œé¢è¦æœ‰ <strong>content-availableï¼š1</strong></p><p>ä¸‹å›¾æ˜¯æå…‰æ¨é€åå°å¯¹é™é»˜æ¨é€çš„è§£é‡Š</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601163042.png" alt=""></p><p><strong>é™é»˜æ¨é€å’Œæ™®é€šæ¨é€çš„åŒºåˆ«å°±æ˜¯ä¸ç”¨ç”¨æˆ·ç‚¹å‡»æ¨é€ä¿¡æ¯å³å¯è¿›å…¥didReceiveRemoteNotificationæ–¹æ³•è·å–æ¨é€ä¿¡æ¯ï¼Œæ— è®ºAppæ˜¯å¦åœ¨åå°è¿è¡Œ</strong></p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">application</span><span class="selector-pseudo">:(UIApplication</span> *)<span class="selector-tag">application</span> <span class="selector-tag">didReceiveRemoteNotification</span><span class="selector-pseudo">:(NSDictionary</span> *)<span class="selector-tag">userInfo</span> <span class="selector-tag">fetchCompletionHandler</span><span class="selector-pseudo">:(void</span> (^)(UIBackgroundFetchResult))<span class="selector-tag">completionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æ— è®ºAppæ˜¯å¦åœ¨åå°è¿è¡Œï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å‘é€ä¸€ä¸ªé™é»˜æ¨é€å»è®©Appå¤„ç†ä¸€äº›äº‹æƒ…ã€‚æ¯”å¦‚èµ„è®¯ç±»Appæ¯å¤©å®šç‚¹æ¨é€è®©Appåå°é™é»˜æ›´æ–°å½“å¤©çš„æ¨èæ–‡ç« ã€‚ç”¨æˆ·æ‰“å¼€åä¸å†éœ€è¦åŠ è½½å°±å¯ä»¥è§‚çœ‹ç­‰ç­‰è¿™ç±»éœ€æ±‚ã€‚</p><p>é™é»˜æ¨é€æ”¶åˆ°ä»¥åï¼ŒuserInfoç»“æ„å¦‚ä¸‹ï¼Œä½ å¯ä»¥æ·»åŠ è‡ªå®šä¹‰å‚æ•°å»å¤„ç†ä¸€äº›äº‹æƒ…</p><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    aps =     &#123;</span><br><span class="line">        alert = <span class="string">""</span><span class="comment">;</span></span><br><span class="line">        <span class="string">"content-available"</span> = <span class="number">1</span><span class="comment">;</span></span><br><span class="line">        <span class="string">"mutable-content"</span> = <span class="number">1</span><span class="comment">;</span></span><br><span class="line">    &#125;<span class="comment">;</span></span><br><span class="line">    //è‡ªå·±è‡ªå®šä¹‰çš„å‚æ•°</span><br><span class="line">    recall2 = true<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘è‡ªå®šä¹‰recallå‚æ•°ï¼Œ<strong>å½“æ”¶åˆ°çš„APNsçš„userInfoä¸­åŒ…å«recallæ—¶å€™å°±ä»£è¡¨æˆ‘è¦æ¸…é™¤æ‰€æœ‰è§’æ ‡å’Œæ¨é€ä¿¡æ¯ã€‚è¿™æ ·å°±è¾¾åˆ°äº†â€œæ’¤å›â€çš„æ•ˆæœ</strong></p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">application</span><span class="selector-pseudo">:(UIApplication</span> *)<span class="selector-tag">application</span> <span class="selector-tag">didReceiveRemoteNotification</span><span class="selector-pseudo">:(NSDictionary</span> *)<span class="selector-tag">userInfo</span> <span class="selector-tag">fetchCompletionHandler</span><span class="selector-pseudo">:(void</span> (^)(UIBackgroundFetchResult))<span class="selector-tag">completionHandler</span> &#123;</span><br><span class="line">    <span class="selector-tag">if</span> (application.applicationState == UIApplicationStateActive) &#123;</span><br><span class="line">        <span class="selector-tag">NSLog</span>(@<span class="string">"Appåœ¨å‰å°è¿è¡Œæ—¶å€™æ”¶åˆ°æ¨é€,ä¸å¤„ç†"</span>);    </span><br><span class="line">        <span class="selector-tag">completionHandler</span>(UIBackgroundFetchResultNewData);</span><br><span class="line">        <span class="selector-tag">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">NSLog</span>(@<span class="string">"åœ¨åå°è¿è¡Œç‚¹å‡»æ¨é€æˆ–è€…é™é»˜æ¨é€"</span>);</span><br><span class="line">    <span class="selector-tag">if</span> ([userInfo <span class="attribute">objectForKey</span>:@<span class="string">"recall"</span>]) &#123;</span><br><span class="line">        <span class="selector-tag">NSLog</span>(@<span class="string">"æ’¤å›æ¶ˆæ¯"</span>);</span><br><span class="line">        <span class="comment">//do nothing</span></span><br><span class="line">    &#125;<span class="selector-tag">else</span>&#123;</span><br><span class="line">         <span class="comment">//è‡ªå·±å†™çš„æ¨é€å¤„ç†æ–¹æ³•</span></span><br><span class="line">        <span class="selector-attr">[self didRegisterFormApnsWithInfo:userInfo]</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å»é™¤è§’æ ‡ å»é™¤æ¨é€ä¿¡æ¯</span></span><br><span class="line">    <span class="selector-attr">[application setApplicationIconBadgeNumber:0]</span>;</span><br><span class="line">    <span class="selector-attr">[JPUSHService resetBadge]</span>;</span><br><span class="line">    <span class="selector-attr">[JPUSHService handleRemoteNotification:userInfo]</span>;</span><br><span class="line">    <span class="selector-tag">completionHandler</span>(UIBackgroundFetchResultNewData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœŸæœºè¿è¡Œï¼Œå®æµ‹åœ¨åå°è¿è¡Œå’ŒKillæ‰éƒ½å¯ä»¥å»é™¤ä¹‹å‰çš„æ¨é€ä¿¡æ¯ï¼ŒåŒ…æ‹¬é”å±çŠ¶æ€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601163058.png" alt=""></p><p>åˆ°æ­¤æˆ‘ä»¬å°±å®ç°äº†æ¨é€çš„â€œæ’¤å›â€åŠŸèƒ½ã€‚ä»æ­¤å¦ˆå¦ˆå†ä¹Ÿä¸æ€•æˆ‘å‘é”™æ¨é€å•¦,å…¬å¸å‘é”™æ¨é€ä»¥åå†ä¹Ÿä¸ç”¨å®ä¹ ç”ŸèƒŒé”…å•¦~</p><blockquote><p>æ³¨ï¼šä»¥ä¸Šè§£å†³æ–¹æ¡ˆåªæ˜¯ä¸ªäººçŒœæƒ³åå®ç°çš„ï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„æ–¹æ¡ˆæˆ–è§£å†³æœºåˆ¶ï¼Œæ¬¢è¿è®¨è®º~å¦‚æœæ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œç‚¹ä¸ªèµå†èµ°å‘—ğŸ¤”</p></blockquote><p>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç®€ä¹¦æ—§æ–‡&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¨é€æœåŠ¡åœ¨æ—¥å¸¸è¿è¥ä¸­è‡³å…³é‡è¦ï¼Œå°±ç®—æ˜¯å¤§å‚ä¹Ÿç»å¸¸å‘ç”Ÿæ¨é€äº‹æ•…ã€‚ç›¸ä¿¡å¾ˆå¤šäººéƒ½æ”¶åˆ°è¿‡åä¸ºâ€œtestâ€çš„æ¨é€ä¿¡æ¯ã€‚æœ¬ç¯‡å°†ä»‹ç»å¦‚ä½•åœ¨æ¨é€äº‹æ•…å‘ç”Ÿæ—¶â€œæ’¤å›â€å·²å‘é€çš„æ¨é€é€šçŸ¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200601163016.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç»†å¿ƒçš„ç”¨æˆ·ä¼šå‘ç°å½“å¾®ä¿¡æ¶ˆæ¯è¢«æ’¤å›æˆ–è€…è§†é¢‘è¯·æ±‚è¢«å–æ¶ˆæ—¶ï¼Œç›¸åº”çš„æ¨é€ä¿¡æ¯ä¹Ÿä¼šæ¶ˆå¤±ä¸è§ã€‚å“ªæ€•æ˜¯å¾®ä¿¡æ²¡æœ‰åœ¨åå°è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æœ¬äººå¾ˆæ˜¯å¥½å¥‡ï¼Œç½‘ä¸Šåˆæ²¡æœ‰æŸ¥åˆ°æœ‰ç”¨çš„èµ„æ–™ï¼Œä»Šå¤©èŠ±äº†ç‚¹æ—¶é—´å®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Xcode8 å’ŒiOS10 åšAPNSé€‚é…çš„ä¸€äº›å‘</title>
    <link href="http://yoursite.com/2016/09/21/Xcode8-%E5%92%8CiOS10-%E5%81%9AAPNS%E9%80%82%E9%85%8D%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/"/>
    <id>http://yoursite.com/2016/09/21/Xcode8-%E5%92%8CiOS10-%E5%81%9AAPNS%E9%80%82%E9%85%8D%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/</id>
    <published>2016-09-21T12:50:00.000Z</published>
    <updated>2025-07-07T06:09:16.140Z</updated>
    
    <content type="html"><![CDATA[<p>iOS10å·²ç»å‘äº†ï¼Œæœ€è¿‘å‘ç°Appåœ¨iOS10ä¸Šæœ‰ä¸€äº›é—®é¢˜ï¼Œä¸»è¦æ˜¯iOS10çš„å­—ä½“å˜äº†ï¼Œä¸€äº›Labelè¦åšé€‚é…ã€‚è¿˜æœ‰ä¸€äº›ç›¸æœºæƒé™ä¹‹ç±»çš„ã€‚æ›´åŠ è¯¦ç»†çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« <br><a href="https://github.com/ChenYilong/iOS10AdaptationTips" target="_blank" rel="noopener">https://github.com/ChenYilong/iOS10AdaptationTips</a></p><p>  ä¹‹å‰ä¸€ç›´çº ç»“è¦ä¸è¦å‡çº§Xcode8ï¼Œæ¯•ç«Ÿå¥½å¤šæ’ä»¶éƒ½ä¸èƒ½ç”¨äº†ï¼Œè¿˜æœ‰ç”¨Xcode7æ‰“åŒ…çš„Appåœ¨iOS10ä¸Šè¿è¡Œèƒ½ä¸èƒ½æ”¶åˆ°æ¨é€ï¼Œç»è¿‡ä¸€å¤©çš„æµ‹è¯•ã€‚ç»“æœå¦‚ä¸‹ï¼š<br>  ä»¥ä¸‹ç»“æœæ˜¯æˆ‘ç”¨æå…‰æ¨é€æµ‹è¯•çš„ç»“æœï¼ˆJPushï¼‰</p><h4 id="Xcode7æ‰“åŒ…çš„Appèƒ½ä¸èƒ½å†iOS10ä¸Šæ”¶åˆ°æ¨é€ï¼Ÿ"><a href="#Xcode7æ‰“åŒ…çš„Appèƒ½ä¸èƒ½å†iOS10ä¸Šæ”¶åˆ°æ¨é€ï¼Ÿ" class="headerlink" title="Xcode7æ‰“åŒ…çš„Appèƒ½ä¸èƒ½å†iOS10ä¸Šæ”¶åˆ°æ¨é€ï¼Ÿ"></a>Xcode7æ‰“åŒ…çš„Appèƒ½ä¸èƒ½å†iOS10ä¸Šæ”¶åˆ°æ¨é€ï¼Ÿ</h4><p>  ç­”æ¡ˆï¼šå¯ä»¥çš„ï¼Œèƒ½å¤Ÿæ”¶åˆ°æ¨é€ã€‚ä½†æ˜¯ç‚¹å‡»æ¨é€æˆ–è€…ä»æ¨é€å¯åŠ¨Appä¹‹å‰çš„æ–¹æ³•ä¸å†å“åº”ã€‚</p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">application</span><span class="selector-pseudo">:(UIApplication</span> *)<span class="selector-tag">application</span> <span class="selector-tag">didReceiveRemoteNotification</span><span class="selector-pseudo">:(NSDictionary</span> *)<span class="selector-tag">userInfo</span> <span class="selector-tag">fetchCompletionHandler</span><span class="selector-pseudo">:(void</span> (^)(UIBackgroundFetchResult))<span class="selector-tag">completionHandler</span> &#123;</span><br><span class="line">  <span class="comment">//iOS7ä»¥åæ”¶åˆ°æ¨é€ æ¨é€ç»“æœä¼šåœ¨è¿™é‡Œå“åº” </span></span><br><span class="line">  <span class="comment">//iOS10 ä»¥åä¸å†å“åº”è¿™é‡Œ</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯åªèƒ½æ”¶åˆ°ï¼Œä½†æ˜¯ç‚¹å‡»æ¨é€ä»¥ååªä¼šæ‰“å¼€Appè€Œä¸ä¼šèµ°didReceiveRemoteNotificationï¼Œæ‰€ä»¥é¡µé¢ä¸è·³è½¬ã€‚<br>ï¼ˆæˆ‘æ˜¯ç”¨AD_Hocè¯ä¹¦å‘äº†ä¸€ä¸ªæµ‹è¯•ç‰ˆã€‚ç”¨iOS10çš„æœºå­è£…ä¸Šä»¥åä½¿ç”¨æ¨é€ç”Ÿäº§ç¯å¢ƒæ¨é€æµ‹è¯•çš„ã€‚AppStoreç‰ˆæœ¬æ²¡æµ‹è¯•ï¼‰</p><h4 id="Xcode8å‡çº§ä»¥åæ€ä¹ˆåšiOS10é€‚é…"><a href="#Xcode8å‡çº§ä»¥åæ€ä¹ˆåšiOS10é€‚é…" class="headerlink" title="Xcode8å‡çº§ä»¥åæ€ä¹ˆåšiOS10é€‚é…"></a>Xcode8å‡çº§ä»¥åæ€ä¹ˆåšiOS10é€‚é…</h4><p>æˆ‘æ˜¯æ ¹æ®æœ€æ–°çš„Jpushå®˜æ–¹æ–‡æ¡£åšçš„é€‚é…<br><a href="https://docs.jiguang.cn/jpush/client/iOS/ios_guide_new/" target="_blank" rel="noopener">https://docs.jiguang.cn/jpush/client/iOS/ios_guide_new/</a></p><p>éœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š</p><h6 id="1-Xcode8çš„ç–¯ç‹‚è¾“å‡ºæ¨¡å¼"><a href="#1-Xcode8çš„ç–¯ç‹‚è¾“å‡ºæ¨¡å¼" class="headerlink" title="1.Xcode8çš„ç–¯ç‹‚è¾“å‡ºæ¨¡å¼"></a>1.Xcode8çš„ç–¯ç‹‚è¾“å‡ºæ¨¡å¼</h6><p>  åˆšç”¨Xcoed8æ—¶å€™å“ç€äº†ï¼Œç–¯ç‹‚è¾“å‡ºä¸€å¤§å †logä¿¡æ¯ã€‚å»ºè®®å…³é—­æ‰ã€‚<br>å…³é—­åŠæ³•</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200624235419.png" alt=""><br>è¿›å…¥åœ°æ–¹åœ¨ä½ é€‰æ‹©æ¨¡æ‹Ÿå™¨çš„å·¦è¾¹æœ‰ä¸€ä¸ªä½ çš„Appå›¾æ ‡å’Œåå­—ï¼Œç‚¹å‡»ä¸€ä¸‹é€‰æ‹©Edit Schemeã€‚ ç„¶åé€‰æ‹©Run-&gt;Environment Variables-&gt;+å·</p><blockquote><p>OS_ACTIVITY_MODE =disable </p></blockquote><p>ç„¶åæ‰“é’©ï¼Œå®Œäº‹</p><blockquote><p>ä½†æ˜¯Xcode8çš„NSLogä¸æ‰“å°äº† = =ï¼æˆ‘è¿™è¾¹æ˜¯è¿™ä¸ªæƒ…å†µ</p></blockquote><h6 id="2-Push-Notificationå¼€å…³"><a href="#2-Push-Notificationå¼€å…³" class="headerlink" title="2.Push Notificationå¼€å…³"></a>2.Push Notificationå¼€å…³</h6><p>  åˆšåœ¨Xcode8ä¸Šè¿è¡Œæ—¶å€™è‚¯å®šä¼šæŠ¥é”™ã€‚éœ€è¦åœ¨Tragets-&gt;Capabilitesæ‰“å¼€Push Notificationå¼€å…³ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img/20200624235524.png" alt=""><br>ç‚¹å‡»ä¿®å¤åä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªxxx.entitlementsçš„æ–‡ä»¶ï¼ˆxxxæ˜¯ä½ çš„å·¥ç¨‹åå­—ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200624235914.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200625000350.png" alt=""><br>ä½ ä¼šå‘ç°é‡Œé¢ä¼šæœ‰APS Environment å¹¶ä¸”ä¸ºdevelopment<br>é‚£ä½ éœ€è¦ä¸Šçº¿æ—¶å€™æ”¹æˆå‘å¸ƒå—ï¼Ÿ<br> <strong>å¹¶ä¸ç”¨</strong>å¯ä»¥å¿½ç•¥å®ƒï¼Œå®ƒå¯¹ä½ å‘å¸ƒå¹¶æ— å½±å“ã€‚åªè¦ä½ å‘å¸ƒæ—¶å€™é€‰æ‹©çš„æ˜¯å‘å¸ƒè¯ä¹¦ä¾æ—§æ˜¯å‘å¸ƒç¯å¢ƒã€‚</p><blockquote><p>ä½†æ˜¯ï¼Œå¦‚æœä½ ç”¨Xcode8ç”Ÿæˆä»¥åå†ç”¨Xcode7æ‰“å¼€ï¼Œå¦‚æœä¸åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰“åŒ…æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œ<del>æ‰€ä»¥å¦‚æœä½ æƒ³ç”¨Xcode8åšå®Œé€‚é…ä»¥åè¿˜æƒ³ç”¨Xcode7å‘åŒ…çš„è¯è¯·åˆ é™¤æ‰è¿™ä¸ªæ–‡ä»¶ã€‚ï¼ˆç„¶ååˆ é™¤æ‰ä¼šæŠ¥é”™ï¼‰æŠŠä¸‹å›¾é€‰ä¸­å“ªè¡Œåé¢çš„è·¯å¾„åˆ æ‰å°±å¥½äº†</del></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/liweican1992/hexoPic/img2/20200625000434.png" alt=""></p><blockquote><p>æ›´æ–°ï¼šæ˜¨å¤©è¯•äº†ä¸‹ï¼Œåˆ é™¤è¿™ä¸ªæ–‡ä»¶å†ç”¨Xcode7æ‰“åŒ…ä»¥åå®‰è£…åˆ°iOS10å¯ä»¥æ”¶åˆ°æ¨é€ä½†æ˜¯è¿˜æ˜¯ä¸å“åº”æ¨é€å¤„ç†çš„æ–¹æ³•ã€‚<br>æš‚æ—¶è§£å†³åŠæ³•æ˜¯ä½¿ç”¨Xcode7å¼€å‘æœ€åå‘ç‰ˆä½¿ç”¨Xcode8<br>Xcode7æ‰“åŒ…æŠ¥é”™åº”è¯¥æœ‰è§£å†³åŠæ³•ï¼Œæš‚æ—¶ç•™ä¸ªå‘</p></blockquote><p><strong>ä»£ç é€‚é…</strong><br>å› ä¸ºç”¨çš„ç¬¬ä¸‰æ–¹ï¼Œæ‰€ä»¥æŒ‰ç€æ–‡æ¡£æ¥å°±å¥½äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›å°å‘</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> NSFoundationVersionNumber_iOS_9_x_Max</span></span><br><span class="line"><span class="comment">//åœ¨è¿™é‡Œå†™é’ˆå¯¹iOS10çš„ä»£ç æˆ–è€…å¼•ç”¨æ–°çš„API</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UserNotifications/UserNotifications.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> NSFoundationVersionNumber_iOS_9_x_Max</span></span><br><span class="line">- (<span class="keyword">void</span>)jpushNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSInteger</span>))completionHandler &#123;</span><br><span class="line">Â  Â  <span class="comment">// Required</span></span><br><span class="line">Â  Â  <span class="built_in">NSDictionary</span> * userInfo = notification.request.content.userInfo;</span><br><span class="line">Â  Â  <span class="keyword">if</span>([notification.request.trigger isKindOfClass:[UNPushNotificationTrigger <span class="keyword">class</span>]]) &#123;</span><br><span class="line">Â  Â  Â  Â  [JPUSHService handleRemoteNotification:userInfo];</span><br><span class="line">Â  Â  Â  Â  [JPUSHService resetBadge];</span><br><span class="line">Â  Â  Â  Â  <span class="comment">///åœ¨å‰å°æ—¶å€™æ”¶åˆ°æ¨é€ iOS10Appè¿è¡Œåœ¨å‰å°æ¨é€æ¥äº†ä¹Ÿèƒ½æ˜¾ç¤ºå“¦</span></span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  completionHandler(UNNotificationPresentationOptionAlert); <span class="comment">// éœ€è¦æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œé€‰æ‹©æ˜¯å¦æé†’ç”¨æˆ·ï¼Œæœ‰Badgeã€Soundã€Alertä¸‰ç§ç±»å‹å¯ä»¥é€‰æ‹©è®¾ç½®</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// iOS 10 Support</span></span><br><span class="line">- (<span class="keyword">void</span>)jpushNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(<span class="keyword">void</span> (^)())completionHandler &#123;</span><br><span class="line">Â  Â  <span class="comment">// Required</span></span><br><span class="line">Â  Â  <span class="built_in">NSDictionary</span> * userInfo = response.notification.request.content.userInfo;</span><br><span class="line">Â  Â  <span class="keyword">if</span>([response.notification.request.trigger isKindOfClass:[UNPushNotificationTrigger <span class="keyword">class</span>]]) &#123;</span><br><span class="line">Â  Â  Â  Â  [JPUSHService resetBadge];</span><br><span class="line">      <span class="comment">///è¿™ä¸ªæ˜¯æˆ‘è‡ªå·±å¤„ç†æ¨é€çš„æ–¹æ³• å¿½ç•¥æ‰</span></span><br><span class="line">Â  Â  Â  Â  [<span class="keyword">self</span> didRegisterFormApnsWithInfo:userInfo];</span><br><span class="line">      Â  [JPUSHService handleRemoteNotification:userInfo];</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  completionHandler();Â  <span class="comment">// ç³»ç»Ÿè¦æ±‚æ‰§è¡Œè¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><blockquote><p>æœ‰è¶£çš„æ˜¯iOS10å½“Appæ­£åœ¨è¿è¡Œæ—¶å€™ä¹Ÿå¯ä»¥åœ¨ä¸Šæ–¹å¼¹å‡ºæ¨é€æ¡†</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;iOS10å·²ç»å‘äº†ï¼Œæœ€è¿‘å‘ç°Appåœ¨iOS10ä¸Šæœ‰ä¸€äº›é—®é¢˜ï¼Œä¸»è¦æ˜¯iOS10çš„å­—ä½“å˜äº†ï¼Œä¸€äº›Labelè¦åšé€‚é…ã€‚è¿˜æœ‰ä¸€äº›ç›¸æœºæƒé™ä¹‹ç±»çš„ã€‚æ›´åŠ è¯¦ç»†çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« &lt;br&gt;&lt;a href=&quot;https://github.com/ChenYilong/iOS10Adaptati
      
    
    </summary>
    
    
    
  </entry>
  
</feed>
